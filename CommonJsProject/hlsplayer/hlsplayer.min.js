!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.Hls=b():a.Hls=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/dist/",b(b.s=8)}([function(a,b,c){"use strict";function d(){}function e(a,b){return b="["+a+"] > "+b}function f(a){var b=self.console[a];return b?function(){for(var c=arguments.length,d=Array(c),f=0;c>f;f++)d[f]=arguments[f];d[0]&&(d[0]=e(a,d[0])),b.apply(self.console,d)}:d}function g(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];c.forEach(function(b){j[b]=a[b]?a[b].bind(a):f(b)})}c.d(b,"a",function(){return k}),c.d(b,"b",function(){return l});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i={trace:d,debug:d,log:d,warn:d,info:d,error:d},j=i,k=function(a){if(a===!0||"object"===("undefined"==typeof a?"undefined":h(a))){g(a,"debug","log","info","warn","error");try{j.log()}catch(b){j=i}}else j=i},l=j},function(a,b,c){"use strict";b.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(a,b,c){"use strict";c.d(b,"b",function(){return d}),c.d(b,"a",function(){return e});var d={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},e={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.d(b,"b",function(){return f});var e=function(){function a(){d(this,a)}return a.isHeader=function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128?!0:!1},a.isFooter=function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128?!0:!1},a.getID3Data=function(b,c){for(var d=c,e=0;a.isHeader(b,c);){e+=10;var f=a._readSize(b,c+6);e+=f,a.isFooter(b,c+10)&&(e+=10),c+=e}return e>0?b.subarray(d,d+e):void 0},a._readSize=function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]},a.getTimeStamp=function(b){for(var c=a.getID3Frames(b),d=0;d<c.length;d++){var e=c[d];if(a.isTimeStampFrame(e))return a._readTimeStamp(e)}return void 0},a.isTimeStampFrame=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info},a._getFrameData=function(b){var c=String.fromCharCode(b[0],b[1],b[2],b[3]),d=a._readSize(b,4),e=10;return{type:c,size:d,data:b.subarray(e,e+d)}},a.getID3Frames=function(b){for(var c=0,d=[];a.isHeader(b,c);){var e=a._readSize(b,c+6);c+=10;for(var f=c+e;f>c+8;){var g=a._getFrameData(b.subarray(c)),h=a._decodeFrame(g);h&&d.push(h),c+=g.size+10}a.isFooter(b,c)&&(c+=10)}return d},a._decodeFrame=function(b){return"PRIV"===b.type?a._decodePrivFrame(b):"T"===b.type[0]?a._decodeTextFrame(b):"W"===b.type[0]?a._decodeURLFrame(b):void 0},a._readTimeStamp=function(a){if(8===a.data.byteLength){var b=new Uint8Array(a.data),c=1&b[3],d=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];return d/=45,c&&(d+=47721858.84),Math.round(d)}return void 0},a._decodePrivFrame=function(b){if(b.size<2)return void 0;var c=a._utf8ArrayToStr(b.data),d=new Uint8Array(b.data.subarray(c.length+1));return{key:b.type,info:c,data:d.buffer}},a._decodeTextFrame=function(b){if(b.size<2)return void 0;if("TXXX"===b.type){var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data.subarray(1));return{key:b.type,data:f}},a._decodeURLFrame=function(b){if("WXXX"===b.type){if(b.size<2)return void 0;var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data);return{key:b.type,data:f}},a._utf8ArrayToStr=function(a){for(var b=a.length,c=void 0,d=void 0,e=void 0,f="",g=0;b>g;)if(c=a[g++],0!==c&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:f+=String.fromCharCode(c);break;case 12:case 13:d=a[g++],f+=String.fromCharCode((31&c)<<6|63&d);break;case 14:d=a[g++],e=a[g++],f+=String.fromCharCode((15&c)<<12|(63&d)<<6|(63&e)<<0)}return f},a}(),f=e._utf8ArrayToStr;b.a=e},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var h=function(){function a(b,c){d(this,a),this.subtle=b,this.aesIV=c}return a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)},a}(),i=h,j=function(){function a(b,c){e(this,a),this.subtle=b,this.key=c}return a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}(),k=j,l=function(){function a(){f(this,a),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a.prototype.uint8ArrayToUint32Array_=function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;4>d;d++)c[d]=b.getUint32(4*d);return c},a.prototype.initTable=function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;256>p;p++)128>p?m[p]=p<<1:m[p]=p<<1^283;for(p=0;256>p;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}},a.prototype.expandKey=function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f=this.ksRows=4*(e+6+1),g=void 0,h=void 0,i=this.keySchedule=new Uint32Array(f),j=this.invKeySchedule=new Uint32Array(f),k=this.sBox,l=this.rcon,m=this.invSubMix,n=m[0],o=m[1],p=m[2],q=m[3],r=void 0,s=void 0;for(g=0;f>g;g++)e>g?r=i[g]=b[g]:(s=r,g%e===0?(s=s<<8|s>>>24,s=k[s>>>24]<<24|k[s>>>16&255]<<16|k[s>>>8&255]<<8|k[255&s],s^=l[g/e|0]<<24):e>6&&g%e===4&&(s=k[s>>>24]<<24|k[s>>>16&255]<<16|k[s>>>8&255]<<8|k[255&s]),i[g]=r=(i[g-e]^s)>>>0);for(h=0;f>h;h++)g=f-h,s=3&h?i[g]:i[g-4],4>h||4>=g?j[h]=s:j[h]=n[k[s>>>24]]^o[k[s>>>16&255]]^p[k[s>>>8&255]]^q[k[255&s]],j[h]=j[h]>>>0}},a.prototype.networkToHostOrderSwap=function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24},a.prototype.decrypt=function(a,b,c){for(var d,e,f=this.keySize+6,g=this.invKeySchedule,h=this.invSBox,i=this.invSubMix,j=i[0],k=i[1],l=i[2],m=i[3],n=this.uint8ArrayToUint32Array_(c),o=n[0],p=n[1],q=n[2],r=n[3],s=new Int32Array(a),t=new Int32Array(s.length),u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0,F=void 0,G=this.networkToHostOrderSwap;b<s.length;){for(C=G(s[b]),D=G(s[b+1]),E=G(s[b+2]),F=G(s[b+3]),y=C^g[0],z=F^g[1],A=E^g[2],B=D^g[3],d=4,e=1;f>e;e++)u=j[y>>>24]^k[z>>16&255]^l[A>>8&255]^m[255&B]^g[d],v=j[z>>>24]^k[A>>16&255]^l[B>>8&255]^m[255&y]^g[d+1],w=j[A>>>24]^k[B>>16&255]^l[y>>8&255]^m[255&z]^g[d+2],x=j[B>>>24]^k[y>>16&255]^l[z>>8&255]^m[255&A]^g[d+3],y=u,z=v,A=w,B=x,d+=4;u=h[y>>>24]<<24^h[z>>16&255]<<16^h[A>>8&255]<<8^h[255&B]^g[d],v=h[z>>>24]<<24^h[A>>16&255]<<16^h[B>>8&255]<<8^h[255&y]^g[d+1],w=h[A>>>24]<<24^h[B>>16&255]<<16^h[y>>8&255]<<8^h[255&z]^g[d+2],x=h[B>>>24]<<24^h[y>>16&255]<<16^h[z>>8&255]<<8^h[255&A]^g[d+3],d+=3,t[b]=G(u^o),t[b+1]=G(x^p),t[b+2]=G(w^q),t[b+3]=G(v^r),o=C,p=D,q=E,r=F,b+=4}return t.buffer},a.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},a}(),m=l,n=c(2),o=c(0),p=function(){function a(b,c){g(this,a),this.observer=b,this.config=c,this.logEnabled=!0;try{var d=crypto?crypto:self.crypto;this.subtle=d.subtle||d.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return a.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},a.prototype.decrypt=function(a,b,c,d){var e=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(o.b.log("JS AES decrypt"),this.logEnabled=!1);var f=this.decryptor;f||(this.decryptor=f=new m),f.expandKey(b),d(f.decrypt(a,0,c))}else{this.logEnabled&&(o.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var g=this.subtle;this.key!==b&&(this.key=b,this.fastAesKey=new k(g,b)),this.fastAesKey.expandKey().then(function(f){var h=new i(g,c);h.decrypt(a,f)["catch"](function(f){e.onWebCryptoError(f,a,b,c,d)}).then(function(a){d(a)})})["catch"](function(f){e.onWebCryptoError(f,a,b,c,d)})}},a.prototype.onWebCryptoError=function(a,b,c,d,e){this.config.enableSoftwareAES?(o.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(b,c,d,e)):(o.b.error("decrypting error : "+a.message),this.observer.trigger(Event.ERROR,{type:n.b.MEDIA_ERROR,details:n.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))},a.prototype.destroy=function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)},a}();b.a=p},function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}a.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),c.apply(this,h)}else if(f(c))for(h=Array.prototype.slice.call(arguments,1),j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h);return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned&&(e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;if(b)return b.length}return 0},c.listenerCount=function(a,b){return a.listenerCount(b)}},function(a,b,c){!function(b){var c=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,d=/^([^\/;?#]*)(.*)$/,e=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,g={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),b=b.trim(),!b){if(!c.alwaysNormalize)return a;var e=this.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");return e.path=g.normalizePath(e.path),g.buildURLFromParts(e)}var f=this.parseURL(b);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=g.normalizePath(f.path),g.buildURLFromParts(f)):b;var h=this.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var i=d.exec(h.path);h.netLoc=i[1],h.path=i[2]}h.netLoc&&!h.path&&(h.path="/");var j={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(j.netLoc=h.netLoc,"/"!==f.path[0]))if(f.path){var k=h.path,l=k.substring(0,k.lastIndexOf("/")+1)+f.path;j.path=g.normalizePath(l)}else j.path=h.path,f.params||(j.params=h.params,f.query||(j.query=h.query));return null===j.path&&(j.path=c.alwaysNormalize?g.normalizePath(f.path):f.path),g.buildURLFromParts(j)},parseURL:function(a){var b=c.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(e,"");a.length!==(a=a.replace(f,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};a.exports=g}(this)},function(a,b,c){"use strict";function d(a,b,c,d){var e,f,g,h,i,j=navigator.userAgent.toLowerCase(),k=d,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return e=((192&b[c+2])>>>6)+1,f=(60&b[c+2])>>>2,f>l.length-1?void a.trigger(Event.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f}):(h=(1&b[c+2])<<2,h|=(192&b[c+3])>>>6,B.b.log("manifest codec:"+d+",ADTS data:type:"+e+",sampleingIndex:"+f+"["+l[f]+"Hz],channelConfig:"+h),/firefox/i.test(j)?f>=6?(e=5,i=new Array(4),g=f-3):(e=2,i=new Array(2),g=f):-1!==j.indexOf("android")?(e=2,i=new Array(2),g=f):(e=5,i=new Array(4),d&&(-1!==d.indexOf("mp4a.40.29")||-1!==d.indexOf("mp4a.40.5"))||!d&&f>=6?g=f-3:((d&&-1!==d.indexOf("mp4a.40.2")&&(f>=6&&1===h||/vivaldi/i.test(j))||!d&&1===h)&&(e=2,i=new Array(2)),g=f)),i[0]=e<<3,i[0]|=(14&f)>>1,i[1]|=(1&f)<<7,i[1]|=h<<3,5===e&&(i[1]|=(14&g)>>1,i[2]=(1&g)<<7,i[2]|=8,i[3]=0),{config:i,samplerate:l[f],channelCount:h,codec:"mp4a.40."+e,manifestCodec:k})}function e(a,b){return 255===a[b]&&240===(246&a[b+1])}function f(a,b){return 1&a[b+1]?7:9}function g(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5}function h(a,b){return b+1<a.length&&e(a,b)?!0:!1}function i(a,b){if(b+1<a.length&&e(a,b)){var c=f(a,b),d=c;b+5<a.length&&(d=g(a,b));var h=b+d;if(h===a.length||h+1<a.length&&e(a,h))return!0}return!1}function j(a,b,c,e,f){if(!a.samplerate){var g=d(b,c,e,f);a.config=g.config,a.samplerate=g.samplerate,a.channelCount=g.channelCount,a.codec=g.codec,a.manifestCodec=g.manifestCodec,B.b.log("parsed codec:"+a.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)}}function k(a){return 9216e4/a}function l(a,b,c,d,e){var h,i,j,k=a.length;return h=f(a,b),i=g(a,b),i-=h,i>0&&k>=b+h+i?(j=c+d*e,{headerLength:h,frameLength:i,stamp:j}):void 0}function m(a,b,c,d,e){var f=k(a.samplerate),g=l(b,c,d,e,f);if(g){var h=g.stamp,i=g.headerLength,j=g.frameLength,m={unit:b.subarray(c+i,c+i+j),pts:h,dts:h};return a.samples.push(m),a.len+=j,{sample:m,length:j+i}}return void 0}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function o(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function p(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function s(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function u(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function v(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function w(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function x(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var y=c(1),z=c(2),A=c(4),B=c(0),C=c(3),D=function(){function a(b,c,d){n(this,a),this.observer=b,this.config=d,this.remuxer=c}return a.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(a){if(!a)return!1;for(var b=C.a.getID3Data(a,0)||[],c=b.length,d=a.length;d>c;c++)if(i(a,c))return B.b.log("ADTS sync word found !"),!0;return!1},a.prototype.append=function(a,b,c,d){for(var e=this._audioTrack,f=C.a.getID3Data(a,0)||[],g=C.a.getTimeStamp(f),i=g?90*g:9e4*b,k=0,l=i,n=a.length,o=f.length,p=[{pts:l,dts:l,data:f}];n-1>o;)if(h(a,o)&&n>o+5){j(e,this.observer,a,o,e.manifestCodec);var q=m(e,a,o,i,k);if(!q){B.b.log("Unable to parse AAC frame");break}o+=q.length,l=q.sample.pts,k++}else C.a.isHeader(a,o)?(f=C.a.getID3Data(a,o),p.push({pts:l,dts:l,data:f}),o+=f.length):o++;this.remuxer.remux(e,{samples:[]},{samples:p,inputTimeScale:9e4},{samples:[]},b,c,d)},a.prototype.destroy=function(){},a}(),E=D,F=Math.pow(2,32)-1,G=function(){function a(b,c){o(this,a),this.observer=b,this.remuxer=c}return a.prototype.resetTimeStamp=function(a){this.initPTS=a},a.prototype.resetInitSegment=function(b,c,d,e){if(b&&b.byteLength){var f=this.initData=a.parseInitSegment(b);null==c&&(c="mp4a.40.5"),null==d&&(d="avc1.42e01e");var g={};f.audio&&f.video?g.audiovideo={container:"video/mp4",codec:c+","+d,initSegment:e?b:null}:(f.audio&&(g.audio={container:"audio/mp4",codec:c,initSegment:e?b:null}),f.video&&(g.video={container:"video/mp4",codec:d,initSegment:e?b:null})),this.observer.trigger(y.a.FRAG_PARSING_INIT_SEGMENT,{tracks:g})}else c&&(this.audioCodec=c),d&&(this.videoCodec=d)},a.probe=function(b){return a.findBox({data:b,start:0,end:Math.min(b.length,16384)},["moof"]).length>0},a.bin2str=function(a){return String.fromCharCode.apply(null,a)},a.readUint32=function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return 0>c?4294967296+c:c},a.writeUint32=function(a,b,c){a.data&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c},a.findBox=function(b,c){var d,e,f,g,h,i,j,k=[];if(b.data?(i=b.start,g=b.end,b=b.data):(i=0,g=b.byteLength),!c.length)return null;for(d=i;g>d;)e=a.readUint32(b,d),f=a.bin2str(b.subarray(d+4,d+8)),j=e>1?d+e:g,f===c[0]&&(1===c.length?k.push({data:b,start:d+8,end:j}):(h=a.findBox({data:b,start:d+8,end:j},c.slice(1)),h.length&&(k=k.concat(h)))),d=j;return k},a.parseInitSegment=function(b){var c=[],d=a.findBox(b,["moov","trak"]);return d.forEach(function(b){var d=a.findBox(b,["tkhd"])[0];if(d){var e=d.data[d.start],f=0===e?12:20,g=a.readUint32(d,f),h=a.findBox(b,["mdia","mdhd"])[0];if(h){e=h.data[h.start],f=0===e?12:20;var i=a.readUint32(h,f),j=a.findBox(b,["mdia","hdlr"])[0];if(j){var k=a.bin2str(j.data.subarray(j.start+8,j.start+12)),l={soun:"audio",vide:"video"}[k];if(l){var m=a.findBox(b,["mdia","minf","stbl","stsd"]);if(m.length){m=m[0];var n=a.bin2str(m.data.subarray(m.start+12,m.start+16));B.b.log("MP4Demuxer:"+l+":"+n+" found")}c[g]={timescale:i,type:l},c[l]={timescale:i,id:g}}}}}}),c},a.getStartDTS=function(b,c){var d,e,f;return d=a.findBox(c,["moof","traf"]),e=[].concat.apply([],d.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){var e,f,g;return e=a.readUint32(d,4),f=b[e].timescale||9e4,g=a.findBox(c,["tfdt"]).map(function(b){var c,d;return c=b.data[b.start],d=a.readUint32(b,4),1===c&&(d*=Math.pow(2,32),d+=a.readUint32(b,8)),d})[0],g/f})})),f=Math.min.apply(null,e),isFinite(f)?f:0},a.offsetStartDTS=function(b,c,d){a.findBox(c,["moof","traf"]).map(function(c){return a.findBox(c,["tfhd"]).map(function(e){var f=a.readUint32(e,4),g=b[f].timescale||9e4;a.findBox(c,["tfdt"]).map(function(b){var c=b.data[b.start],e=a.readUint32(b,4);if(0===c)a.writeUint32(b,4,e-d*g);else{e*=Math.pow(2,32),e+=a.readUint32(b,8),e-=d*g,e=Math.max(e,0);var f=Math.floor(e/(F+1)),h=Math.floor(e%(F+1));a.writeUint32(b,4,f),a.writeUint32(b,8,h)}})})})},a.prototype.append=function(b,c,d,e){var f=this.initData;f||(this.resetInitSegment(b,this.audioCodec,this.videoCodec),f=this.initData);var g=void 0,h=this.initPTS;if(void 0===h){var i=a.getStartDTS(f,b);this.initPTS=h=i-c,this.observer.trigger(y.a.INIT_PTS_FOUND,{initPTS:h})}a.offsetStartDTS(f,b,h),g=a.getStartDTS(f,b),this.remuxer.remux(f.audio,f.video,null,null,g,d,e,b)},a.prototype.destroy=function(){},a}(),H=G,I={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],appendFrame:function(a,b,c,d,e){if(c+24>b.length)return void 0;var f=this.parseHeader(b,c);if(f&&c+f.frameLength<=b.length){var g=10368e4/f.sampleRate,h=d+e*g,i={unit:b.subarray(c,c+f.frameLength),pts:h,dts:h};return a.config=[],a.channelCount=f.channelCount,a.samplerate=f.sampleRate,a.samples.push(i),a.len+=f.frameLength,{sample:i,length:f.frameLength}}return void 0},parseHeader:function(a,b){var c=a[b+1]>>3&3,d=a[b+1]>>1&3,e=a[b+2]>>4&15,f=a[b+2]>>2&3,g=!!(2&a[b+2]);if(1!==c&&0!==e&&15!==e&&3!==f){var h=3===c?3-d:3===d?3:4,i=1e3*I.BitratesMap[14*h+e-1],j=3===c?0:2===c?1:2,k=I.SamplingRateMap[3*j+f],l=g?1:0,m=a[b+3]>>6===3?1:2,n=3===d?(3===c?12:6)*i/k+l<<2:(3===c?144:72)*i/k+l|0;return{sampleRate:k,channelCount:m,frameLength:n}}return void 0},isHeaderPattern:function(a,b){return 255===a[b]&&224===(224&a[b+1])&&0!==(6&a[b+1])},isHeader:function(a,b){return b+1<a.length&&this.isHeaderPattern(a,b)?!0:!1},probe:function(a,b){if(b+1<a.length&&this.isHeaderPattern(a,b)){var c=4,d=this.parseHeader(a,b),e=c;d&&d.frameLength&&(e=d.frameLength);var f=b+e;if(f===a.length||f+1<a.length&&this.isHeaderPattern(a,f))return!0}return!1}},J=I,K=function(){function a(b){p(this,a),this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}return a.prototype.loadWord=function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},a.prototype.skipBits=function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)},a.prototype.readBits=function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&B.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c},a.prototype.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()},a.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1},a.prototype.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)},a.prototype.readBoolean=function(){return 1===this.readBits(1)},a.prototype.readUByte=function(){return this.readBits(8)},a.prototype.readUShort=function(){return this.readBits(16)},a.prototype.readUInt=function(){return this.readBits(32)},a.prototype.skipScalingList=function(a){var b,c,d=8,e=8;for(b=0;a>b;b++)0!==e&&(c=this.readEG(),e=(d+c+256)%256),d=0===e?d:e},a.prototype.readSPS=function(){var a,b,c,d,e,f,g,h,i,j=0,k=0,l=0,m=0,n=this.readUByte.bind(this),o=this.readBits.bind(this),p=this.readUEG.bind(this),q=this.readBoolean.bind(this),r=this.skipBits.bind(this),s=this.skipEG.bind(this),t=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);if(n(),a=n(),b=o(5),r(3),c=n(),t(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var v=p();if(3===v&&r(1),t(),t(),r(1),q())for(h=3!==v?8:12,i=0;h>i;i++)q()&&u(6>i?16:64)}t();var w=p();if(0===w)p();else if(1===w)for(r(1),s(),s(),d=p(),i=0;d>i;i++)s();t(),r(1),e=p(),f=p(),g=o(1),0===g&&r(1),r(1),q()&&(j=p(),k=p(),l=p(),m=p());var x=[1,1];if(q()&&q()){var y=n();switch(y){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[n()<<8|n(),n()<<8|n()]}}return{width:Math.ceil(16*(e+1)-2*j-2*k),height:(2-g)*(f+1)*16-(g?2:4)*(l+m),pixelRatio:x}},a.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a}(),L=K,M=function(){function a(b,c,d,e){q(this,a),this.decryptdata=d,this.discardEPB=e,this.decrypter=new A.a(b,c)}return a.prototype.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)},a.prototype.decryptAacSample=function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){f=new Uint8Array(f),e.set(f,16),d||h.decryptAacSamples(a,b+1,c)})},a.prototype.decryptAacSamples=function(a,b,c){for(;;b++){if(b>=a.length)return void c();if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}},a.prototype.getAvcEncryptedData=function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c},a.prototype.getAvcDecryptedUnit=function(a,b){b=new Uint8Array(b);for(var c=0,d=32;d<=a.length-16;d+=160,c+=16)a.set(b.subarray(c,c+16),d);return a},a.prototype.decryptAvcSample=function(a,b,c,d,e,f){var g=this.discardEPB(e.data),h=this.getAvcEncryptedData(g),i=this;this.decryptBuffer(h.buffer,function(h){e.data=i.getAvcDecryptedUnit(g,h),f||i.decryptAvcSamples(a,b,c+1,d)})},a.prototype.decryptAvcSamples=function(a,b,c,d){for(;;b++,c=0){if(b>=a.length)return void d();for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.length<=48||1!==f.type&&5!==f.type)){
var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}},a}(),N=M,O={video:0,audio:1,id3:2,text:3},P=function(){function a(b,c,d,e){r(this,a),this.observer=b,this.config=d,this.typeSupported=e,this.remuxer=c,this.sampleAes=null}return a.prototype.setDecryptData=function(a){null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?this.sampleAes=new N(this.observer,this.config,a,this.discardEPB):this.sampleAes=null},a.probe=function(b){var c=a._syncOffset(b);return 0>c?!1:(c&&B.b.warn("MPEG2-TS detected but first sync word found @ offset "+c+", junk ahead ?"),!0)},a._syncOffset=function(a){for(var b=Math.min(1e3,a.length-564),c=0;b>c;){if(71===a[c]&&71===a[c+188]&&71===a[c+376])return c;c++}return-1},a.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:O[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===a?0:void 0,isAAC:"audio"===a?!0:void 0,duration:"audio"===a?b:void 0}},a.prototype.resetInitSegment=function(b,c,d,e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",e),this._audioTrack=a.createTrack("audio",e),this._id3Track=a.createTrack("id3",e),this._txtTrack=a.createTrack("text",e),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=d,this._duration=e},a.prototype.resetTimeStamp=function(){},a.prototype.append=function(b,c,d,e){var f,g,h,i,j,k,l=b.length,m=!1;this.contiguous=d;var n=this.pmtParsed,o=this._avcTrack,p=this._audioTrack,q=this._id3Track,r=o.pid,s=p.pid,t=q.pid,u=this._pmtId,v=o.pesData,w=p.pesData,x=q.pesData,A=this._parsePAT,C=this._parsePMT,D=this._parsePES,E=this._parseAVCPES.bind(this),F=this._parseAACPES.bind(this),G=this._parseMPEGPES.bind(this),H=this._parseID3PES.bind(this),I=a._syncOffset(b);for(l-=(l+I)%188,f=I;l>f;f+=188)if(71===b[f]){if(g=!!(64&b[f+1]),h=((31&b[f+1])<<8)+b[f+2],i=(48&b[f+3])>>4,i>1){if(j=f+5+b[f+4],j===f+188)continue}else j=f+4;switch(h){case r:g&&(v&&(k=D(v))&&E(k,!1),v={data:[],size:0}),v&&(v.data.push(b.subarray(j,f+188)),v.size+=f+188-j);break;case s:g&&(w&&(k=D(w))&&(p.isAAC?F(k):G(k)),w={data:[],size:0}),w&&(w.data.push(b.subarray(j,f+188)),w.size+=f+188-j);break;case t:g&&(x&&(k=D(x))&&H(k),x={data:[],size:0}),x&&(x.data.push(b.subarray(j,f+188)),x.size+=f+188-j);break;case 0:g&&(j+=b[j]+1),u=this._pmtId=A(b,j);break;case u:g&&(j+=b[j]+1);var J=C(b,j,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,null!=this.sampleAes);r=J.avc,r>0&&(o.pid=r),s=J.audio,s>0&&(p.pid=s,p.isAAC=J.isAAC),t=J.id3,t>0&&(q.pid=t),m&&!n&&(B.b.log("reparse from beginning"),m=!1,f=I-188),n=this.pmtParsed=!0;break;case 17:case 8191:break;default:m=!0}}else this.observer.trigger(y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});v&&(k=D(v))?(E(k,!0),o.pesData=null):o.pesData=v,w&&(k=D(w))?(p.isAAC?F(k):G(k),p.pesData=null):(w&&w.size&&B.b.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=w),x&&(k=D(x))?(H(k),q.pesData=null):q.pesData=x,null==this.sampleAes?this.remuxer.remux(p,o,q,this._txtTrack,c,d,e):this.decryptAndRemux(p,o,q,this._txtTrack,c,d,e)},a.prototype.decryptAndRemux=function(a,b,c,d,e,f,g){if(a.samples&&a.isAAC){var h=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){h.decryptAndRemuxAvc(a,b,c,d,e,f,g)})}else this.decryptAndRemuxAvc(a,b,c,d,e,f,g)},a.prototype.decryptAndRemuxAvc=function(a,b,c,d,e,f,g){if(b.samples){var h=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){h.remuxer.remux(a,b,c,d,e,f,g)})}else this.remuxer.remux(a,b,c,d,e,f,g)},a.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},a.prototype._parsePAT=function(a,b){return(31&a[b+10])<<8|a[b+11]},a.prototype._parsePMT=function(a,b,c,d){var e,f,g,h,i={audio:-1,avc:-1,id3:-1,isAAC:!0};for(e=(15&a[b+1])<<8|a[b+2],f=b+3+e-4,g=(15&a[b+10])<<8|a[b+11],b+=12+g;f>b;){switch(h=(31&a[b+1])<<8|a[b+2],a[b]){case 207:if(!d){B.b.log("unkown stream type:"+a[b]);break}case 15:-1===i.audio&&(i.audio=h);break;case 21:-1===i.id3&&(i.id3=h);break;case 219:if(!d){B.b.log("unkown stream type:"+a[b]);break}case 27:-1===i.avc&&(i.avc=h);break;case 3:case 4:c?-1===i.audio&&(i.audio=h,i.isAAC=!1):B.b.log("MPEG audio found, not supported in this browser for now");break;case 36:B.b.warn("HEVC stream type found, not supported for now");break;default:B.b.log("unkown stream type:"+a[b])}b+=((15&a[b+3])<<8|a[b+4])+5}return i},a.prototype._parsePES=function(a){var b,c,d,e,f,g,h,i,j,k=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;){var m=new Uint8Array(l[0].length+l[1].length);m.set(l[0]),m.set(l[1],l[0].length),l[0]=m,l.splice(1,1)}if(b=l[0],d=(b[0]<<16)+(b[1]<<8)+b[2],1===d){if(e=(b[4]<<8)+b[5],e&&e>a.size-6)return null;c=b[7],192&c&&(h=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,h>4294967295&&(h-=8589934592),64&c?(i=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,i>4294967295&&(i-=8589934592),h-i>54e5&&(B.b.warn(Math.round((h-i)/9e4)+"s delta between PTS and DTS, align them"),h=i)):i=h),f=b[8],j=f+9,a.size-=j,g=new Uint8Array(a.size);for(var n=0,o=l.length;o>n;n++){b=l[n];var p=b.byteLength;if(j){if(j>p){j-=p;continue}b=b.subarray(j),p-=j,j=0}g.set(b,k),k+=p}return e&&(e-=f+3),{data:g,pts:h,dts:i,len:e}}return null},a.prototype.pushAccesUnit=function(a,b){if(a.units.length&&a.frame){var c=b.samples,d=c.length;!this.config.forceKeyFrameOnDiscontinuity||a.key===!0||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++}a.debug.length&&B.b.log(a.pts+"/"+a.dts+":"+a.debug)},a.prototype._parseAVCPES=function(a,b){var c,d,e,f=this,g=this._avcTrack,h=this._parseAVCNALu(a.data),i=!1,j=this.avcSample,k=!1,l=this.pushAccesUnit.bind(this),m=function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}};a.data=null,j&&h.length&&!g.audFound&&(l(j,g),j=this.avcSample=m(!1,a.pts,a.dts,"")),h.forEach(function(b){switch(b.type){case 1:d=!0,j||(j=f.avcSample=m(!0,a.pts,a.dts,"")),i&&(j.debug+="NDR "),j.frame=!0;var h=b.data;if(k&&h.length>4){var n=new L(h).readSliceType();(2===n||4===n||7===n||9===n)&&(j.key=!0)}break;case 5:d=!0,j||(j=f.avcSample=m(!0,a.pts,a.dts,"")),i&&(j.debug+="IDR "),j.key=!0,j.frame=!0;break;case 6:d=!0,i&&j&&(j.debug+="SEI "),c=new L(f.discardEPB(b.data)),c.readUByte();for(var o=0,p=0,q=!1,r=0;!q&&c.bytesAvailable>1;){o=0;do r=c.readUByte(),o+=r;while(255===r);p=0;do r=c.readUByte(),p+=r;while(255===r);if(4===o&&0!==c.bytesAvailable){q=!0;var s=c.readUByte();if(181===s){var t=c.readUShort();if(49===t){var u=c.readUInt();if(1195456820===u){var v=c.readUByte();if(3===v){var w=c.readUByte(),x=c.readUByte(),y=31&w,z=[w,x];for(e=0;y>e;e++)z.push(c.readUByte()),z.push(c.readUByte()),z.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:z})}}}}}else if(p<c.bytesAvailable)for(e=0;p>e;e++)c.readUByte()}break;case 7:if(d=!0,k=!0,i&&j&&(j.debug+="SPS "),!g.sps){c=new L(b.data);var A=c.readSPS();g.width=A.width,g.height=A.height,g.pixelRatio=A.pixelRatio,g.sps=[b.data],g.duration=f._duration;var B=b.data.subarray(1,4),C="avc1.";for(e=0;3>e;e++){var D=B[e].toString(16);D.length<2&&(D="0"+D),C+=D}g.codec=C}break;case 8:d=!0,i&&j&&(j.debug+="PPS "),g.pps||(g.pps=[b.data]);break;case 9:d=!1,g.audFound=!0,j&&l(j,g),j=f.avcSample=m(!1,a.pts,a.dts,i?"AUD ":"");break;case 12:d=!1;break;default:d=!1,j&&(j.debug+="unknown NAL "+b.type+" ")}if(j&&d){var E=j.units;E.push(b)}}),b&&j&&(l(j,g),this.avcSample=null)},a.prototype._insertSampleInOrder=function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)},a.prototype._getLastNalUnit=function(){var a=this.avcSample,b=void 0;if(!a||0===a.units.length){var c=this._avcTrack,d=c.samples;a=d[d.length-1]}if(a){var e=a.units;b=e[e.length-1]}return b},a.prototype._parseAVCNALu=function(a){var b,c,d,e,f,g=0,h=a.byteLength,i=this._avcTrack,j=i.naluState||0,k=j,l=[],m=-1;for(-1===j&&(m=0,f=31&a[0],j=0,g=1);h>g;)if(b=a[g++],j)if(1!==j)if(b)if(1===b){if(m>=0)d={data:a.subarray(m,g-j-1),type:f},l.push(d);else{var n=this._getLastNalUnit();if(n&&(k&&4-k>=g&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-k)),c=g-j-1,c>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}h>g?(e=31&a[g],m=g,f=e,j=0):j=-1}else j=0;else j=3;else j=b?0:2;else j=b?0:1;if(m>=0&&j>=0&&(d={data:a.subarray(m,h),type:f,state:j},l.push(d)),0===l.length){var p=this._getLastNalUnit();if(p){var q=new Uint8Array(p.data.byteLength+a.byteLength);q.set(p.data,0),q.set(a,p.data.byteLength),p.data=q}}return i.naluState=j,l},a.prototype.discardEPB=function(a){for(var b,c,d=a.byteLength,e=[],f=1;d-2>f;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;b>f;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c},a.prototype._parseAACPES=function(a){var b,c,d,e,f,g=this._audioTrack,i=a.data,l=a.pts,n=0,o=this.aacOverFlow,p=this.aacLastPTS;if(o){var q=new Uint8Array(o.byteLength+i.byteLength);q.set(o,0),q.set(i,o.byteLength),i=q}for(d=n,f=i.length;f-1>d&&!h(i,d);d++);if(d){var r,s;if(f-1>d?(r="AAC PES did not start with ADTS header,offset:"+d,s=!1):(r="no ADTS header found in AAC PES",s=!0),B.b.warn("parsing error:"+r),this.observer.trigger(y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:s,reason:r}),s)return}if(j(g,this.observer,i,d,this.audioCodec),c=0,b=k(g.samplerate),o&&p){var t=p+b;Math.abs(t-l)>1&&(B.b.log("AAC: align PTS for overlapping frames by "+Math.round((t-l)/90)),l=t)}for(;f>d;)if(h(i,d)&&f>d+5){var u=m(g,i,d,l,c);if(!u)break;d+=u.length,e=u.sample.pts,c++}else d++;o=f>d?i.subarray(d,f):null,this.aacOverFlow=o,this.aacLastPTS=e},a.prototype._parseMPEGPES=function(a){for(var b=a.data,c=b.length,d=0,e=0,f=a.pts;c>e;)if(J.isHeader(b,e)){var g=J.appendFrame(this._audioTrack,b,e,f,d);if(!g)break;e+=g.length,d++}else e++},a.prototype._parseID3PES=function(a){this._id3Track.samples.push(a)},a}(),Q=P,R=function(){function a(b,c,d){s(this,a),this.observer=b,this.config=d,this.remuxer=c}return a.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(a){var b,c,d=C.a.getID3Data(a,0);if(d&&void 0!==C.a.getTimeStamp(d))for(b=d.length,c=Math.min(a.length-1,b+100);c>b;b++)if(J.probe(a,b))return B.b.log("MPEG Audio sync word found !"),!0;return!1},a.prototype.append=function(a,b,c,d){for(var e=C.a.getID3Data(a,0),f=90*C.a.getTimeStamp(e),g=e.length,h=a.length,i=0,j=0,k=this._audioTrack,l=[{pts:f,dts:f,data:e}];h>g;)if(J.isHeader(a,g)){var m=J.appendFrame(k,a,g,f,i);if(!m)break;g+=m.length,j=m.sample.pts,i++}else C.a.isHeader(a,g)?(e=C.a.getID3Data(a,g),l.push({pts:j,dts:j,data:e}),g+=e.length):g++;this.remuxer.remux(k,{samples:[]},{samples:l,inputTimeScale:9e4},{samples:[]},b,c,d)},a.prototype.destroy=function(){},a}(),S=R,T=function(){function a(){t(this,a)}return a.getSilentFrame=function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},a}(),U=T,V=Math.pow(2,32)-1,W=function(){function a(){u(this,a)}return a.init=function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(b=new Uint8Array(d),b[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;f>e;e++)b.set(c[e],d),d+=c[e].byteLength;return b},a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])},a.mdat=function(b){return a.box(a.types.mdat,b)},a.mdhd=function(b,c){c*=b;var d=Math.floor(c/(V+1)),e=Math.floor(c%(V+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))},a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))},a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))},a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))},a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))},a.mvex=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))},a.mvhd=function(b,c){c*=b;var d=Math.floor(c/(V+1)),e=Math.floor(c%(V+1)),f=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,f)},a.sdtp=function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))},a.esds=function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))},a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))},a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},a.stsd=function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))},a.tkhd=function(b){var c=b.id,d=b.duration*b.timescale,e=b.width,f=b.height,g=Math.floor(d/(V+1)),h=Math.floor(d%(V+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,f>>8&255,255&f,0,0]))},a.traf=function(b,c){var d=a.sdtp(b),e=b.id,f=Math.floor(c/(V+1)),g=Math.floor(c%(V+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,f>>24,f>>16&255,f>>8&255,255&f,g>>24,g>>16&255,g>>8&255,255&g])),a.trun(b,d.length+16+20+8+16+8+8),d)},a.trak=function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.trex=function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;k>d;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)},a.initSegment=function(b){a.types||a.init();var c,d=a.moov(b);return c=new Uint8Array(a.FTYP.byteLength+d.byteLength),c.set(a.FTYP),c.set(d,a.FTYP.byteLength),c},a}(),X=W,Y=1e4,Z=function(){function a(b,c,d,e){v(this,a),this.observer=b,this.config=c,this.typeSupported=d;var f=navigator.userAgent;this.isSafari=e&&e.indexOf("Apple")>-1&&f&&!f.match("CriOS"),this.ISGenerated=!1}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(a){this._initPTS=this._initDTS=a},a.prototype.resetInitSegment=function(){this.ISGenerated=!1},a.prototype.remux=function(a,b,c,d,e,f,g){if(this.ISGenerated||this.generateIS(a,b,e),this.ISGenerated){var h=a.samples.length,i=b.samples.length,j=e,k=e;if(h&&i){var l=(a.samples[0].dts-b.samples[0].dts)/b.inputTimeScale;j+=Math.max(0,l),k+=Math.max(0,-l)}if(h){a.timescale||(B.b.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e));var m=this.remuxAudio(a,j,f,g);if(i){var n=void 0;m&&(n=m.endPTS-m.startPTS),b.timescale||(B.b.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e)),this.remuxVideo(b,k,f,n,g)}}else{var o=void 0;i&&(o=this.remuxVideo(b,k,f,g)),o&&a.codec&&this.remuxEmptyAudio(a,j,f,o)}}c.samples.length&&this.remuxID3(c,e),d.samples.length&&this.remuxText(d,e),this.observer.trigger(y.a.FRAG_PARSED)},a.prototype.generateIS=function(a,b,c){var d,e,f=this.observer,g=a.samples,h=b.samples,i=this.typeSupported,j="audio/mp4",k={},l={tracks:k},m=void 0===this._initPTS;if(m&&(d=e=1/0),a.config&&g.length&&(a.timescale=a.samplerate,B.b.log("audio sampling rate : "+a.samplerate),a.isAAC||(i.mpeg?(j="audio/mpeg",a.codec=""):i.mp3&&(a.codec="mp3")),k.audio={container:j,codec:a.codec,initSegment:!a.isAAC&&i.mpeg?new Uint8Array:X.initSegment([a]),metadata:{channelCount:a.channelCount}},m&&(d=e=g[0].pts-a.inputTimeScale*c)),b.sps&&b.pps&&h.length){var n=b.inputTimeScale;b.timescale=n,k.video={container:"video/mp4",codec:b.codec,initSegment:X.initSegment([b]),metadata:{width:b.width,height:b.height}},m&&(d=Math.min(d,h[0].pts-n*c),e=Math.min(e,h[0].dts-n*c),this.observer.trigger(y.a.INIT_PTS_FOUND,{initPTS:d}))}Object.keys(k).length?(f.trigger(y.a.FRAG_PARSING_INIT_SEGMENT,l),this.ISGenerated=!0,m&&(this._initPTS=d,this._initDTS=e)):f.trigger(y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},a.prototype.remuxVideo=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n=8,o=a.timescale,p=a.samples,q=[],r=p.length,s=this._PTSNormalize,t=this._initDTS,u=this.nextAvcDts,v=this.isSafari;v&&(c|=p.length&&u&&(e&&Math.abs(b-u/o)<.1||Math.abs(p[0].pts-u-t)<o/5)),c||(u=b*o),p.forEach(function(a){a.pts=s(a.pts-t,u),a.dts=s(a.dts-t,u)}),p.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c?c:d?d:a.id-b.id});var w=p.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(0>w){B.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(w/90)+" ms to overcome this issue");for(var x=0;x<p.length;x++)p[x].dts+=w}var A=p[0];j=Math.max(A.dts,0),i=Math.max(A.pts,0);var C=Math.round((j-u)/90);c&&C&&(C>1?B.b.log("AVC:"+C+" ms hole between fragments detected,filling it"):-1>C&&B.b.log("AVC:"+-C+" ms overlapping between fragments detected"),j=u,p[0].dts=j,i=Math.max(i-C,u),p[0].pts=i,B.b.log("Video/PTS/DTS adjusted: "+Math.round(i/90)+"/"+Math.round(j/90)+",delta:"+C+" ms")),k=j,A=p[p.length-1],m=Math.max(A.dts,0),l=Math.max(A.pts,0,m),v&&(f=Math.round((m-j)/(p.length-1)));for(var D=0,E=0,F=0;r>F;F++){for(var G=p[F],H=G.units,I=H.length,J=0,K=0;I>K;K++)J+=H[K].data.length;E+=J,D+=I,G.length=J,v?G.dts=j+F*f:G.dts=Math.max(G.dts,j),G.pts=Math.max(G.pts,G.dts)}var L=E+4*D+8;try{g=new Uint8Array(L)}catch(M){return void this.observer.trigger(y.a.ERROR,{type:z.b.MUX_ERROR,details:z.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:L,reason:"fail allocating video mdat "+L})}var N=new DataView(g.buffer);N.setUint32(0,L),g.set(X.types.mdat,4);for(var O=0;r>O;O++){for(var P=p[O],Q=P.units,R=0,S=void 0,T=0,U=Q.length;U>T;T++){var V=Q[T],W=V.data,Y=V.data.byteLength;N.setUint32(n,Y),n+=4,g.set(W,n),n+=Y,R+=4+Y}if(v)S=Math.max(0,f*Math.round((P.pts-P.dts)/f));else{if(r-1>O)f=p[O+1].dts-P.dts;else{var Z=this.config,$=P.dts-p[O>0?O-1:O].dts;if(Z.stretchShortVideoTrack){var _=Z.maxBufferHole,aa=Z.maxSeekHole,ba=Math.floor(Math.min(_,aa)*o),ca=(d?i+d*o:this.nextAudioPts)-P.pts;ca>ba?(f=ca-$,0>f&&(f=$),B.b.log("It is approximately "+ca/90+" ms to the next segment; using duration "+f/90+" ms for the last video frame.")):f=$}else f=$}S=Math.round(P.pts-P.dts)}q.push({size:R,duration:f,cts:S,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:P.key?2:1,isNonSync:P.key?0:1}})}this.nextAvcDts=m+f;var da=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,q.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ea=q[0].flags;ea.dependsOn=2,ea.isNonSync=0}a.samples=q,h=X.moof(a.sequenceNumber++,j,a),a.samples=[];var fa={data1:h,data2:g,startPTS:i/o,endPTS:(l+f)/o,startDTS:j/o,endDTS:this.nextAvcDts/o,type:"video",nb:q.length,dropped:da};return this.observer.trigger(y.a.FRAG_PARSING_DATA,fa),fa},a.prototype.remuxAudio=function(a,b,c,d){var e,f,g,h,i,j,k,l=a.inputTimeScale,m=a.timescale,n=l/m,o=a.isAAC?1024:1152,p=o*n,q=this._PTSNormalize,r=this._initDTS,s=!a.isAAC&&this.typeSupported.mpeg,t=a.samples,u=[],v=this.nextAudioPts;if(c|=t.length&&v&&(d&&Math.abs(b-v/l)<.1||Math.abs(t[0].pts-v-r)<20*p),c||(v=b*l),t.forEach(function(a){a.pts=a.dts=q(a.pts-r,v)}),t.sort(function(a,b){return a.pts-b.pts}),d&&a.isAAC)for(var w=this.config.maxAudioFramesDrift,x=0,A=v;x<t.length;){var C,D=t[x],E=D.pts;C=E-A;var F=Math.abs(1e3*C/l);if(-w*p>=C)B.b.warn("Dropping 1 audio frame @ "+(A/l).toFixed(3)+"s due to "+Math.round(F)+" ms overlap."),t.splice(x,1),a.len-=D.unit.length;else if(C>=w*p&&Y>F&&A){var G=Math.round(C/p);B.b.warn("Injecting "+G+" audio frame @ "+(A/l).toFixed(3)+"s due to "+Math.round(1e3*C/l)+" ms gap.");for(var H=0;G>H;H++){var I=Math.max(A,0);g=U.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),g||(B.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),g=D.unit.subarray()),t.splice(x,0,{unit:g,pts:I,dts:I}),a.len+=g.length,A+=p,x++}D.pts=D.dts=A,A+=p,x++}else Math.abs(C)>.1*p,D.pts=D.dts=A,A+=p,x++}for(var J=0,K=t.length;K>J;J++){var L=t[J],M=L.unit,N=L.pts;if(void 0!==k)f.duration=Math.round((N-k)/n);else{var O=Math.round(1e3*(N-v)/l),P=0;if(c&&a.isAAC&&O){if(O>0&&Y>O)P=Math.round((N-v)/p),B.b.log(O+" ms hole between AAC samples detected,filling it"),P>0&&(g=U.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),g||(g=M.subarray()),a.len+=P*g.length);else if(-12>O){B.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(v/l).toFixed(3)+"s/"+(N/l).toFixed(3)+"s/"+-O+"ms"),a.len-=M.byteLength;continue}N=v}if(j=Math.max(0,N),!(a.len>0))return;var Q=s?a.len:a.len+8;e=s?0:8;try{h=new Uint8Array(Q)}catch(R){return void this.observer.trigger(y.a.ERROR,{type:z.b.MUX_ERROR,details:z.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:Q,reason:"fail allocating audio mdat "+Q})}if(!s){var S=new DataView(h.buffer);S.setUint32(0,Q),h.set(X.types.mdat,4)}for(var T=0;P>T;T++)g=U.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),g||(B.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),g=M.subarray()),h.set(g,e),e+=g.byteLength,f={size:g.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},u.push(f)}h.set(M,e);var V=M.byteLength;e+=V,f={size:V,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},u.push(f),k=N}var W=0,Z=u.length;if(Z>=2&&(W=u[Z-2].duration,f.duration=W),Z){this.nextAudioPts=v=k+n*W,a.len=0,a.samples=u,i=s?new Uint8Array:X.moof(a.sequenceNumber++,j/n,a),a.samples=[];var $=j/l,_=v/l,aa={data1:i,data2:h,startPTS:$,endPTS:_,startDTS:$,endDTS:_,type:"audio",nb:Z};return this.observer.trigger(y.a.FRAG_PARSING_DATA,aa),aa}return null},a.prototype.remuxEmptyAudio=function(a,b,c,d){var e=a.inputTimeScale,f=a.samplerate?a.samplerate:e,g=e/f,h=this.nextAudioPts,i=(void 0!==h?h:d.startDTS*e)+this._initDTS,j=d.endDTS*e+this._initDTS,k=1024,l=g*k,m=Math.ceil((j-i)/l),n=U.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(B.b.warn("remux empty Audio"),!n)return void B.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var o=[],p=0;m>p;p++){var q=i+p*l;o.push({unit:n,pts:q,dts:q}),a.len+=n.length}a.samples=o,this.remuxAudio(a,b,c)},a.prototype.remuxID3=function(a,b){var c,d=a.samples.length,e=a.inputTimeScale,f=this._initPTS,g=this._initDTS;if(d){for(var h=0;d>h;h++)c=a.samples[h],c.pts=(c.pts-f)/e,c.dts=(c.dts-g)/e;this.observer.trigger(y.a.FRAG_PARSING_METADATA,{samples:a.samples})}a.samples=[],b=b},a.prototype.remuxText=function(a,b){a.samples.sort(function(a,b){return a.pts-b.pts});var c,d=a.samples.length,e=a.inputTimeScale,f=this._initPTS;if(d){for(var g=0;d>g;g++)c=a.samples[g],c.pts=(c.pts-f)/e;this.observer.trigger(y.a.FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=[],b=b},a.prototype._PTSNormalize=function(a,b){var c;if(void 0===b)return a;for(c=a>b?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a},a}(),$=Z,_=function(){function a(b){w(this,a),this.observer=b}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(){},a.prototype.resetInitSegment=function(){},a.prototype.remux=function(a,b,c,d,e,f,g,h){var i=this.observer,j="";a&&(j+="audio"),b&&(j+="video"),i.trigger(y.a.FRAG_PARSING_DATA,{data1:h,startPTS:e,startDTS:e,type:j,nb:1,dropped:0}),i.trigger(y.a.FRAG_PARSED)},a}(),aa=_,ba=function(){function a(b,c,d,e){x(this,a),this.observer=b,this.typeSupported=c,this.config=d,this.vendor=e}return a.prototype.destroy=function(){var a=this.demuxer;a&&a.destroy()},a.prototype.push=function(a,b,c,d,e,f,g,h,i,j,k,l){if(a.byteLength>0&&null!=b&&null!=b.key&&"AES-128"===b.method){var m=this.decrypter;null==m&&(m=this.decrypter=new A.a(this.observer,this.config));var n,o=this;try{n=performance.now()}catch(p){n=Date.now()}m.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var m;try{m=performance.now()}catch(p){m=Date.now()}o.observer.trigger(y.a.FRAG_DECRYPTED,{stats:{tstart:n,tdecrypt:m}}),o.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,g,h,i,j,k,l)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,g,h,i,j,k,l)},a.prototype.pushDecrypted=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=this.demuxer;if(!m||g&&!this.probe(a)){for(var n=this.observer,o=this.typeSupported,p=this.config,q=[{demux:Q,remux:$},{demux:E,remux:$},{demux:S,remux:$},{demux:H,remux:aa}],r=0,s=q.length;s>r;r++){var t=q[r],u=t.demux.probe;if(u(a)){var v=this.remuxer=new t.remux(n,p,o,this.vendor);m=new t.demux(n,v,p,o),this.probe=u;break}}if(!m)return void n.trigger(y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=m}var w=this.remuxer;(g||h)&&(m.resetInitSegment(c,d,e,j),w.resetInitSegment()),g&&(m.resetTimeStamp(l),w.resetTimeStamp(l)),"function"==typeof m.setDecryptData&&m.setDecryptData(b),m.append(a,f,i,k)},a}();b.a=ba},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){var c=Oa[b];return!!c&&c[a.slice(0,4)]===!0}function g(a,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}function h(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function i(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){if(!a)return null;for(var c=null,d=0;d<a.length;d++){var e=a[d];e.id===b&&(c=e)}return c}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function o(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function p(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function q(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(){return"undefined"!=typeof window?window.MediaSource||window.WebKitMediaSource:void 0}function s(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function t(a,b,c){var d=a[b],e=a[c],f=e.startPTS;isNaN(f)?c>b?e.start=d.start+d.duration:e.start=Math.max(d.start-e.duration,0):c>b?(d.duration=f-d.start,d.duration<0&&Ga.b.warn("negative duration computed for frag "+d.sn+",level "+d.level+", there should be some duration drift between playlist and fragment!")):(e.duration=d.start-f,e.duration<0&&Ga.b.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!"))}function u(a,b,c,d,e,f){var g=c;if(!isNaN(b.startPTS)){var h=Math.abs(b.startPTS-c);isNaN(b.deltaPTS)?b.deltaPTS=h:b.deltaPTS=Math.max(h,b.deltaPTS),g=Math.max(c,b.startPTS),c=Math.min(c,b.startPTS),d=Math.max(d,b.endPTS),e=Math.min(e,b.startDTS),f=Math.max(f,b.endDTS)}var i=c-b.start;b.start=b.startPTS=c,b.maxStartPTS=g,b.endPTS=d,b.startDTS=e,b.endDTS=f,b.duration=d-c;var j=b.sn;if(!a||j<a.startSN||j>a.endSN)return 0;var k,l,m;for(k=j-a.startSN,l=a.fragments,l[k]=b,m=k;m>0;m--)t(l,m,m-1);for(m=k;m<l.length-1;m++)t(l,m,m+1);return a.PTSKnown=!0,i}function v(a,b){var c,d=Math.max(a.startSN,b.startSN)-b.startSN,e=Math.min(a.endSN,b.endSN)-b.startSN,f=b.startSN-a.startSN,g=a.fragments,h=b.fragments,i=0;if(d>e)return void(b.PTSKnown=!1);for(var j=d;e>=j;j++){var k=g[f+j],l=h[j];l&&k&&(i=k.cc-l.cc,isNaN(k.startPTS)||(l.start=l.startPTS=k.startPTS,l.endPTS=k.endPTS,l.duration=k.duration,l.backtracked=k.backtracked,l.dropped=k.dropped,c=l))}if(i)for(Ga.b.log("discontinuity sliding from playlist, take drift into account"),j=0;j<h.length;j++)h[j].cc+=i;if(c)u(b,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS);else if(f>=0&&f<g.length){var m=g[f].start;for(j=0;j<h.length;j++)h[j].start+=m}b.PTSKnown=a.PTSKnown}function w(a,b){for(var c=null,d=0;d<a.length;d+=1){var e=a[d];if(e&&e.cc===b){c=e;break}}return c}function x(a,b){return bb.search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}function y(a,b,c){var d=!1;return b&&b.details&&c&&(c.endCC>c.startCC||a&&a.cc<c.startCC)&&(d=!0),d}function z(a,b){var c=a.fragments,d=b.fragments;if(!d.length||!c.length)return void Ga.b.log("No fragments to align");var e=w(c,d[0].cc);return!e||e&&!e.startPTS?void Ga.b.log("No frag in previous level to align on"):e}function A(a,b){b.fragments.forEach(function(b){if(b){var c=b.start+a;b.start=b.startPTS=c,b.endPTS=c+b.duration}}),b.PTSKnown=!0}function B(a,b,c){if(y(a,b,c)){var d=z(b.details,c);d&&(Ga.b.log("Adjusting PTS using last level due to CC increase within current level"),A(d.start,c))}if(c.PTSKnown===!1&&b&&b.details){var e=b.details.programDateTime,f=c.programDateTime,g=(f-e)/1e3+b.details.fragments[0].start;isNaN(g)||(Ga.b.log("adjusting PTS using programDateTime delta, sliding:"+g.toFixed(3)),A(g,c))}}function C(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function D(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function E(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function F(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function G(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function H(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function I(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function J(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function K(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function L(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function M(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function N(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function O(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function P(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function Q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function R(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function S(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function T(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function U(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function V(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function W(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function X(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function Y(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function Z(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function $(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function aa(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function ba(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function ca(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function da(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function ea(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Xb,this.regionList=[]}function fa(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}function ga(){this.values=Object.create(null)}function ha(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}function ia(a,b,c){function d(){var b=fa(a);if(null===b)throw new Error("Malformed timestamp: "+g);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function e(a,b){var d=new ga;ha(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start",Zb,"end"]);break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start",Zb,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",Zb,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical","");var e=d.get("line","auto");"auto"===e&&-1===Yb.line&&(e=-1),b.line=e,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",Zb);var f=d.get("position","auto");"auto"===f&&50===Yb.position&&(f="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=f}function f(){a=a.replace(/^\s+/,"")}var g=a;if(f(),b.startTime=d(),f(),"-->"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+g);a=a.substr(3),f(),b.endTime=d(),f(),e(a,b)}function ja(a){return a.replace(/<br(?: \/)?>/gi,"\n")}function ka(a,b,c,d){for(var e,f,g,h,i,j=window.VTTCue||window.TextTrackCue,k=0;k<d.rows.length;k++)if(e=d.rows[k],g=!0,h=0,i="",!e.isEmpty()){for(var l=0;l<e.chars.length;l++)e.chars[l].uchar.match(/\s/)&&g?h++:(i+=e.chars[l].uchar,g=!1);e.cueStartTime=b,b===c&&(c+=1e-4),f=new j(b,c,ja(i.trim())),h>=16?h--:h++,navigator.userAgent.match(/Firefox\//)?f.line=k+1:f.line=k>7?k-2:k+1,f.align="left",f.position=Math.max(0,Math.min(100,100*(h/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(f)}}function la(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function ma(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function na(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function oa(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function pa(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function qa(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}function ra(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function sa(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}function ta(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function ua(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function va(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function wa(a){for(var b=[],c=0;c<a.length;c++)"subtitles"===a[c].kind&&b.push(a[c]);return b}function xa(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function ya(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function za(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function Aa(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var Ba={};c.d(Ba,"newCue",function(){return ka});var Ca=c(6),Da=c.n(Ca),Ea=c(1),Fa=c(2),Ga=c(0),Ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ia=function(){function a(b){d(this,a),this.hls=b,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,e=Array(c>1?c-1:0),f=1;c>f;f++)e[f-1]=arguments[f];this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}return a.prototype.destroy=function(){this.unregisterListeners()},a.prototype.isEventHandler=function(){return"object"===Ha(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},a.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if("hlsEventGeneric"===a)throw new Error("Forbidden event name: "+a);this.hls.on(a,this.onEvent)},this)},a.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)},this)},a.prototype.onEvent=function(a,b){this.onEventGeneric(a,b)},a.prototype.onEventGeneric=function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)};try{c.call(this,a,b).call()}catch(d){Ga.b.error("internal error happened while processing "+a+":"+d.message),this.hls.trigger(Ea.a.ERROR,{type:Fa.b.OTHER_ERROR,details:Fa.a.INTERNAL_EXCEPTION,fatal:!1,event:a,err:d})}},a}(),Ja=Ia,Ka=/^(\d+)x(\d+)$/,La=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Ma=function(){function a(b){e(this,a),"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}return a.prototype.decimalInteger=function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b},a.prototype.hexadecimalInteger=function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null},a.prototype.hexadecimalIntegerAsNumber=function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b},a.prototype.decimalFloatingPoint=function(a){return parseFloat(this[a])},a.prototype.enumeratedString=function(a){return this[a]},a.prototype.decimalResolution=function(a){var b=Ka.exec(this[a]);return null===b?void 0:{width:parseInt(b[1],10),height:parseInt(b[2],10)}},a.parseAttrList=function(a){var b,c={};for(La.lastIndex=0;null!==(b=La.exec(a));){var d=b[2],e='"';0===d.indexOf(e)&&d.lastIndexOf(e)===d.length-1&&(d=d.slice(1,-1)),c[b[1]]=d}return c},a}(),Na=Ma,Oa={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Pa=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Qa=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Ra=/#EXT-X-MEDIA:(.*)/g,Sa=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ta=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,Ua=function(){function a(){j(this,a),this.method=null,this.key=null,this.iv=null,this._uri=null}return Pa(a,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Da.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),a}(),Va=function(){function a(){j(this,a),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return a.prototype.createInitializationVector=function(a){for(var b=new Uint8Array(16),c=12;16>c;c++)b[c]=a>>8*(15-c)&255;return b},a.prototype.fragmentDecryptdataFromLevelkey=function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=new Ua,c.method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c},a.prototype.cloneObj=function(a){return JSON.parse(JSON.stringify(a))},Pa(a,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Da.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var a=this._byteRange=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(1===b.length){var c=this.lastByteRangeEndOffset;a[0]=c?c:0}else a[0]=parseInt(b[1]);a[1]=parseInt(b[0])+a[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),a}(),Wa=function(a){function b(c){j(this,b);var d=h(this,a.call(this,c,Ea.a.MANIFEST_LOADING,Ea.a.LEVEL_LOADING,Ea.a.AUDIO_TRACK_LOADING,Ea.a.SUBTITLE_TRACK_LOADING));return d.loaders={},d}return i(b,a),b.prototype.destroy=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},Ja.prototype.destroy.call(this)},b.prototype.onManifestLoading=function(a){this.load(a.url,{type:"manifest"})},b.prototype.onLevelLoading=function(a){this.load(a.url,{type:"level",level:a.level,id:a.id})},b.prototype.onAudioTrackLoading=function(a){this.load(a.url,{type:"audioTrack",id:a.id})},b.prototype.onSubtitleTrackLoading=function(a){this.load(a.url,{type:"subtitleTrack",id:a.id})},b.prototype.load=function(a,b){var c=this.loaders[b.type];if(c){var d=c.context;if(d&&d.url===a)return void Ga.b.trace("playlist request ongoing");Ga.b.warn("abort previous loader for type:"+b.type),c.abort()}var e=this.hls.config,f=void 0,g=void 0,h=void 0,i=void 0;"manifest"===b.type?(f=e.manifestLoadingMaxRetry,g=e.manifestLoadingTimeOut,h=e.manifestLoadingRetryDelay,i=e.manifestLoadingMaxRetryTimeout):(f=e.levelLoadingMaxRetry,g=e.levelLoadingTimeOut,h=e.levelLoadingRetryDelay,i=e.levelLoadingMaxRetryTimeout,Ga.b.log("loading playlist for "+b.type+" "+(b.level||b.id))),c=this.loaders[b.type]=b.loader="undefined"!=typeof e.pLoader?new e.pLoader(e):new e.loader(e),b.url=a,b.responseType="";var j=void 0,k=void 0;j={timeout:g,maxRetry:f,retryDelay:h,maxRetryDelay:i},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},c.load(b,j,k)},b.prototype.resolve=function(a,b){return Da.a.buildAbsoluteURL(b,a,{alwaysNormalize:!0})},b.prototype.parseMasterPlaylist=function(a,b){function c(a,b){["video","audio"].forEach(function(c){var d=a.filter(function(a){return f(a,c)});if(d.length){var e=d.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[c+"Codec"]=e.length>0?e[0]:d[0],a=a.filter(function(a){return-1===d.indexOf(a)})}}),b.unknownCodecs=a}var d=[],e=void 0;for(Qa.lastIndex=0;null!=(e=Qa.exec(a));){var g={},h=g.attrs=new Na(e[1]);g.url=this.resolve(e[2],b);var i=h.decimalResolution("RESOLUTION");i&&(g.width=i.width,g.height=i.height),g.bitrate=h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH"),g.name=h.NAME,c([].concat((h.CODECS||"").split(/[ ,]+/)),g),g.videoCodec&&-1!==g.videoCodec.indexOf("avc1")&&(g.videoCodec=this.avc1toavcoti(g.videoCodec)),d.push(g)}return d},b.prototype.parseMasterPlaylistMedia=function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],e=void 0,f=[],g=0;for(Ra.lastIndex=0;null!==(e=Ra.exec(a));){var h={},i=new Na(e[1]);if(i.TYPE===c){if(h.groupId=i["GROUP-ID"],h.name=i.NAME,h.type=c,h["default"]="YES"===i.DEFAULT,h.autoselect="YES"===i.AUTOSELECT,h.forced="YES"===i.FORCED,i.URI&&(h.url=this.resolve(i.URI,b)),h.lang=i.LANGUAGE,h.name||(h.name=h.lang),d.length){var j=k(d,h.groupId);h.audioCodec=j?j.codec:d[0].codec}h.id=g++,f.push(h)}}return f},b.prototype.avc1toavcoti=function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b},b.prototype.parseLevelPlaylist=function(a,b,c,d){var e,f,g=0,h=0,i={type:null,version:null,url:b,fragments:[],live:!0,startSN:0},j=new Ua,k=0,l=null,m=new Va;for(Sa.lastIndex=0;null!==(e=Sa.exec(a));){var n=e[1];if(n){m.duration=parseFloat(n);var o=(" "+e[2]).slice(1);m.title=o?o:null,m.tagList.push(o?["INF",n,o]:["INF",n])}else if(e[3]){if(!isNaN(m.duration)){var p=g++;m.type=d,m.start=h,m.levelkey=j,m.sn=p,m.level=c,m.cc=k,m.baseurl=b,m.relurl=(" "+e[3]).slice(1),i.fragments.push(m),l=m,h+=m.duration,m=new Va}}else if(e[4]){if(m.rawByteRange=(" "+e[4]).slice(1),l){var q=l.byteRangeEndOffset;q&&(m.lastByteRangeEndOffset=q)}}else if(e[5])m.rawProgramDateTime=(" "+e[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),void 0===i.programDateTime&&(i.programDateTime=new Date(new Date(Date.parse(e[5]))-1e3*h));else{for(e=e[0].match(Ta),f=1;f<e.length&&void 0===e[f];f++);var r=(" "+e[f+1]).slice(1),s=(" "+e[f+2]).slice(1);switch(e[f]){case"#":m.tagList.push(s?[r,s]:[r]);break;case"PLAYLIST-TYPE":i.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":g=i.startSN=parseInt(r);break;case"TARGETDURATION":i.targetduration=parseFloat(r);break;case"VERSION":i.version=parseInt(r);break;case"EXTM3U":break;case"ENDLIST":i.live=!1;break;case"DIS":k++,m.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":k=parseInt(r);break;case"KEY":var t=r,u=new Na(t),v=u.enumeratedString("METHOD"),w=u.URI,x=u.hexadecimalInteger("IV");v&&(j=new Ua,w&&["AES-128","SAMPLE-AES"].indexOf(v)>=0&&(j.method=v,j.baseuri=b,j.reluri=w,j.key=null,j.iv=x));break;case"START":var y=r,z=new Na(y),A=z.decimalFloatingPoint("TIME-OFFSET");isNaN(A)||(i.startTimeOffset=A);break;case"MAP":var B=new Na(r);m.relurl=B.URI,m.rawByteRange=B.BYTERANGE,m.baseurl=b,m.level=c,m.type=d,m.sn="initSegment",i.initSegment=m,m=new Va;break;default:Ga.b.warn("line parsed but not handled: "+e)}}}return m=l,m&&!m.relurl&&(i.fragments.pop(),h-=m.duration),i.totalduration=h,i.averagetargetduration=h/i.fragments.length,i.endSN=g-1,i.startCC=i.fragments[0]?i.fragments[0].cc:0,i.endCC=k,i},b.prototype.loadsuccess=function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=a.data,f=a.url,g=c.type,h=c.id,i=c.level,j=this.hls;if(this.loaders[g]=void 0,(void 0===f||0===f.indexOf("data:"))&&(f=c.url),b.tload=performance.now(),0===e.indexOf("#EXTM3U"))if(e.indexOf("#EXTINF:")>0){var k="audioTrack"!==g&&"subtitleTrack"!==g,l=isNaN(i)?isNaN(h)?0:h:i,m=this.parseLevelPlaylist(e,f,l,"audioTrack"===g?"audio":"subtitleTrack"===g?"subtitle":"main");m.tload=b.tload,"manifest"===g&&j.trigger(Ea.a.MANIFEST_LOADED,{levels:[{url:f,details:m}],audioTracks:[],url:f,stats:b,networkDetails:d}),b.tparsed=performance.now(),m.targetduration?k?j.trigger(Ea.a.LEVEL_LOADED,{details:m,level:i||0,id:h||0,stats:b,networkDetails:d}):"audioTrack"===g?j.trigger(Ea.a.AUDIO_TRACK_LOADED,{details:m,id:h,stats:b,networkDetails:d}):"subtitleTrack"===g&&j.trigger(Ea.a.SUBTITLE_TRACK_LOADED,{details:m,id:h,stats:b,networkDetails:d}):j.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:Fa.a.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"invalid targetduration",networkDetails:d})}else{var n=this.parseMasterPlaylist(e,f);if(n.length){var o=n.map(function(a){return{id:a.attrs.AUDIO,codec:a.audioCodec}}),p=this.parseMasterPlaylistMedia(e,f,"AUDIO",o),q=this.parseMasterPlaylistMedia(e,f,"SUBTITLES");if(p.length){var r=!1;p.forEach(function(a){a.url||(r=!0)}),r===!1&&n[0].audioCodec&&!n[0].attrs.AUDIO&&(Ga.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main"}))}j.trigger(Ea.a.MANIFEST_LOADED,{levels:n,audioTracks:p,subtitles:q,url:f,stats:b,networkDetails:d})}else j.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:Fa.a.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"no level found in manifest",networkDetails:d})}else j.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:Fa.a.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"no EXTM3U delimiter",networkDetails:d})},b.prototype.loaderror=function(a,b){var c,d,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=b.loader;switch(b.type){case"manifest":c=Fa.a.MANIFEST_LOAD_ERROR,d=!0;break;case"level":c=Fa.a.LEVEL_LOAD_ERROR,d=!1;break;case"audioTrack":c=Fa.a.AUDIO_TRACK_LOAD_ERROR,d=!1}f&&(f.abort(),this.loaders[b.type]=void 0),this.hls.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:c,fatal:d,url:f.url,loader:f,response:a,context:b,networkDetails:e})},b.prototype.loadtimeout=function(a,b){var c,d,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=b.loader;switch(b.type){case"manifest":c=Fa.a.MANIFEST_LOAD_TIMEOUT,d=!0;break;case"level":c=Fa.a.LEVEL_LOAD_TIMEOUT,d=!1;break;case"audioTrack":c=Fa.a.AUDIO_TRACK_LOAD_TIMEOUT,d=!1}f&&(f.abort(),this.loaders[b.type]=void 0),this.hls.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:c,fatal:d,url:f.url,loader:f,context:b,networkDetails:e})},b}(Ja),Xa=Wa,Ya=function(a){function b(c){l(this,b);var d=m(this,a.call(this,c,Ea.a.FRAG_LOADING));return d.loaders={},d}return n(b,a),b.prototype.destroy=function(){var a=this.loaders;for(var b in a){var c=a[b];c&&c.destroy()}this.loaders={},Ja.prototype.destroy.call(this)},b.prototype.onFragLoading=function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=this.hls.config;b.loaded=0,d&&(Ga.b.warn("abort previous fragment loader for type:"+c),d.abort()),d=this.loaders[c]=b.loader="undefined"!=typeof e.fLoader?new e.fLoader(e):new e.loader(e);var f=void 0,g=void 0,h=void 0;f={url:b.url,frag:b,responseType:"arraybuffer",progressData:!1};var i=b.byteRangeStartOffset,j=b.byteRangeEndOffset;isNaN(i)||isNaN(j)||(f.rangeStart=i,f.rangeEnd=j),g={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(f,g,h)},b.prototype.loadsuccess=function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=a.data,f=c.frag;f.loader=void 0,this.loaders[f.type]=void 0,this.hls.trigger(Ea.a.FRAG_LOADED,{payload:e,frag:f,stats:b,networkDetails:d})},b.prototype.loaderror=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=b.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:Fa.a.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a,networkDetails:c})},b.prototype.loadtimeout=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=b.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:Fa.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag,networkDetails:c})},b.prototype.loadprogress=function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=b.frag;e.loaded=a.loaded,this.hls.trigger(Ea.a.FRAG_LOAD_PROGRESS,{frag:e,stats:a,networkDetails:d})},b}(Ja),Za=Ya,$a=function(a){function b(c){o(this,b);var d=p(this,a.call(this,c,Ea.a.KEY_LOADING));return d.loaders={},d.decryptkey=null,d.decrypturl=null,d}return q(b,a),b.prototype.destroy=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},Ja.prototype.destroy.call(this)},b.prototype.onKeyLoading=function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=b.decryptdata,f=e.uri;if(f!==this.decrypturl||null===this.decryptkey){var g=this.hls.config;d&&(Ga.b.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new g.loader(g),this.decrypturl=f,this.decryptkey=null;var h=void 0,i=void 0,j=void 0;h={url:f,frag:b,responseType:"arraybuffer"},i={timeout:g.fragLoadingTimeOut,maxRetry:g.fragLoadingMaxRetry,retryDelay:g.fragLoadingRetryDelay,maxRetryDelay:g.fragLoadingMaxRetryTimeout},j={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(h,i,j)}else this.decryptkey&&(e.key=this.decryptkey,this.hls.trigger(Ea.a.KEY_LOADED,{frag:b}))},b.prototype.loadsuccess=function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(Ea.a.KEY_LOADED,{frag:d})},b.prototype.loaderror=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:Fa.a.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})},b.prototype.loadtimeout=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(Ea.a.ERROR,{type:Fa.b.NETWORK_ERROR,details:Fa.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})},b}(Ja),_a=$a,ab={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;d>=c;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(0>g))return f;d=e-1}}return null}},bb=ab,cb={isBuffered:function(a,b){if(a)for(var c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0;return!1},bufferInfo:function(a,b,c){if(a){var d,e=a.buffered,f=[];for(d=0;d<e.length;d++)f.push({start:e.start(d),end:e.end(d)});return this.bufferedInfo(f,b,c)}return{len:0,start:b,end:b,nextStart:void 0}},bufferedInfo:function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;
return c?c:b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&m>b)e=l,f=m,d=f-b;else if(l>b+c){g=l;break}}return{len:d,start:e,end:f,nextStart:g}}},db=cb,eb=c(7),fb=c(5),gb=c.n(fb),hb=c(9),ib=c.n(hb),jb=r(),kb=function(){function a(b,c){s(this,a),this.hls=b,this.id=c;var d=this.observer=new gb.a,e=b.config;d.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),e=1;b>e;e++)c[e-1]=arguments[e];d.emit.apply(d,[a,a].concat(c))},d.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),e=1;b>e;e++)c[e-1]=arguments[e];d.removeListener.apply(d,[a].concat(c))};var f=function(a,c){c=c||{},c.frag=this.frag,c.id=this.id,b.trigger(a,c)}.bind(this);d.on(Ea.a.FRAG_DECRYPTED,f),d.on(Ea.a.FRAG_PARSING_INIT_SEGMENT,f),d.on(Ea.a.FRAG_PARSING_DATA,f),d.on(Ea.a.FRAG_PARSED,f),d.on(Ea.a.ERROR,f),d.on(Ea.a.FRAG_PARSING_METADATA,f),d.on(Ea.a.FRAG_PARSING_USERDATA,f),d.on(Ea.a.INIT_PTS_FOUND,f);var g={mp4:jb.isTypeSupported("video/mp4"),mpeg:jb.isTypeSupported("audio/mpeg"),mp3:jb.isTypeSupported('audio/mp4; codecs="mp3"')},h=navigator.vendor;if(e.enableWorker&&"undefined"!=typeof Worker){Ga.b.log("demuxing in webworker");var i=void 0;try{i=this.w=ib()(10),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(a){b.trigger(Ea.a.ERROR,{type:Fa.b.OTHER_ERROR,details:Fa.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})},i.postMessage({cmd:"init",typeSupported:g,vendor:h,id:c,config:JSON.stringify(e)})}catch(j){Ga.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),i&&URL.revokeObjectURL(i.objectURL),this.demuxer=new eb.a(d,g,e,h),this.w=void 0}}else this.demuxer=new eb.a(d,g,e,h)}return a.prototype.destroy=function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}var c=this.observer;c&&(c.removeAllListeners(),this.observer=null)},a.prototype.push=function(a,b,c,d,e,f,g,h){var i=this.w,j=isNaN(e.startDTS)?e.start:e.startDTS,k=e.decryptdata,l=this.frag,m=!(l&&e.cc===l.cc),n=!(l&&e.level===l.level),o=l&&e.sn===l.sn+1,p=!n&&o;if(m&&Ga.b.log(this.id+":discontinuity detected"),n&&Ga.b.log(this.id+":switch detected"),this.frag=e,i)i.postMessage({cmd:"demux",data:a,decryptdata:k,initSegment:b,audioCodec:c,videoCodec:d,timeOffset:j,discontinuity:m,trackSwitch:n,contiguous:p,duration:f,accurateTimeOffset:g,defaultInitPTS:h},a instanceof ArrayBuffer?[a]:[]);else{var q=this.demuxer;q&&q.push(a,k,b,c,d,j,m,n,p,f,g,h)}},a.prototype.onWorkerMessage=function(a){var b=a.data,c=this.hls;switch(b.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case Ea.a.FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data2&&(b.data.data2=new Uint8Array(b.data2));default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}},a}(),lb=kb,mb={toString:function(a){for(var b="",c=a.length,d=0;c>d;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}},nb=mb,ob=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),pb={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},qb=function(a){function b(c){C(this,b);var d=D(this,a.call(this,c,Ea.a.MEDIA_ATTACHED,Ea.a.MEDIA_DETACHING,Ea.a.MANIFEST_LOADING,Ea.a.MANIFEST_PARSED,Ea.a.LEVEL_LOADED,Ea.a.KEY_LOADED,Ea.a.FRAG_LOADED,Ea.a.FRAG_LOAD_EMERGENCY_ABORTED,Ea.a.FRAG_PARSING_INIT_SEGMENT,Ea.a.FRAG_PARSING_DATA,Ea.a.FRAG_PARSED,Ea.a.ERROR,Ea.a.AUDIO_TRACK_SWITCHING,Ea.a.AUDIO_TRACK_SWITCHED,Ea.a.BUFFER_CREATED,Ea.a.BUFFER_APPENDED,Ea.a.BUFFER_FLUSHED));return d.config=c.config,d.audioCodecSwap=!1,d.ticks=0,d._state=pb.STOPPED,d.ontick=d.tick.bind(d),d}return E(b,a),b.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Ja.prototype.destroy.call(this),this.state=pb.STOPPED},b.prototype.startLoad=function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;-1===d&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&-1===a&&(Ga.b.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=pb.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this.forceStartLoad=!0,this.state=pb.STOPPED},b.prototype.stopLoad=function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=pb.STOPPED,this.forceStartLoad=!1},b.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},b.prototype.doTick=function(){switch(this.state){case pb.ERROR:break;case pb.BUFFER_FLUSHING:this.fragLoadError=0;break;case pb.IDLE:this._doTickIdle();break;case pb.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=pb.IDLE);break;case pb.FRAG_LOADING_WAITING_RETRY:var b=performance.now(),c=this.retryDate;(!c||b>=c||this.media&&this.media.seeking)&&(Ga.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=pb.IDLE);break;case pb.ERROR:case pb.STOPPED:case pb.FRAG_LOADING:case pb.PARSING:case pb.PARSED:case pb.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},b.prototype._doTickIdle=function(){var a=this.hls,b=a.config,c=this.media;if(void 0!==this.levelLastLoaded&&(c||!this.startFragRequested&&b.startFragPrefetch)){var d=void 0;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,f=this.levels[e];if(f){var g=f.bitrate,h=void 0;h=g?Math.max(8*b.maxBufferSize/g,b.maxBufferLength):b.maxBufferLength,h=Math.min(h,b.maxMaxBufferLength);var i=db.bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),j=i.len;if(!(j>=h)){Ga.b.trace("buffer length of "+j.toFixed(3)+" is below max of "+h.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e;var k=f.details;if("undefined"==typeof k||k.live&&this.levelLastLoaded!==e)return void(this.state=pb.WAITING_LEVEL);var l=this.fragPrevious;if(!k.live&&l&&!l.backtracked&&l.sn===k.endSN&&!i.nextStart){var m=Math.min(c.duration,l.start+l.duration);if(m-Math.max(i.end,l.start)<=Math.max(.2,l.duration)){var n={};return this.altAudio&&(n.type="video"),this.hls.trigger(Ea.a.BUFFER_EOS,n),void(this.state=pb.ENDED)}}this._fetchPayloadOrEos(d,i,k)}}}},b.prototype._fetchPayloadOrEos=function(a,b,c){var d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0!==g){var h=f[0].start,i=f[g-1].start+f[g-1].duration,j=b.end,k=void 0;if(c.initSegment&&!c.initSegment.data)k=c.initSegment;else if(c.live){var l=this.config.initialLiveManifestSize;if(l>g)return void Ga.b.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l);if(k=this._ensureFragmentAtLivePoint(c,j,h,i,d,f,g),null===k)return}else h>j&&(k=f[0]);k||(k=this._findFragment(h,d,g,f,j,i,c)),k&&this._loadFragmentOrKey(k,e,c,a,j)}},b.prototype._ensureFragmentAtLivePoint=function(a,b,c,d,e,f,g){var h=this.hls.config,i=this.media,j=void 0,k=void 0!==h.liveMaxLatencyDuration?h.liveMaxLatencyDuration:h.liveMaxLatencyDurationCount*a.targetduration;if(b<Math.max(c-h.maxFragLookUpTolerance,d-k)){var l=this.liveSyncPosition=this.computeLivePosition(c,a);Ga.b.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+l.toFixed(3)),b=l,i&&i.readyState&&i.duration>l&&(i.currentTime=l),this.nextLoadPosition=l}if(a.PTSKnown&&b>d&&i&&i.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(e){var m=e.sn+1;if(m>=a.startSN&&m<=a.endSN){var n=f[m-a.startSN];e.cc===n.cc&&(j=n,Ga.b.log("live playlist, switching playlist, load frag with next SN: "+j.sn))}j||(j=bb.search(f,function(a){return e.cc-a.cc}),j&&Ga.b.log("live playlist, switching playlist, load frag with same CC: "+j.sn))}j||(j=f[Math.min(g-1,Math.round(g/2))],Ga.b.log("live playlist, switching playlist, unknown, load middle frag : "+j.sn))}return j},b.prototype._findFragment=function(a,b,c,d,e,f,g){var h=this.hls.config,i=void 0,j=void 0,k=h.maxFragLookUpTolerance,l=b?d[b.sn-d[0].sn+1]:void 0,m=function(a){var b=Math.min(k,a.duration+(a.deltaPTS?a.deltaPTS:0));return a.start+a.duration-b<=e?1:a.start-b>e&&a.start?-1:0};if(f>e?(e>f-k&&(k=0),j=l&&!m(l)?l:bb.search(d,m)):j=d[c-1],j){i=j;var n=i.sn-g.startSN,o=b&&i.level===b.level,p=d[n-1],q=d[n+1];if(b&&i.sn===b.sn)if(o&&!i.backtracked)if(i.sn<g.endSN){var r=b.deltaPTS;r&&r>h.maxBufferHole&&b.dropped&&n?(i=p,Ga.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),b.loadCounter--):(i=q,Ga.b.log("SN just loaded, load next one: "+i.sn))}else i=null;else i.backtracked&&(q&&q.backtracked?(Ga.b.warn("Already backtracked from fragment "+q.sn+", will not backtrack to fragment "+i.sn+". Loading fragment "+q.sn),i=q):(Ga.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),i.dropped=0,p?(p.loadCounter&&p.loadCounter--,i=p,i.backtracked=!0):n&&(i=null)))}return i},b.prototype._loadFragmentOrKey=function(a,b,c,d,e){var f=this.hls,g=f.config;if(!a.decryptdata||null==a.decryptdata.uri||null!=a.decryptdata.key){if(Ga.b.log("Loading "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b+", currentTime:"+d.toFixed(3)+",bufferEnd:"+e.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){a.loadCounter++;var h=g.fragLoadingLoopThreshold;if(a.loadCounter>h&&Math.abs(this.fragLoadIdx-a.loadIdx)<h)return void f.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a})}else a.loadCounter=1;return a.loadIdx=this.fragLoadIdx,a.autoLevel=f.autoLevelEnabled,a.bitrateTest=this.bitrateTest,this.fragCurrent=a,this.startFragRequested=!0,isNaN(a.sn)||a.bitrateTest||(this.nextLoadPosition=a.start+a.duration),f.trigger(Ea.a.FRAG_LOADING,{frag:a}),this.demuxer||(this.demuxer=new lb(f,"main")),void(this.state=pb.FRAG_LOADING)}Ga.b.log("Loading key for "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b),this.state=pb.KEY_LOADING,f.trigger(Ea.a.KEY_LOADING,{frag:a})},b.prototype.getBufferedFrag=function(a){return bb.search(this._bufferedFrags,function(b){return a<b.startPTS?-1:a>b.endPTS?1:0})},b.prototype.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.endPTS+.5):null},b.prototype._checkFragmentChanged=function(){var a,b,c=this.media;if(c&&c.readyState&&c.seeking===!1&&(b=c.currentTime,b>c.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=b),db.isBuffered(c,b)?a=this.getBufferedFrag(b):db.isBuffered(c,b+.1)&&(a=this.getBufferedFrag(b+.1)),a)){var d=a;if(d!==this.fragPlaying){this.hls.trigger(Ea.a.FRAG_CHANGED,{frag:d});var e=d.level;this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(Ea.a.LEVEL_SWITCHED,{level:e}),this.fragPlaying=d}}},b.prototype.immediateLevelSwitch=function(){if(Ga.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var a=this.media,b=void 0;a?(b=a.paused,a.pause()):b=!0,this.previouslyPaused=b}var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},b.prototype.immediateLevelSwitchEnd=function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,db.isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())},b.prototype.nextLevelSwitch=function(){var a=this.media;if(a&&a.readyState){var b=void 0,c=void 0,d=void 0;if(void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),c=this.getBufferedFrag(a.currentTime),c&&c.startPTS>1&&this.flushMainBuffer(0,c.startPTS-1),a.paused)b=0;else{var e=this.hls.nextLoadLevel,f=this.levels[e],g=this.fragLastKbps;b=g&&this.fragCurrent?this.fragCurrent.duration*f.bitrate/(1e3*g)+1:0}if(d=this.getBufferedFrag(a.currentTime+b),d&&(d=this.followingBufferedFrag(d))){var h=this.fragCurrent;h&&h.loader&&h.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(d.maxStartPTS,Number.POSITIVE_INFINITY)}}},b.prototype.flushMainBuffer=function(a,b){this.state=pb.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(Ea.a.BUFFER_FLUSHING,c)},b.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition)},b.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(Ga.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0,a.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},b.prototype.onMediaSeeking=function(){var a=this.media,b=a?a.currentTime:void 0,c=this.config;isNaN(b)||Ga.b.log("media seeking to "+b.toFixed(3));var d=this.mediaBuffer?this.mediaBuffer:a,e=db.bufferInfo(d,b,this.config.maxBufferHole);if(this.state===pb.FRAG_LOADING){var f=this.fragCurrent;if(0===e.len&&f){var g=c.maxFragLookUpTolerance,h=f.start-g,i=f.start+f.duration+g;h>b||b>i?(f.loader&&(Ga.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),f.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=pb.IDLE):Ga.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===pb.ENDED&&(0===e.len&&(this.fragPrevious=0),this.state=pb.IDLE);a&&(this.lastCurrentTime=b),this.state!==pb.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*c.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=b),this.tick()},b.prototype.onMediaSeeked=function(){var a=this.media,b=a?a.currentTime:void 0;isNaN(b)||Ga.b.log("media seeked to "+b.toFixed(3)),this.tick()},b.prototype.onMediaEnded=function(){Ga.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},b.prototype.onManifestLoading=function(){Ga.b.log("trigger BUFFER_RESET"),this.hls.trigger(Ea.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},b.prototype.onManifestParsed=function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){b=a.audioCodec,b&&(-1!==b.indexOf("mp4a.40.2")&&(c=!0),-1!==b.indexOf("mp4a.40.5")&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&Ga.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1;var e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},b.prototype.onLevelLoaded=function(a){var b=a.details,c=a.level,d=this.levels[this.levelLastLoaded],e=this.levels[c],f=b.totalduration,g=0;if(Ga.b.log("level "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+f),b.live){var h=e.details;h&&b.fragments.length>0?(v(h,b),g=b.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(g,h),b.PTSKnown&&!isNaN(g)?Ga.b.log("live playlist sliding:"+g.toFixed(3)):(Ga.b.log("live playlist - outdated PTS, unknown sliding"),B(this.fragPrevious,d,b))):(Ga.b.log("live playlist - first load, unknown sliding"),b.PTSKnown=!1,B(this.fragPrevious,d,b))}else b.PTSKnown=!1;if(e.details=b,this.levelLastLoaded=c,this.hls.trigger(Ea.a.LEVEL_UPDATED,{details:b,level:c}),this.startFragRequested===!1){if(-1===this.startPosition||-1===this.lastCurrentTime){var i=b.startTimeOffset;isNaN(i)?b.live?(this.startPosition=this.computeLivePosition(g,b),Ga.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(0>i&&(Ga.b.log("negative start time offset "+i+", count from end of last fragment"),i=g+f+i),Ga.b.log("start time offset found in playlist, adjust startPosition to "+i),this.startPosition=i),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===pb.WAITING_LEVEL&&(this.state=pb.IDLE),this.tick()},b.prototype.onKeyLoaded=function(){this.state===pb.KEY_LOADING&&(this.state=pb.IDLE,this.tick())},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag;if(this.state===pb.FRAG_LOADING&&b&&"main"===c.type&&c.level===b.level&&c.sn===b.sn){var d=a.stats,e=this.levels[b.level],f=e.details;if(Ga.b.log("Loaded  "+b.sn+" of ["+f.startSN+" ,"+f.endSN+"],level "+b.level),this.bitrateTest=!1,this.stats=d,c.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=pb.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=performance.now(),this.hls.trigger(Ea.a.FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else if("initSegment"===c.sn)this.state=pb.IDLE,d.tparsed=d.tbuffered=performance.now(),f.initSegment.data=a.payload,this.hls.trigger(Ea.a.FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else{this.state=pb.PARSING;var g=f.totalduration,h=b.level,i=b.sn,j=this.config.defaultAudioCodec||e.audioCodec;this.audioCodecSwap&&(Ga.b.log("swapping playlist audio codec"),void 0===j&&(j=this.lastAudioCodec),j&&(j=-1!==j.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,Ga.b.log("Parsing "+i+" of ["+f.startSN+" ,"+f.endSN+"],level "+h+", cc "+b.cc);var k=this.demuxer;k||(k=this.demuxer=new lb(this.hls,"main"));var l=this.media,m=l&&l.seeking,n=!m&&(f.PTSKnown||!f.live),o=f.initSegment?f.initSegment.data:[];k.push(a.payload,o,j,e.videoCodec,b,g,n,void 0)}}this.fragLoadError=0},b.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===pb.PARSING){var d,e,f=a.tracks;if(f.audio&&this.altAudio&&delete f.audio,e=f.audio){var g=this.levels[this.level].audioCodec,h=navigator.userAgent.toLowerCase();g&&this.audioCodecSwap&&(Ga.b.log("swapping playlist audio codec"),g=-1!==g.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==e.metadata.channelCount&&-1===h.indexOf("firefox")&&(g="mp4a.40.5"),-1!==h.indexOf("android")&&"audio/mpeg"!==e.container&&(g="mp4a.40.2",Ga.b.log("Android: force audio codec to "+g)),e.levelCodec=g,e.id=a.id}e=f.video,e&&(e.levelCodec=this.levels[this.level].videoCodec,e.id=a.id),this.hls.trigger(Ea.a.BUFFER_CODECS,f);for(d in f){e=f[d],Ga.b.log("main track:"+d+",container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var i=e.initSegment;i&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Ea.a.BUFFER_APPENDING,{type:d,data:i,parent:"main",content:"initSegment"}))}this.tick()}},b.prototype.onFragParsingData=function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"main"===a.id&&d.sn===c.sn&&d.level===c.level&&("audio"!==a.type||!this.altAudio)&&this.state===pb.PARSING){var e=this.levels[this.level],f=c;if(isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),Ga.b.log("Parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0)),"video"===a.type)if(f.dropped=a.dropped,f.dropped)if(f.backtracked)Ga.b.warn("Already backtracked on this fragment, appending with the gap");else{var g=e.details;if(!g||f.sn!==g.startSN)return Ga.b.warn("missing video frame(s), backtracking fragment"),f.backtracked=!0,this.nextLoadPosition=a.startPTS,this.state=pb.IDLE,this.fragPrevious=f,void this.tick();Ga.b.warn("missing video frame(s) on first frag, appending with gap")}else f.backtracked=!1;var h=u(e.details,f,a.startPTS,a.endPTS,a.startDTS,a.endDTS),i=this.hls;i.trigger(Ea.a.LEVEL_PTS_UPDATED,{details:e.details,level:this.level,drift:h,type:a.type,start:a.startPTS,end:a.endPTS}),[a.data1,a.data2].forEach(function(c){c&&c.length&&b.state===pb.PARSING&&(b.appended=!0,b.pendingBuffering=!0,i.trigger(Ea.a.BUFFER_APPENDING,{type:a.type,data:c,parent:"main",content:"data"}))}),this.tick()}},b.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===pb.PARSING&&(this.stats.tparsed=performance.now(),this.state=pb.PARSED,this._checkAppendedParsed())},b.prototype.onAudioTrackSwitching=function(a){var b=!!a.url,c=a.id;if(!b){if(this.mediaBuffer!==this.media){Ga.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var d=this.fragCurrent;d.loader&&(Ga.b.log("switching to main audio track, cancel main fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=pb.IDLE}var e=this.hls;e.trigger(Ea.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),e.trigger(Ea.a.AUDIO_TRACK_SWITCHED,{id:c}),this.altAudio=!1}},b.prototype.onAudioTrackSwitched=function(a){var b=a.id,c=!!this.hls.audioTracks[b].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(Ga.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()},b.prototype.onBufferCreated=function(a){var b=a.tracks,c=void 0,d=void 0,e=!1;for(var f in b){var g=b[f];"main"===g.id?(d=f,c=g,"video"===f&&(this.videoBuffer=b[f].buffer)):e=!0}e&&c?(Ga.b.log("alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},b.prototype.onBufferAppended=function(a){if("main"===a.parent){var b=this.state;(b===pb.PARSING||b===pb.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},b.prototype._checkAppendedParsed=function(){if(!(this.state!==pb.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent;if(a){var b=this.mediaBuffer?this.mediaBuffer:this.media;Ga.b.log("main buffered : "+nb.toString(b.buffered));var c=this._bufferedFrags.filter(function(a){return db.isBuffered(b,(a.startPTS+a.endPTS)/2)});c.push(a),this._bufferedFrags=c.sort(function(a,b){return a.startPTS-b.startPTS}),this.fragPrevious=a;var d=this.stats;d.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*d.total/(d.tbuffered-d.tfirst)),this.hls.trigger(Ea.a.FRAG_BUFFERED,{stats:d,frag:a,id:"main"}),this.state=pb.IDLE}this.tick()}},b.prototype.onError=function(a){var b=a.frag||this.fragCurrent;if(!b||"main"===b.type){var c=!!this.media&&db.isBuffered(this.media,this.media.currentTime)&&db.isBuffered(this.media,this.media.currentTime+.5);switch(a.details){case Fa.a.FRAG_LOAD_ERROR:case Fa.a.FRAG_LOAD_TIMEOUT:case Fa.a.KEY_LOAD_ERROR:case Fa.a.KEY_LOAD_TIMEOUT:if(!a.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var d=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);b.loadCounter=0,Ga.b.warn("mediaController: frag loading failed, retry in "+d+" ms"),this.retryDate=performance.now()+d,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=pb.FRAG_LOADING_WAITING_RETRY}else Ga.b.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=pb.ERROR;break;case Fa.a.FRAG_LOOP_LOADING_ERROR:a.fatal||(c?(this._reduceMaxBufferLength(b.duration),this.state=pb.IDLE):b.autoLevel&&0!==b.level||(a.fatal=!0,this.state=pb.ERROR));break;case Fa.a.LEVEL_LOAD_ERROR:case Fa.a.LEVEL_LOAD_TIMEOUT:this.state!==pb.ERROR&&(a.fatal?(this.state=pb.ERROR,Ga.b.warn("streamController: "+a.details+",switch to "+this.state+" state ...")):a.levelRetry||this.state!==pb.WAITING_LEVEL||(this.state=pb.IDLE));break;case Fa.a.BUFFER_FULL_ERROR:"main"!==a.parent||this.state!==pb.PARSING&&this.state!==pb.PARSED||(c?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=pb.IDLE):(Ga.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},b.prototype._reduceMaxBufferLength=function(a){var b=this.config;b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,Ga.b.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*b.fragLoadingLoopThreshold))},b.prototype._checkBuffer=function(){var a=this.media,b=this.config;if(a&&a.readyState){var c=a.currentTime,d=this.mediaBuffer?this.mediaBuffer:a,e=d.buffered;if(!this.loadedmetadata&&e.length){this.loadedmetadata=!0;var f=a.seeking?c:this.startPosition,g=db.isBuffered(d,f),h=e.start(0),i=!g&&Math.abs(f-h)<b.maxSeekHole;(c!==f||i)&&(Ga.b.log("target start position:"+f),i&&(f=h,Ga.b.log("target start position not buffered, seek to buffered.start(0) "+f)),Ga.b.log("adjust currentTime from "+c+" to "+f),a.currentTime=f)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var j=db.bufferInfo(a,c,0),k=!(a.paused||a.ended||0===a.buffered.length),l=.5,m=c!==this.lastCurrentTime;if(m)this.stallReported&&(Ga.b.warn("playback not stuck anymore @"+c+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(k){var n=performance.now(),o=this.hls;if(this.stalled){var p=n-this.stalled,q=j.len,r=this.nudgeRetry||0;if(l>=q&&p>1e3*b.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,Ga.b.warn("playback stalling in low buffer @"+c),o.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:q}));var s=j.nextStart,t=s-c;if(s&&t<b.maxSeekHole&&t>0){this.nudgeRetry=++r;var u=r*b.nudgeOffset;Ga.b.log("adjust currentTime from "+a.currentTime+" to next buffered @ "+s+" + nudge "+u),a.currentTime=s+u,this.stalled=void 0,o.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:s+u-c})}}else if(q>l&&p>1e3*b.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,Ga.b.warn("playback stalling in high buffer @"+c),o.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:q})),this.stalled=void 0,this.nudgeRetry=++r,r<b.nudgeMaxRetry){var v=a.currentTime,w=v+r*b.nudgeOffset;Ga.b.log("adjust currentTime from "+v+" to "+w),a.currentTime=w,o.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else Ga.b.error("still stuck in high buffer @"+c+" after "+b.nudgeMaxRetry+", raise fatal error"),o.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=n,this.stallReported=!1}}}},b.prototype.onFragLoadEmergencyAborted=function(){this.state=pb.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},b.prototype.onBufferFlushed=function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(b){return db.isBuffered(a,(b.startPTS+b.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=pb.IDLE,this.fragPrevious=null},b.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},b.prototype.computeLivePosition=function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)},ob(b,[{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,Ga.b.log("main stream:"+b+"->"+a),this.hls.trigger(Ea.a.STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var a=this.media;if(a){var b=this.getBufferedFrag(a.currentTime);if(b)return b.level}return-1}},{key:"nextBufferedFrag",get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a}}]),b}(Ja),rb=qb,sb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),tb=function(a){function b(c){F(this,b);var d=G(this,a.call(this,c,Ea.a.MANIFEST_LOADED,Ea.a.LEVEL_LOADED,Ea.a.FRAG_LOADED,Ea.a.ERROR));return d._manualLevel=-1,d.timer=null,d}return H(b,a),b.prototype.destroy=function(){this.cleanTimer(),this._manualLevel=-1},b.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},b.prototype.startLoad=function(){var a=this._levels;this.canload=!0,this.levelRetryCount=0,a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),this.timer&&this.tick()},b.prototype.stopLoad=function(){this.canload=!1},b.prototype.onManifestLoaded=function(a){var b=[],c=void 0,d={},e=null,f=!1,h=!1,i=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),j=[];if(a.levels.forEach(function(a){a.loadError=0,a.fragmentError=!1,f=f||!!a.videoCodec,h=h||!!a.audioCodec||!(!a.attrs||!a.attrs.AUDIO),i===!0&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0),e=d[a.bitrate],void 0===e?(a.url=[a.url],a.urlId=0,d[a.bitrate]=a,b.push(a)):e.url.push(a.url)}),f===!0&&h===!0&&(b=b.filter(function(a){var b=a.videoCodec;return!!b})),b=b.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||g(b))&&(!c||g(c))}),a.audioTracks&&(j=a.audioTracks.filter(function(a){return!a.audioCodec||g(a.audioCodec,"audio")})),b.length){c=b[0].bitrate,b.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=b;for(var k=0;k<b.length;k++)if(b[k].bitrate===c){this._firstLevel=k,Ga.b.log("manifest loaded,"+b.length+" level(s) found, first bitrate:"+c);break}this.hls.trigger(Ea.a.MANIFEST_PARSED,{levels:b,audioTracks:j,firstLevel:this._firstLevel,stats:a.stats,audio:h,video:f,altAudio:j.length>0})}else this.hls.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},b.prototype.setLevelInternal=function(a){var b=this._levels,c=this.hls;if(a>=0&&a<b.length){if(this.cleanTimer(),this._level!==a){Ga.b.log("switching to level "+a),this._level=a;var d=b[a];d.level=a,c.trigger(Ea.a.LEVEL_SWITCH,d),c.trigger(Ea.a.LEVEL_SWITCHING,d)}var e=b[a],f=e.details;if(!f||f.live===!0){var g=e.urlId;c.trigger(Ea.a.LEVEL_LOADING,{url:e.url[g],level:a,id:g})}}else c.trigger(Ea.a.ERROR,{type:Fa.b.OTHER_ERROR,details:Fa.a.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})},b.prototype.onError=function(a){var b=this;if(a.fatal===!0)return void(a.type===Fa.b.NETWORK_ERROR&&this.cleanTimer());var c=a.details,d=!1,e=!1,f=void 0,g=void 0,h=this.hls.config;switch(c){
case Fa.a.FRAG_LOAD_ERROR:case Fa.a.FRAG_LOAD_TIMEOUT:case Fa.a.FRAG_LOOP_LOADING_ERROR:case Fa.a.KEY_LOAD_ERROR:case Fa.a.KEY_LOAD_TIMEOUT:f=a.frag.level,e=!0;break;case Fa.a.LEVEL_LOAD_ERROR:case Fa.a.LEVEL_LOAD_TIMEOUT:f=a.context.level,d=!0;break;case Fa.a.REMUX_ALLOC_ERROR:f=a.level}if(void 0!==f)if(g=this._levels[f],g.loadError++,g.fragmentError=e,e===!0){var i=g.url.length;i>1&&g.loadError<i?(g.urlId=(g.urlId+1)%i,g.details=void 0,Ga.b.warn("level controller,"+c+" for level "+f+": switching to redundant stream id "+g.urlId)):-1===this._manualLevel&&0!==f?(Ga.b.warn("level controller,"+c+": switch-down for next fragment"),this.hls.nextAutoLevel=f-1):(Ga.b.warn("level controller, "+c+": reload a fragment"),this._level=void 0)}else if(d===!0)if(this.levelRetryCount+1<=h.levelLoadingMaxRetry){var j=Math.min(Math.pow(2,this.levelRetryCount)*h.levelLoadingRetryDelay,h.levelLoadingMaxRetryTimeout);this.timer=setTimeout(function(){return b.tick()},j),a.levelRetry=!0,this.levelRetryCount++,Ga.b.warn("level controller,"+c+", retry in "+j+" ms, current retry count is "+this.levelRetryCount)}else Ga.b.error("cannot recover "+c+" error"),this._level=void 0,this.cleanTimer(),a.fatal=!0},b.prototype.onFragLoaded=function(a){var b=a.frag;if(void 0!==b&&"main"===b.type){var c=this._levels[b.level];void 0!==c&&(c.fragmentError=!1,c.loadError=0,this.levelRetryCount=0)}},b.prototype.onLevelLoaded=function(a){var b=this,c=a.level;if(c===this._level){var d=this._levels[c];d.fragmentError===!1&&(d.loadError=0,this.levelRetryCount=0);var e=a.details;if(e.live){var f=1e3*(e.averagetargetduration?e.averagetargetduration:e.targetduration),g=d.details;g&&e.endSN===g.endSN&&(f/=2,Ga.b.log("same live playlist, reload twice faster")),f-=performance.now()-a.stats.trequest,f=Math.max(1e3,Math.round(f)),Ga.b.log("live playlist, reload in "+f+" ms"),this.timer=setTimeout(function(){return b.tick()},f)}else this.cleanTimer()}},b.prototype.tick=function(){var a=this._level;if(void 0!==a&&this.canload){var b=this._levels[a];if(b&&b.url){var c=b.urlId;this.hls.trigger(Ea.a.LEVEL_LOADING,{url:b.url[c],level:a,id:c})}}},sb(b,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(a){var b=this._levels;b&&(a=Math.min(a,b.length-1),(this._level!==a||void 0===b[a].details)&&this.setLevelInternal(a))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(a){this._manualLevel=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this._manualLevel&&(this.hls.nextAutoLevel=a)}}]),b}(Ja),ub=tb,vb=c(3),wb=function(a){function b(c){I(this,b);var d=J(this,a.call(this,c,Ea.a.MEDIA_ATTACHED,Ea.a.MEDIA_DETACHING,Ea.a.FRAG_PARSING_METADATA));return d.id3Track=void 0,d.media=void 0,d}return K(b,a),b.prototype.destroy=function(){Ja.prototype.destroy.call(this)},b.prototype.onMediaAttached=function(a){this.media=a.media,!this.media},b.prototype.onMediaDetaching=function(){this.media=void 0},b.prototype.onFragParsingMetadata=function(a){var b=a.frag,c=a.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden");for(var d=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,e=0;e<c.length;e++){var f=vb.a.getID3Frames(c[e].data);if(f){var g=c[e].pts,h=e<c.length-1?c[e+1].pts:b.endPTS;g===h&&(h+=1e-4);for(var i=0;i<f.length;i++){var j=f[i];if(!vb.a.isTimeStampFrame(j)){var k=new d(g,h,"");k.value=j,this.id3Track.addCue(k)}}}}},b}(Ja),xb=wb,yb=function(){function a(b){L(this,a),this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=0,this.totalWeight_=0}return a.prototype.sample=function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a},a.prototype.getTotalWeight=function(){return this.totalWeight_},a.prototype.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_},a}(),zb=yb,Ab=function(){function a(b,c,d,e){M(this,a),this.hls=b,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new zb(c),this.fast_=new zb(d)}return a.prototype.sample=function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)},a.prototype.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},a.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.prototype.destroy=function(){},a}(),Bb=Ab,Cb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Db=function(a){function b(c){N(this,b);var d=O(this,a.call(this,c,Ea.a.FRAG_LOADING,Ea.a.FRAG_LOADED,Ea.a.FRAG_BUFFERED,Ea.a.ERROR));return d.lastLoadedFragLevel=0,d._nextAutoLevel=-1,d.hls=c,d.timer=null,d._bwEstimator=null,d.onCheck=d._abandonRulesCheck.bind(d),d}return P(b,a),b.prototype.destroy=function(){this.clearTimer(),Ja.prototype.destroy.call(this)},b.prototype.onFragLoading=function(a){var b=a.frag;if("main"===b.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var c=this.hls,d=a.frag.level,e=c.levels[d].details.live,f=c.config,g=void 0,h=void 0;e?(g=f.abrEwmaFastLive,h=f.abrEwmaSlowLive):(g=f.abrEwmaFastVoD,h=f.abrEwmaSlowVoD),this._bwEstimator=new Bb(c,h,g,f.abrEwmaDefaultEstimate)}this.fragCurrent=b}},b.prototype._abandonRulesCheck=function(){var a=this.hls,b=a.media,c=this.fragCurrent,d=c.loader,e=a.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return Ga.b.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var f=d.stats;if(b&&f&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var g=performance.now()-f.trequest,h=Math.abs(b.playbackRate);if(g>500*c.duration/h){var i=a.levels,j=Math.max(1,f.bw?f.bw/8:1e3*f.loaded/g),k=i[c.level],l=k.realBitrate?Math.max(k.realBitrate,k.bitrate):k.bitrate,m=f.total?f.total:Math.max(f.loaded,Math.round(c.duration*l/8)),n=b.currentTime,o=(m-f.loaded)/j,p=(db.bufferInfo(b,n,a.config.maxBufferHole).end-n)/h;if(p<2*c.duration/h&&o>p){var q=void 0,r=void 0;for(r=c.level-1;r>e;r--){var s=i[r].realBitrate?Math.max(i[r].realBitrate,i[r].bitrate):i[r].bitrate;if(q=c.duration*s/(6.4*j),p>q)break}o>q&&(Ga.b.warn("loading too slow, abort fragment loading and switch to level "+r+":fragLoadedDelay["+r+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+q.toFixed(1)+"<"+o.toFixed(1)+":"+p.toFixed(1)),a.nextLoadLevel=r,this._bwEstimator.sample(g,f.loaded),d.abort(),this.clearTimer(),a.trigger(Ea.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:f}))}}}},b.prototype.onFragLoaded=function(a){var b=a.frag;if("main"===b.type&&!isNaN(b.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[b.level],d=(c.loaded?c.loaded.bytes:0)+a.stats.loaded,e=(c.loaded?c.loaded.duration:0)+a.frag.duration;c.loaded={bytes:d,duration:e},c.realBitrate=Math.round(8*d/e)}if(a.frag.bitrateTest){var f=a.stats;f.tparsed=f.tbuffered=f.tload,this.onFragBuffered(a)}}},b.prototype.onFragBuffered=function(a){var b=a.stats,c=a.frag;if(!(b.aborted===!0||1!==c.loadCounter||"main"!==c.type||isNaN(c.sn)||c.bitrateTest&&b.tload!==b.tbuffered)){var d=b.tparsed-b.trequest;Ga.b.log("latency/loading/parsing/append/kbps:"+Math.round(b.tfirst-b.trequest)+"/"+Math.round(b.tload-b.tfirst)+"/"+Math.round(b.tparsed-b.tload)+"/"+Math.round(b.tbuffered-b.tparsed)+"/"+Math.round(8*b.loaded/(b.tbuffered-b.trequest))),this._bwEstimator.sample(d,b.loaded),b.bwEstimate=this._bwEstimator.getEstimate(),c.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}},b.prototype.onError=function(a){switch(a.details){case Fa.a.FRAG_LOAD_ERROR:case Fa.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},b.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},b.prototype._findBestLevel=function(a,b,c,d,e,f,g,h,i){for(var j=e;j>=d;j--){var k=i[j],l=k.details,m=l?l.totalduration/l.fragments.length:b,n=l?l.live:!1,o=void 0;o=a>=j?g*c:h*c;var p=i[j].realBitrate?Math.max(i[j].realBitrate,i[j].bitrate):i[j].bitrate,q=p*m/o;if(Ga.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+j+"/"+Math.round(o)+"/"+p+"/"+m+"/"+f+"/"+q),o>p&&(!q||n&&!this.bitrateTestDelay||f>q))return j}return-1},Cb(b,[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this._bwEstimator;if(!(-1===a||b&&b.canEstimate()))return a;var c=this._nextABRAutoLevel;return-1!==a&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a}},{key:"_nextABRAutoLevel",get:function(){var a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media,g=this.lastLoadedFragLevel,h=this.fragCurrent?this.fragCurrent.duration:0,i=f?f.currentTime:0,j=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,k=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,l=(db.bufferInfo(f,i,d.maxBufferHole).end-i)/j,m=this._findBestLevel(g,h,k,e,b,l,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(m>=0)return m;Ga.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var n=h?Math.min(h,d.maxStarvationDelay):d.maxStarvationDelay,o=d.abrBandWidthFactor,p=d.abrBandWidthUpFactor;if(0===l){var q=this.bitrateTestDelay;if(q){var r=h?Math.min(h,d.maxLoadingDelay):d.maxLoadingDelay;n=r-q,Ga.b.trace("bitrate test took "+Math.round(1e3*q)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*n)+" ms"),o=p=1}}return m=this._findBestLevel(g,h,k,e,b,l+n,o,p,c),Math.max(m,0)}}]),b}(Ja),Eb=Db,Fb=r(),Gb=function(a){function b(c){Q(this,b);var d=R(this,a.call(this,c,Ea.a.MEDIA_ATTACHING,Ea.a.MEDIA_DETACHING,Ea.a.MANIFEST_PARSED,Ea.a.BUFFER_RESET,Ea.a.BUFFER_APPENDING,Ea.a.BUFFER_CODECS,Ea.a.BUFFER_EOS,Ea.a.BUFFER_FLUSHING,Ea.a.LEVEL_PTS_UPDATED,Ea.a.LEVEL_UPDATED));return d._msDuration=null,d._levelDuration=null,d.onsbue=d.onSBUpdateEnd.bind(d),d.onsbe=d.onSBUpdateError.bind(d),d.pendingTracks={},d.tracks={},d}return S(b,a),b.prototype.destroy=function(){Ja.prototype.destroy.call(this)},b.prototype.onLevelPtsUpdated=function(a){var b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container){var d=this.sourceBuffer.audio,e=Math.abs(d.timestampOffset-a.start);if(e>.1){var f=d.updating;try{d.abort()}catch(g){f=!0,Ga.b.warn("can not abort audio buffer: "+g)}f?this.audioTimestampOffset=a.start:(Ga.b.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}},b.prototype.onManifestParsed=function(a){var b=a.audio,c=a.video||a.levels.length&&a.audio,d=0;a.altAudio&&(b||c)&&(d=(b?1:0)+(c?1:0),Ga.b.log(d+" sourceBuffer(s) expected")),this.sourceBufferNb=d},b.prototype.onMediaAttaching=function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new Fb;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=URL.createObjectURL(c)}},b.prototype.onMediaDetaching=function(){Ga.b.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(b){Ga.b.warn("onMediaDetaching:"+b.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(Ea.a.MEDIA_DETACHED)},b.prototype.onMediaSourceOpen=function(){Ga.b.log("media source opened"),this.hls.trigger(Ea.a.MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},b.prototype.checkPendingTracks=function(){var a=this.pendingTracks,b=Object.keys(a).length;b&&(this.sourceBufferNb<=b||0===this.sourceBufferNb)&&(this.createSourceBuffers(a),this.pendingTracks={},this.doAppending())},b.prototype.onMediaSourceClose=function(){Ga.b.log("media source closed")},b.prototype.onMediaSourceEnded=function(){Ga.b.log("media source ended")},b.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var a=this.sourceBuffer.audio;Ga.b.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0);this.hls.trigger(Ea.a.BUFFER_APPENDED,{parent:b,pending:c}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},b.prototype.onSBUpdateError=function(a){Ga.b.error("sourceBuffer error:",a),this.hls.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.BUFFER_APPENDING_ERROR,fatal:!1})},b.prototype.onBufferReset=function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(d){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},b.prototype.onBufferCodecs=function(a){if(0===Object.keys(this.sourceBuffer).length){for(var b in a)this.pendingTracks[b]=a[b];var c=this.mediaSource;c&&"open"===c.readyState&&this.checkPendingTracks()}},b.prototype.createSourceBuffers=function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var e=a[d],f=e.levelCodec||e.codec,g=e.container+";codecs="+f;Ga.b.log("creating sourceBuffer("+g+")");try{var h=b[d]=c.addSourceBuffer(g);h.addEventListener("updateend",this.onsbue),h.addEventListener("error",this.onsbe),this.tracks[d]={codec:f,container:e.container},e.buffer=h}catch(i){Ga.b.error("error while trying to add sourceBuffer:"+i.message),this.hls.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:i,mimeType:g})}}this.hls.trigger(Ea.a.BUFFER_CREATED,{tracks:a})},b.prototype.onBufferAppending=function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())},b.prototype.onBufferAppendFail=function(a){Ga.b.error("sourceBuffer error:",a.event),this.hls.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.BUFFER_APPENDING_ERROR,fatal:!1})},b.prototype.onBufferEos=function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,Ga.b.log(d+" sourceBuffer now EOS"));this.checkEos()},b.prototype.checkEos=function(){var a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return void(this._needsEos=!1);for(var c in a){var d=a[c];if(!d.ended)return;if(d.updating)return void(this._needsEos=!0)}Ga.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(e){Ga.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},b.prototype.onBufferFlushing=function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()},b.prototype.onLevelUpdated=function(a){var b=a.details;0!==b.fragments.length&&(this._levelDuration=b.totalduration+b.fragments[0].start,this.updateMediaElementDuration())},b.prototype.updateMediaElementDuration=function(){var a=this.media,b=this.mediaSource,c=this.sourceBuffer,d=this._levelDuration;if(null!==d&&a&&b&&c&&0!==a.readyState&&"open"===b.readyState){for(var e in c)if(c[e].updating)return;null===this._msDuration&&(this._msDuration=b.duration);var f=a.duration;(d>this._msDuration&&d>f||f===1/0||isNaN(f))&&(Ga.b.log("Updating mediasource duration to "+d.toFixed(3)),this._msDuration=b.duration=d)}},b.prototype.doFlush=function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;try{for(var d in c)b+=c[d].buffered.length}catch(e){Ga.b.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(Ea.a.BUFFER_FLUSHED)}},b.prototype.doAppending=function(){var a=this.hls,b=this.sourceBuffer,c=this.segments;if(Object.keys(b).length){if(this.media.error)return this.segments=[],void Ga.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(c&&c.length){var d=c.shift();try{var e=d.type,f=b[e];f?f.updating?c.unshift(d):(f.ended=!1,this.parent=d.parent,f.appendBuffer(d.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(g){Ga.b.error("error while trying to append buffer:"+g.message),c.unshift(d);var h={type:Fa.b.MEDIA_ERROR,parent:d.parent};if(22===g.code)return this.segments=[],h.details=Fa.a.BUFFER_FULL_ERROR,h.fatal=!1,void a.trigger(Ea.a.ERROR,h);if(this.appendError?this.appendError++:this.appendError=1,h.details=Fa.a.BUFFER_APPEND_ERROR,this.appendError>a.config.appendErrorMaxRetry)return Ga.b.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),c=[],h.fatal=!0,void a.trigger(Ea.a.ERROR,h);h.fatal=!1,a.trigger(Ea.a.ERROR,h)}}}},b.prototype.flushBuffer=function(a,b,c){var d,e,f,g,h,i,j=this.sourceBuffer;if(Object.keys(j).length){if(Ga.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var k in j)if(!c||k===c){if(d=j[k],d.ended=!1,d.updating)return Ga.b.warn("cannot flush, sb updating in progress"),!1;try{for(e=0;e<d.buffered.length;e++)if(f=d.buffered.start(e),g=d.buffered.end(e),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&b===Number.POSITIVE_INFINITY?(h=a,i=b):(h=Math.max(f,a),i=Math.min(g,b)),Math.min(i,g)-h>.5)return this.flushBufferCounter++,Ga.b.log("flush "+k+" ["+h+","+i+"], of ["+f+","+g+"], pos:"+this.media.currentTime),d.remove(h,i),!1}catch(l){Ga.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else Ga.b.warn("abort flushing too many retries");Ga.b.log("buffer flushed")}return!0},b}(Ja),Hb=Gb,Ib=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Jb=function(a){function b(c){return T(this,b),U(this,a.call(this,c,Ea.a.FPS_DROP_LEVEL_CAPPING,Ea.a.MEDIA_ATTACHING,Ea.a.MANIFEST_PARSED))}return V(b,a),b.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},b.prototype.onFpsDropLevelCapping=function(a){b.isLevelAllowed(a.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(a.droppedLevel)},b.prototype.onMediaAttaching=function(a){this.media=a.media instanceof HTMLVideoElement?a.media:null},b.prototype.onManifestParsed=function(a){var b=this.hls;this.restrictedLevels=[],b.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=a.levels,b.firstLevel=this.getMaxLevel(a.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},b.prototype.detectPlayerSize=function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},b.prototype.getMaxLevel=function(a){var c=this;if(!this.levels)return-1;var d=this.levels.filter(function(d,e){return b.isLevelAllowed(e,c.restrictedLevels)&&a>=e});return b.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},b.isLevelAllowed=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return-1===b.indexOf(a)},b.getMaxLevelByMediaSize=function(a,b,c){if(!a||a&&!a.length)return-1;for(var d=function(a,b){return b?a.width!==b.width||a.height!==b.height:!0},e=a.length-1,f=0;f<a.length;f+=1){var g=a[f];if((g.width>=b||g.height>=c)&&d(g,a[f+1])){e=f;break}}return e},Ib(b,[{key:"mediaWidth",get:function(){var a=void 0,c=this.media;return c&&(a=c.width||c.clientWidth||c.offsetWidth,a*=b.contentScaleFactor),a}},{key:"mediaHeight",get:function(){var a=void 0,c=this.media;return c&&(a=c.height||c.clientHeight||c.offsetHeight,a*=b.contentScaleFactor),a}}],[{key:"contentScaleFactor",get:function(){var a=1;try{a=window.devicePixelRatio}catch(b){}return a}}]),b}(Ja),Kb=Jb,Lb=function(a){function b(c){return W(this,b),X(this,a.call(this,c,Ea.a.MEDIA_ATTACHING))}return Y(b,a),b.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},b.prototype.onMediaAttaching=function(a){var b=this.hls.config;if(b.capLevelOnFPSDrop){var c=this.video=a.media instanceof HTMLVideoElement?a.media:null;"function"==typeof c.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}},b.prototype.checkFPS=function(a,b,c){var d=performance.now();if(b){if(this.lastTime){var e=d-this.lastTime,f=c-this.lastDroppedFrames,g=b-this.lastDecodedFrames,h=1e3*f/e,i=this.hls;if(i.trigger(Ea.a.FPS_DROP,{currentDropped:f,currentDecoded:g,totalDroppedFrames:c}),h>0&&f>i.config.fpsDroppedMonitoringThreshold*g){var j=i.currentLevel;Ga.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+j),j>0&&(-1===i.autoLevelCapping||i.autoLevelCapping>=j)&&(j-=1,i.trigger(Ea.a.FPS_DROP_LEVEL_CAPPING,{level:j,droppedLevel:i.currentLevel}),i.autoLevelCapping=j,i.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}},b.prototype.checkFPSInterval=function(){var a=this.video;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)},b}(Ja),Mb=Lb,Nb=function(){function a(b){Z(this,a),b&&b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}return a.prototype.destroy=function(){this.abort(),this.loader=null},a.prototype.abort=function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},a.prototype.load=function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:performance.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()},a.prototype.loadInternal=function(){var a,b=this.context;a=this.loader=new XMLHttpRequest;var c=this.stats;c.tfirst=0,c.loaded=0;var d=this.xhrSetup;try{if(d)try{d(a,b.url)}catch(e){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0)}catch(e){return void this.callbacks.onError({code:a.status,text:e.message},b,a)}b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()},a.prototype.readystatechange=function(a){var b=a.currentTarget,c=b.readyState,d=this.stats,e=this.context,f=this.config;if(!d.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===d.tfirst&&(d.tfirst=Math.max(performance.now(),d.trequest)),4===c){var g=b.status;if(g>=200&&300>g){d.tload=Math.max(d.tfirst,performance.now());var h=void 0,i=void 0;"arraybuffer"===e.responseType?(h=b.response,i=h.byteLength):(h=b.responseText,i=h.length),d.loaded=d.total=i;var j={url:b.responseURL,data:h};this.callbacks.onSuccess(j,d,e,b)}else d.retry>=f.maxRetry||g>=400&&499>g?(Ga.b.error(g+" while loading "+e.url),this.callbacks.onError({code:g,text:b.statusText},e,b)):(Ga.b.warn(g+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,f.maxRetryDelay),d.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),f.timeout)},a.prototype.loadtimeout=function(){Ga.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},a.prototype.loadprogress=function(a){var b=a.currentTarget,c=this.stats;c.loaded=a.loaded,a.lengthComputable&&(c.total=a.total);var d=this.callbacks.onProgress;d&&d(c,this.context,null,b)},a}(),Ob=Nb,Pb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Qb=function(a){function b(c){$(this,b);var d=_(this,a.call(this,c,Ea.a.MANIFEST_LOADING,Ea.a.MANIFEST_PARSED,Ea.a.AUDIO_TRACK_LOADED,Ea.a.ERROR));return d.ticks=0,d.ontick=d.tick.bind(d),d}return aa(b,a),b.prototype.destroy=function(){this.cleanTimer(),Ja.prototype.destroy.call(this)},b.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},b.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},b.prototype.doTick=function(){this.updateTrack(this.trackId)},b.prototype.onError=function(a){a.fatal&&a.type===Fa.b.NETWORK_ERROR&&this.cleanTimer()},b.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},b.prototype.onManifestParsed=function(a){var b=this,c=a.audioTracks||[],d=!1;this.tracks=c,this.hls.trigger(Ea.a.AUDIO_TRACKS_UPDATED,{audioTracks:c});var e=0;c.forEach(function(a){return a["default"]&&!d?(b.audioTrack=e,void(d=!0)):void e++}),d===!1&&c.length&&(Ga.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},b.prototype.onAudioTrackLoaded=function(a){a.id<this.tracks.length&&(Ga.b.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*a.details.targetduration)),!a.details.live&&this.timer&&this.cleanTimer())},b.prototype.setAudioTrackInternal=function(a){if(a>=0&&a<this.tracks.length){this.cleanTimer(),this.trackId=a,Ga.b.log("switching to audioTrack "+a);var b=this.tracks[a],c=this.hls,d=b.type,e=b.url,f={id:a,type:d,url:e};c.trigger(Ea.a.AUDIO_TRACK_SWITCH,f),c.trigger(Ea.a.AUDIO_TRACK_SWITCHING,f);var g=b.details;!e||void 0!==g&&g.live!==!0||(Ga.b.log("(re)loading playlist for audioTrack "+a),c.trigger(Ea.a.AUDIO_TRACK_LOADING,{url:e,id:a}))}},b.prototype.updateTrack=function(a){if(a>=0&&a<this.tracks.length){this.cleanTimer(),this.trackId=a,Ga.b.log("updating audioTrack "+a);var b=this.tracks[a],c=b.url,d=b.details;!c||void 0!==d&&d.live!==!0||(Ga.b.log("(re)loading playlist for audioTrack "+a),this.hls.trigger(Ea.a.AUDIO_TRACK_LOADING,{url:c,id:a}))}},Pb(b,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){(this.trackId!==a||void 0===this.tracks[a].details)&&this.setAudioTrackInternal(a)}}]),b}(Ja),Rb=Qb,Sb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Tb={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},Ub=function(a){function b(c){ba(this,b);var d=ca(this,a.call(this,c,Ea.a.MEDIA_ATTACHED,Ea.a.MEDIA_DETACHING,Ea.a.AUDIO_TRACKS_UPDATED,Ea.a.AUDIO_TRACK_SWITCHING,Ea.a.AUDIO_TRACK_LOADED,Ea.a.KEY_LOADED,Ea.a.FRAG_LOADED,Ea.a.FRAG_PARSING_INIT_SEGMENT,Ea.a.FRAG_PARSING_DATA,Ea.a.FRAG_PARSED,Ea.a.ERROR,Ea.a.BUFFER_CREATED,Ea.a.BUFFER_APPENDED,Ea.a.BUFFER_FLUSHED,Ea.a.INIT_PTS_FOUND));return d.config=c.config,d.audioCodecSwap=!1,d.ticks=0,d._state=Tb.STOPPED,d.ontick=d.tick.bind(d),d.initPTS=[],d.waitingFragment=null,d.videoTrackCC=null,d}return da(b,a),b.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Ja.prototype.destroy.call(this),this.state=Tb.STOPPED},b.prototype.onInitPtsFound=function(a){var b=a.id,c=a.frag.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,this.videoTrackCC=c,Ga.b.log("InitPTS for cc:"+c+" found from video track:"+d),this.state===Tb.WAITING_INIT_PTS&&this.tick())},b.prototype.startLoad=function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,b>0&&-1===a?(Ga.b.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=Tb.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=Tb.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=Tb.STOPPED},b.prototype.stopLoad=function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Tb.STOPPED},b.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},b.prototype.doTick=function(){var a,b,c,d=this.hls,e=d.config;switch(this.state){case Tb.ERROR:case Tb.PAUSED:case Tb.BUFFER_FLUSHING:break;case Tb.STARTING:this.state=Tb.WAITING_TRACK,this.loadedmetadata=!1;break;case Tb.IDLE:var f=this.tracks;if(!f)break;if(!this.media&&(this.startFragRequested||!e.startFragPrefetch))break;if(this.loadedmetadata)a=this.media.currentTime;else if(a=this.nextLoadPosition,void 0===a)break;var g=this.mediaBuffer?this.mediaBuffer:this.media,h=this.videoBuffer?this.videoBuffer:this.media,i=db.bufferInfo(g,a,e.maxBufferHole),j=db.bufferInfo(h,a,e.maxBufferHole),k=i.len,l=i.end,m=this.fragPrevious,n=Math.max(e.maxBufferLength,j.len),o=this.audioSwitch,p=this.trackId;if((n>k||o)&&p<f.length){if(c=f[p].details,"undefined"==typeof c){this.state=Tb.WAITING_TRACK;break}if(!o&&!c.live&&m&&m.sn===c.endSN&&(!this.media.seeking||this.media.duration-l<m.duration/2)){this.hls.trigger(Ea.a.BUFFER_EOS,{type:"audio"}),this.state=Tb.ENDED;break}var q=c.fragments,r=q.length,s=q[0].start,t=q[r-1].start+q[r-1].duration,u=void 0;if(o)if(c.live&&!c.PTSKnown)Ga.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),l=0;else if(l=a,c.PTSKnown&&s>a){if(!(i.end>s||i.nextStart))return;Ga.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=s+.05}if(c.initSegment&&!c.initSegment.data)u=c.initSegment;else if(s>=l){
if(u=q[0],null!==this.videoTrackCC&&u.cc!==this.videoTrackCC&&(u=x(q,this.videoTrackCC)),c.live&&u.loadIdx&&u.loadIdx===this.fragLoadIdx){var v=i.nextStart?i.nextStart:s;return Ga.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(v+.05)),void(this.media.currentTime=v+.05)}}else{var w=void 0,y=e.maxFragLookUpTolerance,z=m?q[m.sn-q[0].sn+1]:void 0,A=function(a){var b=Math.min(y,a.duration);return a.start+a.duration-b<=l?1:a.start-b>l&&a.start?-1:0};t>l?(l>t-y&&(y=0),w=z&&!A(z)?z:bb.search(q,A)):w=q[r-1],w&&(u=w,s=w.start,m&&u.level===m.level&&u.sn===m.sn&&(u.sn<c.endSN?(u=q[u.sn+1-c.startSN],Ga.b.log("SN just loaded, load next one: "+u.sn)):u=null))}if(u)if(u.decryptdata&&null!=u.decryptdata.uri&&null==u.decryptdata.key)Ga.b.log("Loading key for "+u.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+p),this.state=Tb.KEY_LOADING,d.trigger(Ea.a.KEY_LOADING,{frag:u});else{if(Ga.b.log("Loading "+u.sn+", cc: "+u.cc+" of ["+c.startSN+" ,"+c.endSN+"],track "+p+", currentTime:"+a+",bufferEnd:"+l.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,u.loadCounter){u.loadCounter++;var B=e.fragLoadingLoopThreshold;if(u.loadCounter>B&&Math.abs(this.fragLoadIdx-u.loadIdx)<B)return void d.trigger(Ea.a.ERROR,{type:Fa.b.MEDIA_ERROR,details:Fa.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:u})}else u.loadCounter=1;u.loadIdx=this.fragLoadIdx,this.fragCurrent=u,this.startFragRequested=!0,isNaN(u.sn)||(this.nextLoadPosition=u.start+u.duration),d.trigger(Ea.a.FRAG_LOADING,{frag:u}),this.state=Tb.FRAG_LOADING}}break;case Tb.WAITING_TRACK:b=this.tracks[this.trackId],b&&b.details&&(this.state=Tb.IDLE);break;case Tb.FRAG_LOADING_WAITING_RETRY:var C=performance.now(),D=this.retryDate;g=this.media;var E=g&&g.seeking;(!D||C>=D||E)&&(Ga.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=Tb.IDLE);break;case Tb.WAITING_INIT_PTS:var F=this.videoTrackCC;if(void 0===this.initPTS[F])break;var G=this.waitingFragment;if(G){var H=G.frag.cc;F!==H?(b=this.tracks[this.trackId],b.details&&b.details.live&&(Ga.b.warn("Waiting fragment CC ("+H+") does not match video track CC ("+F+")"),this.waitingFragment=null,this.state=Tb.IDLE)):(this.state=Tb.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=Tb.IDLE;break;case Tb.STOPPED:case Tb.FRAG_LOADING:case Tb.PARSING:case Tb.PARSED:case Tb.ENDED:}},b.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)},b.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(Ga.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.tracks;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},b.prototype.onMediaSeeking=function(){this.state===Tb.ENDED&&(this.state=Tb.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},b.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.prototype.onAudioTracksUpdated=function(a){Ga.b.log("audio tracks updated"),this.tracks=a.audioTracks},b.prototype.onAudioTrackSwitching=function(a){var b=!!a.url;this.trackId=a.id,this.fragCurrent=null,this.state=Tb.PAUSED,this.waitingFragment=null,b?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=Tb.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},b.prototype.onAudioTrackLoaded=function(a){var b=a.details,c=a.id,d=this.tracks[c],e=b.totalduration,f=0;if(Ga.b.log("track "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),b.live){var g=d.details;g&&b.fragments.length>0?(v(g,b),f=b.fragments[0].start,b.PTSKnown?Ga.b.log("live audio playlist sliding:"+f.toFixed(3)):Ga.b.log("live audio playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,Ga.b.log("live audio playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,!this.startFragRequested){if(-1===this.startPosition){var h=b.startTimeOffset;isNaN(h)?this.startPosition=0:(Ga.b.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h)}this.nextLoadPosition=this.startPosition}this.state===Tb.WAITING_TRACK&&(this.state=Tb.IDLE),this.tick()},b.prototype.onKeyLoaded=function(){this.state===Tb.KEY_LOADING&&(this.state=Tb.IDLE,this.tick())},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag;if(this.state===Tb.FRAG_LOADING&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn){var d=this.tracks[this.trackId],e=d.details,f=e.totalduration,g=b.level,h=b.sn,i=b.cc,j=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2",k=this.stats=a.stats;if("initSegment"===h)this.state=Tb.IDLE,k.tparsed=k.tbuffered=performance.now(),e.initSegment.data=a.payload,this.hls.trigger(Ea.a.FRAG_BUFFERED,{stats:k,frag:b,id:"audio"}),this.tick();else{this.state=Tb.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new lb(this.hls,"audio"));var l=this.initPTS[i],m=e.initSegment?e.initSegment.data:[];if(e.initSegment||void 0!==l){this.pendingBuffering=!0,Ga.b.log("Demuxing "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g);var n=!1;this.demuxer.push(a.payload,m,j,null,b,f,n,l)}else Ga.b.log("unknown video PTS for continuity counter "+i+", waiting for video PTS before demuxing audio frag "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g),this.waitingFragment=a,this.state=Tb.WAITING_INIT_PTS}}this.fragLoadError=0},b.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===Tb.PARSING){var d=a.tracks,e=void 0;if(d.video&&delete d.video,e=d.audio){e.levelCodec=e.codec,e.id=a.id,this.hls.trigger(Ea.a.BUFFER_CODECS,d),Ga.b.log("audio track:audio,container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var f=e.initSegment;if(f){var g={type:"audio",data:f,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[g]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Ea.a.BUFFER_APPENDING,g))}this.tick()}}},b.prototype.onFragParsingData=function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"audio"===a.id&&"audio"===a.type&&d.sn===c.sn&&d.level===c.level&&this.state===Tb.PARSING){var e=this.trackId,f=this.tracks[e],g=this.hls;isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),Ga.b.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb),u(f.details,c,a.startPTS,a.endPTS);var h=this.audioSwitch,i=this.media,j=!1;if(h&&i)if(i.readyState){var k=i.currentTime;Ga.b.log("switching audio track : currentTime:"+k),k>=a.startPTS&&(Ga.b.log("switching audio track : flushing all audio"),this.state=Tb.BUFFER_FLUSHING,g.trigger(Ea.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),j=!0,this.audioSwitch=!1,g.trigger(Ea.a.AUDIO_TRACK_SWITCHED,{id:e}))}else this.audioSwitch=!1,g.trigger(Ea.a.AUDIO_TRACK_SWITCHED,{id:e});var l=this.pendingData;this.audioSwitch||([a.data1,a.data2].forEach(function(b){b&&b.length&&l.push({type:a.type,data:b,parent:"audio",content:"data"})}),!j&&l.length&&(l.forEach(function(a){b.state===Tb.PARSING&&(b.pendingBuffering=!0,b.hls.trigger(Ea.a.BUFFER_APPENDING,a))}),this.pendingData=[],this.appended=!0)),this.tick()}},b.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===Tb.PARSING&&(this.stats.tparsed=performance.now(),this.state=Tb.PARSED,this._checkAppendedParsed())},b.prototype.onBufferCreated=function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},b.prototype.onBufferAppended=function(a){if("audio"===a.parent){var b=this.state;(b===Tb.PARSING||b===Tb.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},b.prototype._checkAppendedParsed=function(){if(!(this.state!==Tb.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=this.stats,c=this.hls;if(a){this.fragPrevious=a,b.tbuffered=performance.now(),c.trigger(Ea.a.FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var d=this.mediaBuffer?this.mediaBuffer:this.media;Ga.b.log("audio buffered : "+nb.toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(Ea.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Tb.IDLE}this.tick()}},b.prototype.onError=function(a){var b=a.frag;if(!b||"audio"===b.type)switch(a.details){case Fa.a.FRAG_LOAD_ERROR:case Fa.a.FRAG_LOAD_TIMEOUT:if(!a.fatal){var c=this.fragLoadError;c?c++:c=1;var d=this.config;if(c<=d.fragLoadingMaxRetry){this.fragLoadError=c,b.loadCounter=0;var e=Math.min(Math.pow(2,c-1)*d.fragLoadingRetryDelay,d.fragLoadingMaxRetryTimeout);Ga.b.warn("audioStreamController: frag loading failed, retry in "+e+" ms"),this.retryDate=performance.now()+e,this.state=Tb.FRAG_LOADING_WAITING_RETRY}else Ga.b.error("audioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=Tb.ERROR}break;case Fa.a.FRAG_LOOP_LOADING_ERROR:case Fa.a.AUDIO_TRACK_LOAD_ERROR:case Fa.a.AUDIO_TRACK_LOAD_TIMEOUT:case Fa.a.KEY_LOAD_ERROR:case Fa.a.KEY_LOAD_TIMEOUT:this.state!==Tb.ERROR&&(this.state=a.fatal?Tb.ERROR:Tb.IDLE,Ga.b.warn("audioStreamController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case Fa.a.BUFFER_FULL_ERROR:if("audio"===a.parent&&(this.state===Tb.PARSING||this.state===Tb.PARSED)){var f=this.mediaBuffer,g=this.media.currentTime,h=f&&db.isBuffered(f,g)&&db.isBuffered(f,g+.5);if(h){var i=this.config;i.maxMaxBufferLength>=i.maxBufferLength&&(i.maxMaxBufferLength/=2,Ga.b.warn("audio:reduce max buffer length to "+i.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.state=Tb.IDLE}else Ga.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Tb.BUFFER_FLUSHING,this.hls.trigger(Ea.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},b.prototype.onBufferFlushed=function(){var a=this,b=this.pendingData;b&&b.length?(Ga.b.log("appending pending audio data on Buffer Flushed"),b.forEach(function(b){a.hls.trigger(Ea.a.BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=Tb.PARSED):(this.state=Tb.IDLE,this.fragPrevious=null,this.tick())},Sb(b,[{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,Ga.b.log("audio stream:"+b+"->"+a)}},get:function(){return this._state}}]),b}(Ja),Vb=Ub,Wb=function(){function a(a){if("string"!=typeof a)return!1;var b=f[a.toLowerCase()];return b?a.toLowerCase():!1}function b(a){if("string"!=typeof a)return!1;var b=g[a.toLowerCase()];return b?a.toLowerCase():!1}function c(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function d(d,f,g){var h=this,i=function(){return"undefined"!=typeof navigator?/MSIE\s8\.0/.test(navigator.userAgent):void 0}(),j={};i?h=document.createElement("custom"):j.enumerable=!0,h.hasBeenReset=!1;var k="",l=!1,m=d,n=f,o=g,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle";return Object.defineProperty(h,"id",c({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(h,"pauseOnExit",c({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(h,"startTime",c({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",c({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",c({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",c({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",c({},j,{get:function(){return q},set:function(b){var c=a(b);if(c===!1)throw new SyntaxError("An invalid or illegal string was specified.");q=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",c({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",c({},j,{get:function(){return s},set:function(a){if("number"!=typeof a&&a!==e)throw new SyntaxError("An invalid number or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",c({},j,{get:function(){return t},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",c({},j,{get:function(){return u},set:function(a){if(0>a||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",c({},j,{get:function(){return v},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",c({},j,{get:function(){return w},set:function(a){if(0>a||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",c({},j,{get:function(){return x},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");x=c,this.hasBeenReset=!0}})),h.displayState=void 0,i?h:void 0}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",f={"":!0,lr:!0,rl:!0},g={start:!0,middle:!0,end:!0,left:!0,right:!0};return d.prototype.getCueAsHTML=function(){var a=window.WebVTT;return a.convertCueToDOMTree(window,this.text)},d}(),Xb=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};ga.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){var c;return(c=b.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(b=parseFloat(b),b>=0&&100>=b)?(this.set(a,b),!0):!1}};var Yb=new Wb(0,0,0),Zb="middle"===Yb.align?"middle":"center";ea.prototype={parse:function(a){function b(){var a=d.buffer,b=0;for(a=ja(a);b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,d.buffer=a.substr(b),c}function c(a){ha(a,function(a,b){switch(a){case"Region":console.log("parse region",b)}},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{var e;if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;e=b();var f=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!f||!f[0])throw new Error("Malformed WebVTT signature.");d.state="HEADER"}for(var g=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;switch(g?g=!1:e=b(),d.state){case"HEADER":/:/.test(e)?c(e):e||(d.state="ID");continue;case"NOTE":e||(d.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){d.state="NOTE";break}if(!e)continue;if(d.cue=new Wb(0,0,""),d.state="CUE",-1===e.indexOf("-->")){d.cue.id=e;continue}case"CUE":try{ia(e,d.cue,d.regionList)}catch(h){d.cue=null,d.state="BADCUE";continue}d.state="CUETEXT";continue;case"CUETEXT":var i=-1!==e.indexOf("-->");if(!e||i&&(g=!0)){d.oncue&&d.oncue(d.cue),d.cue=null,d.state="ID";continue}d.cue.text&&(d.cue.text+="\n"),d.cue.text+=e;continue;case"BADCUE":e||(d.state="ID");continue}}}catch(h){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state)throw new Error("Malformed WebVTT signature.")}catch(b){throw b}return a.onflush&&a.onflush(),this}};var $b=ea,_b={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ac=function(a){var b=a;return _b.hasOwnProperty(a)&&(b=_b[a]),String.fromCharCode(b)},bc=15,cc=100,dc={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ec={17:2,18:4,21:6,22:8,23:10,19:13,20:15},fc={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},gc={25:2,26:4,29:6,30:8,31:10,27:13,28:15},hc=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],ic={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){var c=this.verboseFilter[a];this.verboseLevel>=c&&console.log(this.time+" ["+a+"] "+b)}},jc=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},kc=function(){function a(b,c,d,e,f){la(this,a),this.foreground=b||"white",this.underline=c||!1,this.italics=d||!1,this.background=e||"black",this.flash=f||!1}return a.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.prototype.setStyles=function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}},a.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},a.prototype.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},a.prototype.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},a.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),lc=function(){function a(b,c,d,e,f,g){la(this,a),this.uchar=b||" ",this.penState=new kc(c,d,e,f,g)}return a.prototype.reset=function(){this.uchar=" ",this.penState.reset()},a.prototype.setChar=function(a,b){this.uchar=a,this.penState.copy(b)},a.prototype.setPenState=function(a){this.penState.copy(a)},a.prototype.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},a.prototype.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},a.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},a}(),mc=function(){function a(){la(this,a),this.chars=[];for(var b=0;cc>b;b++)this.chars.push(new lc);this.pos=0,this.currPenState=new kc}return a.prototype.equals=function(a){for(var b=!0,c=0;cc>c;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;cc>b;b++)this.chars[b].copy(a.chars[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;cc>b;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a},a.prototype.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(ic.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>cc&&(ic.log("ERROR","Too large cursor position "+this.pos),this.pos=cc)},a.prototype.moveCursor=function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;b+1>c;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)},a.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.prototype.insertChar=function(a){a>=144&&this.backSpace();var b=ac(a);return this.pos>=cc?void ic.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),void this.moveCursor(1))},a.prototype.clearFromPos=function(a){var b;for(b=a;cc>b;b++)this.chars[b].reset()},a.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.prototype.getTextString=function(){for(var a=[],b=!0,c=0;cc>c;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")},a.prototype.setPenStyles=function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)},a}(),nc=function(){function a(){la(this,a),this.rows=[];for(var b=0;bc>b;b++)this.rows.push(new mc);this.currRow=bc-1,this.nrRollUpRows=null,this.reset()}return a.prototype.reset=function(){for(var a=0;bc>a;a++)this.rows[a].clear();this.currRow=bc-1},a.prototype.equals=function(a){for(var b=!0,c=0;bc>c;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;bc>b;b++)this.rows[b].copy(a.rows[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;bc>b;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a},a.prototype.backSpace=function(){var a=this.rows[this.currRow];a.backSpace()},a.prototype.clearToEndOfRow=function(){var a=this.rows[this.currRow];a.clearToEndOfRow()},a.prototype.insertChar=function(a){var b=this.rows[this.currRow];b.insertChar(a)},a.prototype.setPen=function(a){var b=this.rows[this.currRow];b.setPenStyles(a)},a.prototype.moveCursor=function(a){var b=this.rows[this.currRow];b.moveCursor(a)},a.prototype.setCursor=function(a){ic.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)},a.prototype.setPAC=function(a){ic.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;bc>c;c++)this.rows[c].clear();var d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var f=e.rows[d].cueStartTime;if(f&&f<ic.time)for(var g=0;g<this.nrRollUpRows;g++)this.rows[b-this.nrRollUpRows+g+1].copy(e.rows[d+g])}}this.currRow=b;var h=this.rows[this.currRow];if(null!==a.indent){var i=a.indent,j=Math.max(i-1,0);h.setCursor(a.indent),a.color=h.chars[j].penState.foreground}var k={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(k)},a.prototype.setBkgData=function(a){ic.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},a.prototype.setRollUpRows=function(a){this.nrRollUpRows=a},a.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void ic.log("DEBUG","roll_up but nrRollUpRows not set yet");ic.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),ic.log("INFO","Rolling up")},a.prototype.getDisplayText=function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;bc>e;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c},a.prototype.getTextAndFormat=function(){return this.rows},a}(),oc=function(){function a(b,c){la(this,a),this.chNr=b,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new nc,this.nonDisplayedMemory=new nc,this.lastOutputScreen=new nc,this.currRollUpRow=this.displayedMemory.rows[bc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[bc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},a.prototype.getHandler=function(){return this.outputFilter},a.prototype.setHandler=function(a){this.outputFilter=a},a.prototype.setPAC=function(a){this.writeScreen.setPAC(a)},a.prototype.setBkgData=function(a){this.writeScreen.setBkgData(a)},a.prototype.setMode=function(a){a!==this.mode&&(this.mode=a,ic.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},a.prototype.insertChars=function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";ic.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(ic.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.prototype.ccRCL=function(){ic.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.prototype.ccBS=function(){ic.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.prototype.ccAOF=function(){},a.prototype.ccAON=function(){},a.prototype.ccDER=function(){ic.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.prototype.ccRU=function(a){ic.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},a.prototype.ccFON=function(){ic.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.prototype.ccRDC=function(){ic.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.prototype.ccTR=function(){ic.log("INFO","TR"),this.setMode("MODE_TEXT")},a.prototype.ccRTD=function(){ic.log("INFO","RTD"),this.setMode("MODE_TEXT")},a.prototype.ccEDM=function(){ic.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.prototype.ccCR=function(){ic.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.prototype.ccENM=function(){ic.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.prototype.ccEOC=function(){if(ic.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,ic.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.prototype.ccTO=function(a){ic.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},a.prototype.ccMIDROW=function(a){var b={flash:!1};if(b.underline=a%2===1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}ic.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)},a.prototype.outputDataUpdate=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,b=ic.time;null!==b&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen),a===!0&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:b):this.cueStartTime=b,this.lastOutputScreen.copy(this.displayedMemory))},a.prototype.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},a}(),pc=function(){function a(b,c,d){la(this,a),this.field=b||1,this.outputs=[c,d],this.channels=[new oc(1,c),new oc(2,d)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}}return a.prototype.getHandler=function(a){return this.channels[a].getHandler()},a.prototype.setHandler=function(a,b){this.channels[a].setHandler(b)},a.prototype.addData=function(a,b){var c,d,e,f=!1;this.lastTime=a,ic.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(ic.log("DATA","["+jc([b[g],b[g+1]])+"] -> ("+jc([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else ic.log("WARNING","No channel found yet. TEXT-MODE?");c?this.dataCounters.cmd+=2:f?this.dataCounters["char"]+=2:(this.dataCounters.other+=2,ic.log("WARNING","Couldn't parse cleaned data "+jc([d,e])+" orig: "+jc([b[g],b[g+1]])))}else this.dataCounters.padding+=2},a.prototype.parseCmd=function(a,b){var c=null,d=(20===a||28===a)&&b>=32&&47>=b,e=(23===a||31===a)&&b>=33&&35>=b;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,ic.log("DEBUG","Repeated command ("+jc([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.parseMidrow=function(a,b){var c=null;if((17===a||25===a)&&b>=32&&47>=b){if(c=17===a?1:2,c!==this.currChNr)return ic.log("ERROR","Mismatch channel in midrow parsing"),!1;var d=this.channels[c-1];return d.ccMIDROW(b),ic.log("DEBUG","MIDROW ("+jc([a,b])+")"),!0}return!1},a.prototype.parsePAC=function(a,b){var c=null,d=null,e=(a>=17&&23>=a||a>=25&&31>=a)&&b>=64&&127>=b,f=(16===a||24===a)&&b>=64&&95>=b;if(!e&&!f)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=23>=a?1:2,d=b>=64&&95>=b?1===c?dc[a]:fc[a]:1===c?ec[a]:gc[a];var g=this.interpretPAC(d,b),h=this.channels[c-1];return h.setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.interpretPAC=function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),13>=c?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:15>=c?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d},a.prototype.parseChars=function(a,b){var c=null,d=null,e=null;if(a>=25?(c=2,e=a-8):(c=1,e=a),e>=17&&19>=e){var f=b;f=17===e?b+80:18===e?b+112:b+144,ic.log("INFO","Special char '"+ac(f)+"' in channel "+c),d=[f]}else a>=32&&127>=a&&(d=0===b?[a]:[a,b]);if(d){var g=jc(d);ic.log("DEBUG","Char codes =  "+g.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d},a.prototype.parseBackgroundAttributes=function(a,b){var c,d,e,f,g=(16===a||24===a)&&b>=32&&47>=b,h=(23===a||31===a)&&b>=45&&47>=b;return g||h?(c={},16===a||24===a?(d=Math.floor((b-32)/2),
c.background=hc[d],b%2===1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=24>a?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0):!1},a.prototype.reset=function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null},a.prototype.cueSplitAtTime=function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)},a}(),qc=pc,rc=function(){function a(b,c){ma(this,a),this.timelineController=b,this.track=c,this.startTime=null,this.endTime=null,this.screen=null}return a.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},a.prototype.newCue=function(a,b,c){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=b,this.screen=c,this.timelineController.createCaptionsTrack(this.track)},a}(),sc=rc,tc=function(a,b,c){return a.substr(c||0,b.length)===b},uc=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),d=parseInt(a.substr(-9,2)),e=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;return isNaN(b)||isNaN(c)||isNaN(d)||isNaN(e)?-1:(b+=1e3*c,b+=6e4*d,b+=36e5*e)},vc=function Lc(a){for(var Lc=5381,b=a.length;b;)Lc=33*Lc^a.charCodeAt(--b);return(Lc>>>0).toString()},wc=function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e["new"]&&d["new"])return a.ccOffset=a.presentationOffset=d.start,void(d["new"]=!1);for(;e&&e["new"];)a.ccOffset+=d.start-e.start,d["new"]=!1,d=e,e=a[d.prevCC];a.presentationOffset=c},xc={parse:function(a,b,c,d,e,f){var g=/\r\n|\n\r|\n|\r/g,h=Object(vb.b)(new Uint8Array(a)).trim().replace(g,"\n").split("\n"),i="00:00.000",j=0,k=0,l=0,m=[],n=void 0,o=!0,p=new $b;p.oncue=function(a){var b=c[d],e=c.ccOffset;b&&b["new"]&&(void 0!==k?e=c.ccOffset=b.start:wc(c,d,l)),l&&(e=l+c.ccOffset-c.presentationOffset),a.startTime+=e-k,a.endTime+=e-k,a.id=vc(a.startTime.toString())+vc(a.endTime.toString())+vc(a.text),a.text=decodeURIComponent(encodeURIComponent(a.text)),a.endTime>0&&m.push(a)},p.onparsingerror=function(a){n=a},p.onflush=function(){return n&&f?void f(n):void e(m)},h.forEach(function(a){if(o){if(tc(a,"X-TIMESTAMP-MAP=")){o=!1,a.substr(16).split(",").forEach(function(a){tc(a,"LOCAL:")?i=a.substr(6):tc(a,"MPEGTS:")&&(j=parseInt(a.substr(7)))});try{b=0>b?b+8589934592:b,j-=b,k=uc(i)/1e3,l=j/9e4,-1===k&&(n=new Error("Malformed X-TIMESTAMP-MAP: "+a))}catch(c){n=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}""===a&&(o=!1)}p.parse(a+"\n")}),p.flush()}},yc=xc,zc=function(a){function b(c){na(this,b);var d=oa(this,a.call(this,c,Ea.a.MEDIA_ATTACHING,Ea.a.MEDIA_DETACHING,Ea.a.FRAG_PARSING_USERDATA,Ea.a.FRAG_DECRYPTED,Ea.a.MANIFEST_LOADING,Ea.a.MANIFEST_LOADED,Ea.a.FRAG_LOADED,Ea.a.LEVEL_SWITCHING,Ea.a.INIT_PTS_FOUND));if(d.hls=c,d.config=c.config,d.enabled=!0,d.Cues=c.config.cueHandler,d.textTracks=[],d.tracks=[],d.unparsedVttFrags=[],d.initPTS=void 0,d.cueRanges=[],d.config.enableCEA708Captions){var e=new sc(d,1),f=new sc(d,2);d.cea608Parser=new qc(0,e,f)}return d}return pa(b,a),b.prototype.addCues=function(a,b,c,d){for(var e=this.cueRanges,f=!1,g=e.length;g--;){var h=e[g],i=sa(h[0],h[1],b,c);if(i>=0&&(h[0]=Math.min(h[0],b),h[1]=Math.max(h[1],c),f=!0,i/(c-b)>.5))return}f||e.push([b,c]),this.Cues.newCue(this[a],b,c,d)},b.prototype.onInitPtsFound=function(a){var b=this;"undefined"==typeof this.initPTS&&(this.initPTS=a.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(a){b.onFragLoaded(a)}),this.unparsedVttFrags=[])},b.prototype.getExistingTrack=function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c],e="textTrack"+a;if(d[e]===!0)return d}return null},b.prototype.sendAddTrackEvent=function(a,b){var c=null;try{c=new window.Event("addtrack")}catch(d){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)},b.prototype.createCaptionsTrack=function(a){var b="textTrack"+a;if(!this[b]){var c=this.getExistingTrack(a);if(c)this[b]=c,qa(this[b]),this.sendAddTrackEvent(this[b],this.media);else{var d=this.createTextTrack("captions",this.config["captionsTextTrack"+a+"Label"],this.config.captionsTextTrack1LanguageCode);d&&(d[b]=!0,this[b]=d)}}},b.prototype.createTextTrack=function(a,b,c){var d=this.media;return d?d.addTextTrack(a,b,c):void 0},b.prototype.destroy=function(){Ja.prototype.destroy.call(this)},b.prototype.onMediaAttaching=function(a){this.media=a.media,this._cleanTracks()},b.prototype.onMediaDetaching=function(){qa(this.textTrack1),qa(this.textTrack2)},b.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},b.prototype._cleanTracks=function(){var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)qa(b[c])}},b.prototype.onManifestLoaded=function(a){var b=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=a.subtitles||[];var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,d){var e=void 0;if(d<c.length){var f=c[d];ra(f,a)&&(e=f)}e||(e=b.createTextTrack("subtitles",a.name,a.lang)),e.mode=a["default"]?"showing":"hidden",b.textTracks.push(e)})}},b.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},b.prototype.onFragLoaded=function(a){var b=a.frag,c=a.payload;if("main"===b.type){var d=b.sn;if(d!==this.lastSn+1){var e=this.cea608Parser;e&&e.reset()}this.lastSn=d}else if("subtitle"===b.type)if(c.byteLength){if("undefined"==typeof this.initPTS)return void this.unparsedVttFrags.push(a);var f=b.decryptdata;(null==f||null==f.key||"AES-128"!==f.method)&&this._parseVTTs(b,c)}else this.hls.trigger(Ea.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})},b.prototype._parseVTTs=function(a,b){var c=this.vttCCs;c[a.cc]||(c[a.cc]={start:a.start,prevCC:this.prevCC,"new":!0},this.prevCC=a.cc);var d=this.textTracks,e=this.hls;yc.parse(b,this.initPTS,c,a.cc,function(b){var c=d[a.trackId];b.forEach(function(a){if(!c.cues.getCueById(a.id))try{c.addCue(a)}catch(b){var d=new window.TextTrackCue(a.startTime,a.endTime,a.text);d.id=a.id,c.addCue(d)}}),e.trigger(Ea.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(b){Ga.b.log("Failed to parse VTT cue: "+b),e.trigger(Ea.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a})})},b.prototype.onFragDecrypted=function(a){var b=a.payload,c=a.frag;if("subtitle"===c.type){if("undefined"==typeof this.initPTS)return void this.unparsedVttFrags.push(a);this._parseVTTs(c,b)}},b.prototype.onFragParsingUserdata=function(a){if(this.enabled&&this.config.enableCEA708Captions)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}},b.prototype.extractCea608Data=function(a){for(var b,c,d,e,f,g=31&a[0],h=2,i=[],j=0;g>j;j++)b=a[h++],c=127&a[h++],d=127&a[h++],e=0!==(4&b),f=3&b,(0!==c||0!==d)&&e&&0===f&&(i.push(c),i.push(d));return i},b}(Ja),Ac=zc,Bc=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Cc=function(a){function b(c){ta(this,b);var d=ua(this,a.call(this,c,Ea.a.MEDIA_ATTACHED,Ea.a.MEDIA_DETACHING,Ea.a.MANIFEST_LOADING,Ea.a.MANIFEST_LOADED,Ea.a.SUBTITLE_TRACK_LOADED));return d.tracks=[],d.trackId=-1,d.media=void 0,d.subtitleDisplay=!1,d}return va(b,a),b.prototype._onTextTracksChanged=function(){if(this.media){for(var a=-1,b=wa(this.media.textTracks),c=0;c<b.length;c++)"showing"===b[c].mode&&(a=c);this.subtitleTrack=a}},b.prototype.destroy=function(){Ja.prototype.destroy.call(this)},b.prototype.onMediaAttached=function(a){var b=this;this.media=a.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){b.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},b.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},b.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},b.prototype.onManifestLoaded=function(a){var b=this,c=a.subtitles||[];this.tracks=c,this.trackId=-1,this.hls.trigger(Ea.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:c}),c.forEach(function(a){a["default"]&&(b.media?b.subtitleTrack=a.id:b.queuedDefaultTrack=a.id)})},b.prototype.onTick=function(){var a=this.trackId,b=this.tracks[a];if(b){var c=b.details;(void 0===c||c.live===!0)&&(Ga.b.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(Ea.a.SUBTITLE_TRACK_LOADING,{url:b.url,id:a}))}},b.prototype.onSubtitleTrackLoaded=function(a){var b=this;a.id<this.tracks.length&&(Ga.b.log("subtitle track "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(function(){b.onTick()},1e3*a.details.targetduration,this)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},b.prototype.setSubtitleTrackInternal=function(a){if(!(-1>a||a>=this.tracks.length)){this.timer&&(clearInterval(this.timer),this.timer=null);var b=wa(this.media.textTracks);if(-1!==this.trackId&&this.subtitleDisplay&&(b[this.trackId].mode="hidden"),this.trackId=a,Ga.b.log("switching to subtitle track "+a),this.hls.trigger(Ea.a.SUBTITLE_TRACK_SWITCH,{id:a}),-1!==a){var c=this.tracks[a];this.subtitleDisplay&&(b[a].mode="showing");var d=c.details;(void 0===d||d.live===!0)&&(Ga.b.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(Ea.a.SUBTITLE_TRACK_LOADING,{url:c.url,id:a}))}}},Bc(b,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.trackId!==a&&this.setSubtitleTrackInternal(a)}}]),b}(Ja),Dc=Cc,Ec=c(4),Fc={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},Gc=function(a){function b(c){xa(this,b);var d=ya(this,a.call(this,c,Ea.a.MEDIA_ATTACHED,Ea.a.ERROR,Ea.a.KEY_LOADED,Ea.a.FRAG_LOADED,Ea.a.SUBTITLE_TRACKS_UPDATED,Ea.a.SUBTITLE_TRACK_SWITCH,Ea.a.SUBTITLE_TRACK_LOADED,Ea.a.SUBTITLE_FRAG_PROCESSED));return d.config=c.config,d.vttFragSNsProcessed={},d.vttFragQueues=void 0,d.currentlyProcessing=null,d.state=Fc.STOPPED,d.currentTrackId=-1,d.ticks=0,d.decrypter=new Ec.a(c.observer,c.config),d}return za(b,a),b.prototype.destroy=function(){Ja.prototype.destroy.call(this),this.state=Fc.STOPPED},b.prototype.clearVttFragQueues=function(){var a=this;this.vttFragQueues={},this.tracks.forEach(function(b){a.vttFragQueues[b.id]=[]})},b.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var a=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=a,this.hls.trigger(Ea.a.FRAG_LOADING,{frag:a}),this.state=Fc.FRAG_LOADING}},b.prototype.onSubtitleFragProcessed=function(a){a.success&&this.vttFragSNsProcessed[a.frag.trackId].push(a.frag.sn),this.currentlyProcessing=null,this.state=Fc.IDLE,this.nextFrag()},b.prototype.onMediaAttached=function(){this.state=Fc.IDLE},b.prototype.onError=function(a){var b=a.frag;b&&"subtitle"!==b.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},b.prototype.tick=function(){var a=this;this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(function(){a.tick()},1),this.ticks=0)},b.prototype.doTick=function(){var a=this;switch(this.state){case Fc.IDLE:var b=this.tracks,c=this.currentTrackId,d=this.vttFragSNsProcessed[c],e=this.vttFragQueues[c],f=this.currentlyProcessing?this.currentlyProcessing.sn:-1,g=function(a){return d.indexOf(a.sn)>-1},h=function(a){return e.some(function(b){return b.sn===a.sn})};if(!b)break;var i;if(c<b.length&&(i=b[c].details),"undefined"==typeof i)break;i.fragments.forEach(function(b){g(b)||b.sn===f||h(b)||(b.decryptdata&&null!=b.decryptdata.uri&&null==b.decryptdata.key?(Ga.b.log("Loading key for "+b.sn),a.state=Fc.KEY_LOADING,a.hls.trigger(Ea.a.KEY_LOADING,{frag:b})):(b.trackId=c,e.push(b),a.nextFrag()))})}},b.prototype.onSubtitleTracksUpdated=function(a){var b=this;Ga.b.log("subtitle tracks updated"),this.tracks=a.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(a){b.vttFragSNsProcessed[a.id]=[]})},b.prototype.onSubtitleTrackSwitch=function(a){this.currentTrackId=a.id,this.clearVttFragQueues()},b.prototype.onSubtitleTrackLoaded=function(){this.tick()},b.prototype.onKeyLoaded=function(){this.state===Fc.KEY_LOADING&&(this.state=Fc.IDLE,this.tick())},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag.decryptdata,d=a.frag,e=this.hls;if(this.state===Fc.FRAG_LOADING&&b&&"subtitle"===a.frag.type&&b.sn===a.frag.sn&&a.payload.byteLength>0&&null!=c&&null!=c.key&&"AES-128"===c.method){var f;try{f=performance.now()}catch(g){f=Date.now()}this.decrypter.decrypt(a.payload,c.key.buffer,c.iv.buffer,function(a){var b;try{b=performance.now()}catch(c){b=Date.now()}e.trigger(Ea.a.FRAG_DECRYPTED,{frag:d,payload:a,stats:{tstart:f,tdecrypt:b}})})}},b}(Ja),Hc=Gc,Ic={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ob,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:Eb,bufferController:Hb,capLevelController:Kb,fpsController:Mb,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};Ic.subtitleStreamController=Hc,Ic.subtitleTrackController=Dc,Ic.timelineController=Ac,Ic.cueHandler=Ba,Ic.enableCEA708Captions=!0,Ic.enableWebVTT=!0,Ic.captionsTextTrack1Label="English",Ic.captionsTextTrack1LanguageCode="en",Ic.captionsTextTrack2Label="Spanish",Ic.captionsTextTrack2LanguageCode="es",Ic.audioStreamController=Vb,Ic.audioTrackController=Rb;var Jc=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Kc=function(){function a(){var b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Aa(this,a);var d=a.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var e in d)e in c||(c[e]=d[e]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(Ga.a)(c.debug),this.config=c,this._autoLevelCapping=-1;var f=this.observer=new gb.a;f.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];f.emit.apply(f,[a,a].concat(c))},f.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];f.removeListener.apply(f,[a].concat(c))},this.on=f.on.bind(f),this.off=f.off.bind(f),this.trigger=f.trigger.bind(f);var g=this.abrController=new c.abrController(this),h=new c.bufferController(this),i=new c.capLevelController(this),j=new c.fpsController(this),k=new Xa(this),l=new Za(this),m=new _a(this),n=new xb(this),o=this.levelController=new ub(this),p=this.streamController=new rb(this),q=[o,p],r=c.audioStreamController;r&&q.push(new r(this)),this.networkControllers=q;var s=[k,l,m,g,h,i,j,n];if(r=c.audioTrackController){var t=new r(this);this.audioTrackController=t,s.push(t)}if(r=c.subtitleTrackController){var u=new r(this);this.subtitleTrackController=u,s.push(u)}[c.subtitleStreamController,c.timelineController].forEach(function(a){a&&s.push(new a(b))}),this.coreComponents=s}return a.isSupported=function(){var a=r(),b=window.SourceBuffer||window.WebKitSourceBuffer,c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),d=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return c&&d},Jc(a,null,[{key:"version",get:function(){return"0.8.7"}},{key:"Events",get:function(){return Ea.a}},{key:"ErrorTypes",get:function(){return Fa.b}},{key:"ErrorDetails",get:function(){return Fa.a}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:Ic},set:function(b){a.defaultConfig=b}}]),a.prototype.destroy=function(){Ga.b.log("destroy"),this.trigger(Ea.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},a.prototype.attachMedia=function(a){Ga.b.log("attachMedia"),this.media=a,this.trigger(Ea.a.MEDIA_ATTACHING,{media:a})},a.prototype.detachMedia=function(){Ga.b.log("detachMedia"),this.trigger(Ea.a.MEDIA_DETACHING),this.media=null},a.prototype.loadSource=function(a){a=Da.a.buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0}),Ga.b.log("loadSource:"+a),this.url=a,this.trigger(Ea.a.MANIFEST_LOADING,{url:a})},a.prototype.startLoad=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;Ga.b.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})},a.prototype.stopLoad=function(){Ga.b.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},a.prototype.swapAudioCodec=function(){Ga.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.prototype.recoverMediaError=function(){Ga.b.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)},Jc(a,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){Ga.b.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){Ga.b.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){Ga.b.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){Ga.b.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){Ga.b.log("set startLevel:"+a);var b=this;-1!==a&&(a=Math.max(a,b.minAutoLevel)),b.levelController.startLevel=a}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){Ga.b.log("set autoLevelCapping:"+a),this._autoLevelCapping=a}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var a=this,b=a.levels,c=a.config.minAutoBitrate,d=b?b.length:0,e=0;d>e;e++){var f=b[e].realBitrate?Math.max(b[e].realBitrate,b[e].bitrate):b[e].bitrate;if(f>c)return e}return 0}},{key:"maxAutoLevel",get:function(){var a=this,b=a.levels,c=a.autoLevelCapping,d=void 0;return d=-1===c&&b&&b.length?b.length-1:c}},{key:"nextAutoLevel",get:function(){var a=this;return Math.min(Math.max(a.abrController.nextAutoLevel,a.minAutoLevel),a.maxAutoLevel)},set:function(a){var b=this;b.abrController.nextAutoLevel=Math.max(b.minAutoLevel,a)}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)}},{key:"subtitleDisplay",get:function(){var a=this.subtitleTrackController;return a?a.subtitleDisplay:!1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleDisplay=a)}}]),a}();b["default"]=Kc},function(a,b,c){function d(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/",b.oe=function(a){throw console.error(a),a};var d=b(b.s=ENTRY_MODULE);return d["default"]||d}function e(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(a){var b=[],c=a.toString(),d=c.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return b;for(var f,g=d[1],h=new RegExp("(\\\\n|\\W)"+e(g)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");f=h.exec(c);)b.push(f[3]);return b}function g(a,b){for(var c=[b],d=[],e={};c.length;){var g=c.pop();if(!e[g]&&a[g]){e[g]=!0,d.push(g);var h=f(a[g]);c=c.concat(h)}}return d}a.exports=function(a,b){b=b||{};var e=c.m,f=b.all?Object.keys(e):g(e,a),h="("+d.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+f.map(function(a){return""+JSON.stringify(a)+": "+e[a].toString()}).join(",")+"})(self);",i=new window.Blob([h],{type:"text/javascript"});if(b.bare)return i;var j=window.URL||window.webkitURL||window.mozURL||window.msURL,k=j.createObjectURL(i),l=new window.Worker(k);return l.objectURL=k,l}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(7),e=c(1),f=c(0),g=c(5),h=c.n(g),i=function(a){var b=new h.a;b.trigger=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];b.emit.apply(b,[a,a].concat(d))},b.off=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];b.removeListener.apply(b,[a].concat(d))};var c=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(e){var g=e.data;switch(g.cmd){case"init":var h=JSON.parse(g.config);a.demuxer=new d.a(b,g.typeSupported,h,g.vendor);try{Object(f.a)(h.debug===!0)}catch(i){console.warn("demuxerWorker: unable to enable logs")}c("init",null);break;case"demux":a.demuxer.push(g.data,g.decryptdata,g.initSegment,g.audioCodec,g.videoCodec,g.timeOffset,g.discontinuity,g.trackSwitch,g.contiguous,g.duration,g.accurateTimeOffset,g.defaultInitPTS)}}),b.on(e.a.FRAG_DECRYPTED,c),b.on(e.a.FRAG_PARSING_INIT_SEGMENT,c),b.on(e.a.FRAG_PARSED,c),b.on(e.a.ERROR,c),b.on(e.a.FRAG_PARSING_METADATA,c),b.on(e.a.FRAG_PARSING_USERDATA,c),b.on(e.a.INIT_PTS_FOUND,c),b.on(e.a.FRAG_PARSING_DATA,function(b,c){var d=[],e={event:b,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),a.postMessage(e,d)})};b["default"]=i}])["default"]}),!function(){function a(a){console.log("$f.fireEvent",[].slice.call(a))}function b(a){if(!a||"object"!=typeof a)return a;var c=new a.constructor;for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d]));return c}function c(a,b){if(a){var c,d=0,e=a.length;if(void 0===e){for(c in a)if(b.call(a[c],c,a[c])===!1)break}else for(var f=a[0];e>d&&b.call(f,d,f)!==!1;f=a[++d]);return a}}function d(a){return document.getElementById(a)}function e(a,b,d){return"object"!=typeof b?a:(a&&b&&c(b,function(b,c){d&&"function"==typeof c||(a[b]=c)}),a)}function f(a){var b=a.indexOf(".");if(-1!=b){var d=a.slice(0,b)||"*",e=a.slice(b+1,a.length),f=[];return c(document.getElementsByTagName(d),function(){this.className&&-1!=this.className.indexOf(e)&&f.push(this)}),f}}function g(a){return a=a||window.event,a.preventDefault?(a.stopPropagation(),a.preventDefault()):(a.returnValue=!1,a.cancelBubble=!0),!1}function h(a,b,c){a[b]=a[b]||[],a[b].push(c)}function i(a){return a.replace(/&amp;/g,"%26").replace(/&/g,"%26").replace(/=/g,"%3D")}function j(){return"_"+(""+Math.random()).slice(2,10)}function k(f,k,l){function p(){function a(a){return!/iPad|iPhone|iPod/i.test(navigator.userAgent)||/.flv$/i.test(B[0].url)||b()?(y.isLoaded()||y._fireEvent("onBeforeClick")===!1||y.load(),g(a)):!0}function b(){return y.hasiPadSupport&&y.hasiPadSupport()}function d(){""!==q.replace(/\s/g,"")?f.addEventListener?f.addEventListener("click",a,!1):f.attachEvent&&f.attachEvent("onclick",a):(f.addEventListener&&!b()&&f.addEventListener("click",g,!1),y.load())}$f(f)?($f(f).getParent().innerHTML="",u=$f(f).getIndex(),o[u]=y):(o.push(y),u=o.length-1),x=parseInt(f.style.height,10)||f.clientHeight,s=f.id||"fp"+j(),t=k.id||s+"_api",k.id=t,q=f.innerHTML,"string"==typeof l&&(l={clip:{url:l}}),l.playerId=s,l.clip=l.clip||{},f.getAttribute("href",2)&&!l.clip.url&&(l.clip.url=f.getAttribute("href",2)),l.clip.url&&(l.clip.url=i(l.clip.url)),r=new m(l.clip,-1,y),l.playlist=l.playlist||[l.clip];var e=0;c(l.playlist,function(){var a=this;"object"==typeof a&&a.length&&(a={url:""+a}),a.url&&(a.url=i(a.url)),c(l.clip,function(b,c){void 0!==c&&void 0===a[b]&&"function"!=typeof c&&(a[b]=c)}),l.playlist[e]=a,a=new m(a,e,y),B.push(a),e++}),c(l,function(a,b){"function"==typeof b&&(r[a]?r[a](b):h(D,a,b),delete l[a])}),c(l.plugins,function(a,b){b&&(C[a]=new n(a,b,y))}),l.plugins&&void 0!==l.plugins.controls||(C.controls=new n("controls",null,y)),C.canvas=new n("canvas",null,y),q=f.innerHTML,setTimeout(d,0)}var q,r,s,t,u,v,w,x,y=this,z=null,A=!1,B=[],C={},D={};if(e(y,{id:function(){return s},isLoaded:function(){return null!==z&&void 0!==z.fp_play&&!A},getParent:function(){return f},hide:function(a){return a&&(f.style.height="0px"),y.isLoaded()&&(z.style.height="0px"),y},show:function(){return f.style.height=x+"px",y.isLoaded()&&(z.style.height=w+"px"),y},isHidden:function(){return y.isLoaded()&&0===parseInt(z.style.height,10)},load:function(a){if(!y.isLoaded()&&y._fireEvent("onBeforeLoad")!==!1){var b=function(){q&&!flashembed.isSupported(k.version)&&(f.innerHTML=""),a&&(a.cached=!0,h(D,"onLoad",a)),flashembed(f,k,{config:l})},d=0;c(o,function(){this.unload(function(a){++d==o.length&&b()})})}return y},unload:function(a){if(""!==q.replace(/\s/g,"")){if(y._fireEvent("onBeforeUnload")===!1)return a&&a(!1),y;A=!0;try{z&&(z.fp_isFullscreen()&&z.fp_toggleFullscreen(),z.fp_close(),y._fireEvent("onUnload"))}catch(b){}var c=function(){z=null,f.innerHTML=q,A=!1,a&&a(!0)};/WebKit/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)?setTimeout(c,0):c()}else a&&a(!1);return y},getClip:function(a){return void 0===a&&(a=v),B[a]},getCommonClip:function(){return r},getPlaylist:function(){return B},getPlugin:function(a){var b=C[a];if(!b&&y.isLoaded()){var c=y._api().fp_getPlugin(a);c&&(b=new n(a,c,y),C[a]=b)}return b},getScreen:function(){return y.getPlugin("screen")},getControls:function(){return y.getPlugin("controls")._fireEvent("onUpdate")},getLogo:function(){try{return y.getPlugin("logo")._fireEvent("onUpdate")}catch(a){}},getPlay:function(){return y.getPlugin("play")._fireEvent("onUpdate")},getConfig:function(a){return a?b(l):l},getFlashParams:function(){return k},loadPlugin:function(a,b,c,d){"function"==typeof c&&(d=c,c={});var e=d?j():"_";y._api().fp_loadPlugin(a,b,c,e);var f={};f[e]=d;var g=new n(a,null,y,f);return C[a]=g,g},getState:function(){return y.isLoaded()?z.fp_getState():-1},play:function(a,b){var c=function(){void 0!==a?y._api().fp_play(a,b):y._api().fp_play()};return y.isLoaded()?c():A?setTimeout(function(){y.play(a,b)},50):y.load(function(){c()}),y},getVersion:function(){var a="flowplayer.js @VERSION";if(y.isLoaded()){var b=z.fp_getVersion();return b.push(a),b}return a},_api:function(){if(!y.isLoaded())throw"Flowplayer "+y.id()+" not loaded when calling an API method";return z},setClip:function(a){return c(a,function(b,c){"function"==typeof c?(h(D,b,c),delete a[b]):"onCuepoint"==b&&$f(f).getCommonClip().onCuepoint(a[b][0],a[b][1])}),y.setPlaylist([a]),y},getIndex:function(){return u},bufferAnimate:function(a){return z.fp_bufferAnimate(void 0===a||a),y},_swfHeight:function(){return z.clientHeight}}),c("Click*,Load*,Unload*,Keypress*,Volume*,Mute*,Unmute*,PlaylistReplace,ClipAdd,Fullscreen*,FullscreenExit,Error,MouseOver,MouseOut".split(","),function(){var a="on"+this;if(-1!=a.indexOf("*")){a=a.slice(0,a.length-1);var b="onBefore"+a.slice(2);y[b]=function(a){return h(D,b,a),y}}y[a]=function(b){return h(D,a,b),y}}),c("pause,resume,mute,unmute,stop,toggle,seek,getStatus,getVolume,setVolume,getTime,isPaused,isPlaying,startBuffering,stopBuffering,isFullscreen,toggleFullscreen,reset,close,setPlaylist,addClip,playFeed,setKeyboardShortcutsEnabled,isKeyboardShortcutsEnabled".split(","),function(){var a=this;y[a]=function(b,c){if(!y.isLoaded())return y;var d=null;return d=void 0!==b&&void 0!==c?z["fp_"+a](b,c):void 0===b?z["fp_"+a]():z["fp_"+a](b),"undefined"===d||void 0===d?y:d}}),y._fireEvent=function(b){"string"==typeof b&&(b=[b]);var e=b[0],f=b[1],g=b[2],h=b[3],i=0;if(l.debug&&a(b),y.isLoaded()||"onLoad"!=e||"player"!=f||(z=z||d(t),w=y._swfHeight(),c(B,function(){this._fireEvent("onLoad")}),c(C,function(a,b){b._fireEvent("onUpdate")}),r._fireEvent("onLoad")),"onLoad"!=e||"player"==f){if("onError"==e&&("string"==typeof f||"number"==typeof f&&"number"==typeof g)&&(f=g,g=h),"onContextMenu"==e)return void c(l.contextMenu[f],function(a,b){b.call(y)});if("onPluginEvent"!=e&&"onBeforePluginEvent"!=e){if("onPlaylistReplace"==e){B=[];var j=0;c(f,function(){B.push(new m(this,j++,y))})}if("onClipAdd"==e){if(f.isInStream)return;for(f=new m(f,g,y),B.splice(g,0,f),i=g+1;i<B.length;i++)B[i].index++}var k=!0;if("number"==typeof f&&f<B.length){v=f;var n=B[f];n&&(k=n._fireEvent(e,g,h)),n&&k===!1||(k=r._fireEvent(e,g,h,n))}return c(D[e],function(){return k=this.call(y,f,g),this.cached&&D[e].splice(i,1),
k===!1?!1:void i++}),k}var o=f.name||f,p=C[o];if(p)return p._fireEvent("onUpdate",f),p._fireEvent(g,b.slice(3))}},"string"==typeof f){var E=d(f);if(!E)throw"Flowplayer cannot access element: "+f;f=E,p()}else p()}function l(a){this.length=a.length,this.each=function(b){c(a,b)},this.size=function(){return a.length};var b=this;for(name in k.prototype)b[name]=function(){var a=arguments;b.each(function(){this[name].apply(this,a)})}}var m=function(a,b,d){var f=this,g={},i={};if(f.index=b,"string"==typeof a&&(a={url:a}),e(this,a,!0),c("Begin*,Start,Pause*,Resume*,Seek*,Stop*,Finish*,LastSecond,Update,BufferFull,BufferEmpty,BufferStop".split(","),function(){var a="on"+this;if(-1!=a.indexOf("*")){a=a.slice(0,a.length-1);var c="onBefore"+a.slice(2);f[c]=function(a){return h(i,c,a),f}}f[a]=function(b){return h(i,a,b),f},-1==b&&(f[c]&&(d[c]=f[c]),f[a]&&(d[a]=f[a]))}),e(this,{onCuepoint:function(a,c){if(1==arguments.length)return g.embedded=[null,a],f;"number"==typeof a&&(a=[a]);var e=j();return g[e]=[a,c],d.isLoaded()&&d._api().fp_addCuepoints(a,b,e),f},update:function(a){e(f,a),d.isLoaded()&&d._api().fp_updateClip(a,b);var c=d.getConfig(),g=-1==b?c.clip:c.playlist[b];e(g,a,!0)},_fireEvent:function(a,h,j,k){if("onLoad"==a)return c(g,function(a,c){c[0]&&d._api().fp_addCuepoints(c[0],b,a)}),!1;if(k=k||f,"onCuepoint"==a){var l=g[h];if(l)return l[1].call(d,k,j)}h&&-1!="onBeforeBegin,onMetaData,onMetaDataChange,onStart,onUpdate,onResume".indexOf(a)&&(e(k,h),h.metaData&&(k.duration?k.fullDuration=h.metaData.duration:k.duration=h.metaData.duration));var m=!0;return c(i[a],function(){m=this.call(d,k,h,j)}),m}}),a.onCuepoint){var k=a.onCuepoint;f.onCuepoint.apply(f,"function"==typeof k?[k]:k),delete a.onCuepoint}c(a,function(b,c){"function"==typeof c&&(h(i,b,c),delete a[b])}),-1==b&&(d.onCuepoint=this.onCuepoint)},n=function(a,b,d,f){var g=this,h={},i=!1;f&&e(h,f),c(b,function(a,c){"function"==typeof c&&(h[a]=c,delete b[a])}),e(this,{animate:function(c,e,f){if(!c)return g;if("function"==typeof e&&(f=e,e=500),"string"==typeof c){var i=c;c={},c[i]=e,e=500}if(f){var k=j();h[k]=f}return void 0===e&&(e=500),b=d._api().fp_animate(a,c,e,k),g},css:function(c,f){if(void 0!==f){var h={};h[c]=f,c=h}return b=d._api().fp_css(a,c),e(g,b),g},show:function(){return this.display="block",d._api().fp_showPlugin(a),g},hide:function(){return this.display="none",d._api().fp_hidePlugin(a),g},toggle:function(){return this.display=d._api().fp_togglePlugin(a),g},fadeTo:function(b,c,e){if("function"==typeof c&&(e=c,c=500),e){var f=j();h[f]=e}return this.display=d._api().fp_fadeTo(a,b,c,f),this.opacity=b,g},fadeIn:function(a,b){return g.fadeTo(1,a,b)},fadeOut:function(a,b){return g.fadeTo(0,a,b)},getName:function(){return a},getPlayer:function(){return d},_fireEvent:function(b,f,j){if("onUpdate"==b){var k=d._api().fp_getPlugin(a);if(!k)return;e(g,k),delete g.methods,i||(c(k.methods,function(){var b=""+this;g[b]=function(){var c=[].slice.call(arguments),e=d._api().fp_invoke(a,b,c);return"undefined"===e||void 0===e?g:e}}),i=!0)}var l=h[b];if(l){var m=l.apply(g,f);return"_"==b.slice(0,1)&&delete h[b],m}return g}})},o=[];window.flowplayer=window.$f=function(){var a=null,g=arguments[0];if(!arguments.length)return c(o,function(){return this.isLoaded()?(a=this,!1):void 0}),a||o[0];if(1==arguments.length)return"number"==typeof g?o[g]:"*"==g?new l(o):(c(o,function(){return this.id()==g.id||this.id()==g||this.getParent()==g?(a=this,!1):void 0}),a);if(arguments.length>1){var h=arguments[1],i=3==arguments.length?arguments[2]:{};if("string"==typeof h&&(h={src:h}),h=e({bgcolor:"#000000",version:[10,1],expressInstall:"http://releases.flowplayer.org/swf/expressinstall.swf",cachebusting:!1},h),"string"==typeof g){if(-1!=g.indexOf(".")){var j=[];return c(f(g),function(){j.push(new k(this,b(h),b(i)))}),new l(j)}var m=d(g);return new k(null!==m?m:b(g),b(h),b(i))}if(g)return new k(g,b(h),b(i))}return null},e(window.$f,{fireEvent:function(){var a=[].slice.call(arguments),b=$f(a[0]);return b?b._fireEvent(a.slice(1)):null},addPlugin:function(a,b){return k.prototype[a]=b,$f},each:c,extend:e}),"function"==typeof jQuery&&(jQuery.fn.flowplayer=function(a,c){if(!arguments.length||"number"==typeof arguments[0]){var d=[];return this.each(function(){var a=$f(this);a&&d.push(a)}),arguments.length?d[arguments[0]]:new l(d)}return this.each(function(){$f(this,b(a),c?b(c):{})})})}(),!function(){function a(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function b(a,b){var c=[];for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d]));return c}function c(b,c,f){if(i.isSupported(c.version))b.innerHTML=i.getHTML(c,f);else if(c.expressInstall&&i.isSupported([6,65]))b.innerHTML=i.getHTML(a(c,{src:c.expressInstall}),{MMredirectURL:encodeURIComponent(location.href),MMplayerType:"PlugIn",MMdoctitle:document.title});else if(b.innerHTML.replace(/\s/g,"")||(b.innerHTML="<h2>Flash version "+c.version+" or greater is required</h2><h3>"+(j[0]>0?"Your version is "+j:"You have no flash plugin installed")+"</h3>"+("A"==b.tagName?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='"+e+"'>here</a></p>"),("A"==b.tagName||"DIV"==b.tagName)&&(b.onclick=function(){location.href=e})),c.onFail){var g=c.onFail.call(this);"string"==typeof g&&(b.innerHTML=g)}d&&(window[c.id]=document.getElementById(c.id)),a(this,{getRoot:function(){return b},getOptions:function(){return c},getConf:function(){return f},getApi:function(){return b.firstChild}})}var d=document.all,e="http://get.adobe.com/flashplayer",f="function"==typeof jQuery,g=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/,h={width:"100%",height:"100%",id:"_"+(""+Math.random()).slice(9),allowfullscreen:!0,allowscriptaccess:"always",quality:"high",version:[3,0],onFail:null,expressInstall:null,w3c:!1,cachebusting:!1};window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){},__flash_savedUnloadHandler=function(){}}),window.flashembed=function(b,d,e){return"string"==typeof b&&(b=document.getElementById(b.replace("#",""))),b?("string"==typeof d&&(d={src:d}),new c(b,a(a({},h),d),e)):void 0};var i=a(window.flashembed,{conf:h,getVersion:function(){var a,b,c;try{c=navigator.plugins["Shockwave Flash"],null!=c[0].enabledPlugin&&(b=c.description.slice(16))}catch(d){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),b=a&&a.GetVariable("$version")}catch(e){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),b=a&&a.GetVariable("$version")}catch(f){}}}return b=g.exec(b),b?[1*b[1],1*b[1*b[1]>9?2:3]*1]:[0,0]},asString:function(a){if(null===a||void 0===a)return null;var c=typeof a;switch("object"==c&&a.push&&(c="array"),c){case"string":return a=a.replace(new RegExp('(["\\\\])',"g"),"\\$1"),a=a.replace(/^\s?(\d+\.?\d*)%/,"$1pct"),'"'+a+'"';case"array":return"["+b(a,function(a){return i.asString(a)}).join(",")+"]";case"function":return'"function()"';case"object":var d=[];for(var e in a)a.hasOwnProperty(e)&&d.push('"'+e+'":'+i.asString(a[e]));return"{"+d.join(",")+"}"}return String(a).replace(/\s/g," ").replace(/\'/g,'"')},getHTML:function(b,c){b=a({},b);var e='<object width="'+b.width+'" height="'+b.height+'" id="'+b.id+'" name="'+b.id+'"';b.cachebusting&&(b.src+=(-1!=b.src.indexOf("?")?"&":"?")+Math.random()),e+=b.w3c||!d?' data="'+b.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"',e+=">",(b.w3c||d)&&(e+='<param name="movie" value="'+b.src+'" />'),b.width=b.height=b.id=b.w3c=b.src=null,b.onFail=b.version=b.expressInstall=null;for(var f in b)b[f]&&(e+='<param name="'+f+'" value="'+b[f]+'" />');var g="";if(c){for(var h in c)if(c[h]){var j=c[h];g+=h+"="+(/function|object/.test(typeof j)?i.asString(j):j)+"&"}g=g.slice(0,-1),e+='<param name="flashvars" value=\''+g+"' />"}return e+="</object>"},isSupported:function(a){return j[0]>a[0]||j[0]==a[0]&&j[1]>=a[1]}}),j=i.getVersion();f&&(jQuery.tools=jQuery.tools||{version:"@VERSION"},jQuery.tools.flashembed={conf:h},jQuery.fn.flashembed=function(a,b){return this.each(function(){$(this).data("flashembed",flashembed(this,a,b))})})}(),function(a,b){function c(){b(".hlsplayer").each(function(){d(this)})}function d(a){t?m(a):n(a)}function e(a,b){a.currentTime=b}function f(a){return a.currentTime}function g(a){return a.duration}function h(a){var b=flowplayer(a);return b.getPlaylist()[0].duration}function i(a,b){var c=flowplayer(a);c.seek(b)}function j(a){var b=flowplayer(a);return b.getTime()}function k(a,b){var c=!a.paused,d=new Hls;d.loadSource(b),d.attachMedia(a),c?a.play():a.pause()}function l(a,b){var c=flowplayer(a).isPlaying();flowplayer(a).getTime();o(a,b,c)}function m(a){if(!(a.src.indexOf("blob:")>=0)){var b=a.getElementsByTagName("source")[0].src||a.src,c=new Hls;c.loadSource(b),c.attachMedia(a)}}function n(a){var c=a.getElementsByTagName("source")[0].src||a.src;a.width&&(a.style.width=a.width+"px"),a.height&&(a.style.height=a.height+"px");var d=document.createElement("div");a.className&&(d.className=a.className),a.style.cssText&&(d.style.cssText=a.style.cssText),a.id&&(d.id=a.id),b(a).replaceWith(d),o(d,c,!1)}function o(a,b,c){flowplayer(a,r,{wmode:"direct",plugins:{httpstreaming:{url:s,hls_debug:!1,hls_debug2:!1,hls_lowbufferlength:3,hls_minbufferlength:-1,hls_maxbufferlength:60,hls_startfromlevel:-1,hls_seekfromlevel:-1,hls_live_flushurlcache:!1,hls_seekmode:"ACCURATE",hls_fragmentloadmaxretry:-1,hls_manifestloadmaxretry:-1,hls_capleveltostage:!1,hls_maxlevelcappingmode:"downscale"}},clip:{accelerated:!0,url:b,urlResolvers:"httpstreaming",lang:"fr",provider:"httpstreaming",autoPlay:c,autoBuffering:!0}})}function p(){for(var a=navigator.userAgent,b=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],c=0;c<b.length;c++)if(a.indexOf(b[c])>0)return!0;return!1}var q=(b("script"),b("script[script-flowplayer]")),r=q.attr("script-flowplayer"),s=q.attr("script-flowplayerhls");r||console.log("flowplayer attr required"),s||console.log("flowplayerhls attr required");var t=Hls.isSupported()||p()?!0:!1;b(function(){c()}),a.hlsplayer=function(){c()},b.fn.extend({setPlayerSrc:function(a){return t?k(this[0],a):l(this[0],a),this},setPlayerTime:function(a){t?e(this[0],a):i(this[0],a)},getPlayerTime:function(){return t?f(this[0]):j(this[0])},getTotalTime:function(){return t?g(this[0]):h(this[0])},videoCP:function(a,b){if(t){var c=document.createElement("canvas");c.width=this[0].videoWidth*a,c.height=this[0].videoHeight*a,c.getContext("2d").drawImage(this[0],0,0,c.width,c.height);var d=document.createElement("img");d.src=c.toDataURL("images/png"),b(d)}else console.log("videoCP not supported in FlashPlayer")}})}(window,jQuery);