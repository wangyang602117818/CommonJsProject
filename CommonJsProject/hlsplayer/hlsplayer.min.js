!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Hls=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(b,c,d){!function(b){var e=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,f=/^([^\/;?#]*)(.*)$/,g=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,i={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),b=b.trim(),!b){if(!c.alwaysNormalize)return a;var d=this.parseURL(a);if(!g)throw new Error("Error trying to parse base URL.");return d.path=i.normalizePath(d.path),i.buildURLFromParts(d)}var e=this.parseURL(b);if(!e)throw new Error("Error trying to parse relative URL.");if(e.scheme)return c.alwaysNormalize?(e.path=i.normalizePath(e.path),i.buildURLFromParts(e)):b;var g=this.parseURL(a);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&"/"!==g.path[0]){var h=f.exec(g.path);g.netLoc=h[1],g.path=h[2]}g.netLoc&&!g.path&&(g.path="/");var j={scheme:g.scheme,netLoc:e.netLoc,path:null,params:e.params,query:e.query,fragment:e.fragment};if(!e.netLoc&&(j.netLoc=g.netLoc,"/"!==e.path[0]))if(e.path){var k=g.path,l=k.substring(0,k.lastIndexOf("/")+1)+e.path;j.path=i.normalizePath(l)}else j.path=g.path,e.params||(j.params=g.params,e.query||(j.query=g.query));return null===j.path&&(j.path=c.alwaysNormalize?i.normalizePath(e.path):e.path),i.buildURLFromParts(j)},parseURL:function(a){var b=e.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(g,"");a.length!==(a=a.replace(h,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};"object"==typeof d&&"object"==typeof c?c.exports=i:"function"==typeof a&&a.amd?a([],function(){return i}):"object"==typeof d?d.URLToolkit=i:b.URLToolkit=i}(this)},{}],3:[function(a,b,c){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a,b){function c(a){q[a]=!0;for(var b in e[a][1]){var d=e[a][1][b];q[d]||c(d)}}for(var h,i=Object.keys(f),j=0,k=i.length;k>j;j++){var l=i[j],m=f[l].exports;if(m===a||m&&m["default"]===a){h=l;break}}if(!h){h=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var n={},j=0,k=i.length;k>j;j++){var l=i[j];n[l]=l}e[h]=[Function(["require","module","exports"],"("+a+")(self)"),n]}var o=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[h]=h,e[o]=[Function(["require"],"var f = require("+g(h)+");(f.default ? f.default : f)(self);"),p];var q={};c(o);var r="("+d+")({"+Object.keys(q).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(o)+"])",s=window.URL||window.webkitURL||window.mozURL||window.msURL,t=new Blob([r],{type:"text/javascript"});if(b&&b.bare)return t;var u=s.createObjectURL(t),v=new Worker(u);return v.objectURL=u,v}},{}],4:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(c,"__esModule",{value:!0}),c.hlsDefaultConfig=void 0;var e=a(5),f=d(e),g=a(8),h=d(g),i=a(9),j=d(i),k=a(10),l=d(k),m=a(56),n=d(m),o=a(7),p=d(o),q=a(6),r=d(q),s=a(48),t=d(s),u=a(16),v=d(u),w=a(15),x=d(w),y=a(14),z=d(y);c.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:n["default"],fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:f["default"],bufferController:h["default"],capLevelController:j["default"],fpsController:l["default"],audioStreamController:r["default"],audioTrackController:p["default"],subtitleStreamController:z["default"],subtitleTrackController:x["default"],timelineController:v["default"],cueHandler:t["default"],enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{10:10,14:14,15:15,16:16,48:48,5:5,56:56,6:6,7:7,8:8,9:9}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=a(35),n=d(m),o=a(31),p=a(51),q=a(49),r=d(q),s=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].FRAG_LOADING,j["default"].FRAG_LOADED,j["default"].FRAG_BUFFERED,j["default"].ERROR));return c.lastLoadedFragLevel=0,c._nextAutoLevel=-1,c.hls=a,c.onCheck=c._abandonRulesCheck.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.clearTimer(),l["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var b=a.frag;if("main"===b.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var c=this.hls,d=a.frag.level,e=c.levels[d].details.live,f=c.config,g=void 0,h=void 0;e?(g=f.abrEwmaFastLive,h=f.abrEwmaSlowLive):(g=f.abrEwmaFastVoD,h=f.abrEwmaSlowVoD),this._bwEstimator=new r["default"](c,h,g,f.abrEwmaDefaultEstimate)}this.fragCurrent=b}}},{key:"_abandonRulesCheck",value:function(){var a=this.hls,b=a.media,c=this.fragCurrent,d=c.loader,e=a.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return p.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var f=d.stats;if(b&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var g=performance.now()-f.trequest,h=Math.abs(b.playbackRate);if(g>500*c.duration/h){var i=a.levels,k=Math.max(1,f.bw?f.bw/8:1e3*f.loaded/g),l=i[c.level],m=l.realBitrate?Math.max(l.realBitrate,l.bitrate):l.bitrate,o=f.total?f.total:Math.max(f.loaded,Math.round(c.duration*m/8)),q=b.currentTime,r=(o-f.loaded)/k,s=(n["default"].bufferInfo(b,q,a.config.maxBufferHole).end-q)/h;if(s<2*c.duration/h&&r>s){var t=void 0,u=void 0;for(u=c.level-1;u>e;u--){var v=i[u].realBitrate?Math.max(i[u].realBitrate,i[u].bitrate):i[u].bitrate;if(t=c.duration*v/(6.4*k),s>t)break}r>t&&(p.logger.warn("loading too slow, abort fragment loading and switch to level "+u+":fragLoadedDelay["+u+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+t.toFixed(1)+"<"+r.toFixed(1)+":"+s.toFixed(1)),a.nextLoadLevel=u,this._bwEstimator.sample(g,f.loaded),d.abort(),this.clearTimer(),a.trigger(j["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:f}))}}}}},{key:"onFragLoaded",value:function(a){var b=a.frag;if("main"===b.type&&!isNaN(b.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[b.level],d=(c.loaded?c.loaded.bytes:0)+a.stats.loaded,e=(c.loaded?c.loaded.duration:0)+a.frag.duration;c.loaded={bytes:d,duration:e},c.realBitrate=Math.round(8*d/e)}if(a.frag.bitrateTest){var f=a.stats;f.tparsed=f.tbuffered=f.tload,this.onFragBuffered(a)}}}},{key:"onFragBuffered",value:function(a){var b=a.stats,c=a.frag;if(!(b.aborted===!0||1!==c.loadCounter||"main"!==c.type||isNaN(c.sn)||c.bitrateTest&&b.tload!==b.tbuffered)){var d=b.tparsed-b.trequest;p.logger.log("latency/loading/parsing/append/kbps:"+Math.round(b.tfirst-b.trequest)+"/"+Math.round(b.tload-b.tfirst)+"/"+Math.round(b.tparsed-b.tload)+"/"+Math.round(b.tbuffered-b.tparsed)+"/"+Math.round(8*b.loaded/(b.tbuffered-b.trequest))),this._bwEstimator.sample(d,b.loaded),b.bwEstimate=this._bwEstimator.getEstimate(),c.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(a){switch(a.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function(a,b,c,d,e,f,g,h,i){for(var j=e;j>=d;j--){var k=i[j],l=k.details,m=l?l.totalduration/l.fragments.length:b,n=l?l.live:!1,o=void 0;o=a>=j?g*c:h*c;var q=i[j].realBitrate?Math.max(i[j].realBitrate,i[j].bitrate):i[j].bitrate,r=q*m/o;if(p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+j+"/"+Math.round(o)+"/"+q+"/"+m+"/"+f+"/"+r),o>q&&(!r||n||f>r))return j}return-1}},{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this._bwEstimator;if(!(-1===a||b&&b.canEstimate()))return a;var c=this._nextABRAutoLevel;return-1!==a&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a}},{key:"_nextABRAutoLevel",get:function(){var a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media,g=this.lastLoadedFragLevel,h=this.fragCurrent?this.fragCurrent.duration:0,i=f?f.currentTime:0,j=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,k=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,l=(n["default"].bufferInfo(f,i,d.maxBufferHole).end-i)/j,m=this._findBestLevel(g,h,k,e,b,l,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(m>=0)return m;p.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var o=h?Math.min(h,d.maxStarvationDelay):d.maxStarvationDelay,q=d.abrBandWidthFactor,r=d.abrBandWidthUpFactor;if(0===l){var s=this.bitrateTestDelay;if(s){var t=h?Math.min(h,d.maxLoadingDelay):d.maxLoadingDelay;o=t-s,p.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*o)+" ms"),q=r=1}}return m=this._findBestLevel(g,h,k,e,b,l+o,q,r,c),Math.max(m,0)}}]),b}(l["default"]);c["default"]=s},{31:31,32:32,33:33,35:35,49:49,51:51}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(46),j=d(i),k=a(35),l=d(k),m=a(25),n=d(m),o=a(33),p=d(o),q=a(32),r=d(q),s=a(36),t=d(s),u=a(52),v=d(u),w=a(31),x=a(51),y={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},z=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,p["default"].MEDIA_ATTACHED,p["default"].MEDIA_DETACHING,p["default"].AUDIO_TRACKS_UPDATED,p["default"].AUDIO_TRACK_SWITCHING,p["default"].AUDIO_TRACK_LOADED,p["default"].KEY_LOADED,p["default"].FRAG_LOADED,p["default"].FRAG_PARSING_INIT_SEGMENT,p["default"].FRAG_PARSING_DATA,p["default"].FRAG_PARSED,p["default"].ERROR,p["default"].BUFFER_CREATED,p["default"].BUFFER_APPENDED,p["default"].BUFFER_FLUSHED,p["default"].INIT_PTS_FOUND));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=y.STOPPED,c.ontick=c.tick.bind(c),c.initPTS=[],c.waitingFragment=null,c}return g(b,a),h(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),r["default"].prototype.destroy.call(this),this.state=y.STOPPED}},{key:"onInitPtsFound",value:function(a){var b=a.id,c=a.frag.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,x.logger.log("InitPTS for cc:"+c+" found from video track:"+d),this.state===y.WAITING_INIT_PTS&&(x.logger.log("sending pending audio frag to demuxer"),this.state=y.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,b>0&&-1===a?(x.logger.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=y.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=y.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=y.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var a,b,c,d=this.hls,e=d.config;switch(this.state){case y.ERROR:case y.PAUSED:case y.BUFFER_FLUSHING:break;case y.STARTING:this.state=y.WAITING_TRACK,this.loadedmetadata=!1;break;case y.IDLE:var f=this.tracks;if(!f)break;if(!this.media&&(this.startFragRequested||!e.startFragPrefetch))break;a=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition;var g=this.mediaBuffer?this.mediaBuffer:this.media,h=l["default"].bufferInfo(g,a,e.maxBufferHole),i=h.len,k=h.end,m=this.fragPrevious,n=e.maxMaxBufferLength,o=this.audioSwitch,q=this.trackId;if((n>i||o)&&q<f.length){if(c=f[q].details,"undefined"==typeof c){this.state=y.WAITING_TRACK;break}if(!o&&!c.live&&m&&m.sn===c.endSN&&(!this.media.seeking||this.media.duration-k<m.duration/2)){this.hls.trigger(p["default"].BUFFER_EOS,{type:"audio"}),this.state=y.ENDED;break}var r=c.fragments,s=r.length,t=r[0].start,u=r[s-1].start+r[s-1].duration,v=void 0;if(o)if(c.live&&!c.PTSKnown)x.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),k=0;else if(k=a,c.PTSKnown&&t>a){if(!(h.end>t||h.nextStart))return;x.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=t+.05}if(c.initSegment&&!c.initSegment.data)v=c.initSegment;else if(t>=k){if(v=r[0],c.live&&v.loadIdx&&v.loadIdx===this.fragLoadIdx){var z=h.nextStart?h.nextStart:t;return x.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(z+.05)),void(this.media.currentTime=z+.05)}}else{var A=void 0,B=e.maxFragLookUpTolerance,C=m?r[m.sn-r[0].sn+1]:void 0,D=function(a){var b=Math.min(B,a.duration);return a.start+a.duration-b<=k?1:a.start-b>k&&a.start?-1:0};u>k?(k>u-B&&(B=0),A=C&&!D(C)?C:j["default"].search(r,D)):A=r[s-1],A&&(v=A,t=A.start,m&&v.level===m.level&&v.sn===m.sn&&(v.sn<c.endSN?(v=r[v.sn+1-c.startSN],x.logger.log("SN just loaded, load next one: "+v.sn)):v=null))}if(v)if(v.decryptdata&&null!=v.decryptdata.uri&&null==v.decryptdata.key)x.logger.log("Loading key for "+v.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+q),this.state=y.KEY_LOADING,d.trigger(p["default"].KEY_LOADING,{frag:v});else{if(x.logger.log("Loading "+v.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+q+", currentTime:"+a+",bufferEnd:"+k.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,v.loadCounter){v.loadCounter++;var E=e.fragLoadingLoopThreshold;if(v.loadCounter>E&&Math.abs(this.fragLoadIdx-v.loadIdx)<E)return void d.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:v})}else v.loadCounter=1;v.loadIdx=this.fragLoadIdx,this.fragCurrent=v,this.startFragRequested=!0,isNaN(v.sn)||(this.nextLoadPosition=v.start+v.duration),d.trigger(p["default"].FRAG_LOADING,{frag:v}),this.state=y.FRAG_LOADING}}break;case y.WAITING_TRACK:b=this.tracks[this.trackId],b&&b.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:var F=performance.now(),G=this.retryDate;g=this.media;var H=g&&g.seeking;(!G||F>=G||H)&&(x.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.WAITING_INIT_PTS:case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}}},{key:"onMediaAttached",value:function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.tracks;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===y.ENDED&&(this.state=y.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(a){x.logger.log("audio tracks updated"),this.tracks=a.audioTracks}},{key:"onAudioTrackSwitching",value:function(a){var b=!!a.url;this.trackId=a.id,this.state=y.IDLE,this.fragCurrent=null,this.state=y.PAUSED,this.waitingFragment=null,b?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=y.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(a){var b=a.details,c=a.id,d=this.tracks[c],e=b.totalduration,f=0;if(x.logger.log("track "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),b.live){var g=d.details;g&&b.fragments.length>0?(t["default"].mergeDetails(g,b),f=b.fragments[0].start,b.PTSKnown?x.logger.log("live audio playlist sliding:"+f.toFixed(3)):x.logger.log("live audio playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,x.logger.log("live audio playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,!this.startFragRequested){if(-1===this.startPosition){var h=b.startTimeOffset;isNaN(h)?this.startPosition=0:(x.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h)}this.nextLoadPosition=this.startPosition}this.state===y.WAITING_TRACK&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var b=this.fragCurrent,c=a.frag;if(this.state===y.FRAG_LOADING&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn){var d=this.tracks[this.trackId],e=d.details,f=e.totalduration,g=b.level,h=b.sn,i=b.cc,j=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2",k=this.stats=a.stats;if("initSegment"===h)this.state=y.IDLE,k.tparsed=k.tbuffered=performance.now(),e.initSegment.data=a.payload,this.hls.trigger(p["default"].FRAG_BUFFERED,{stats:k,frag:b,id:"audio"}),this.tick();else{this.state=y.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new n["default"](this.hls,"audio"));var l=this.initPTS[i],m=e.initSegment?e.initSegment.data:[];if(e.initSegment||void 0!==l){this.pendingBuffering=!0,x.logger.log("Demuxing "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g);var o=!1;this.demuxer.push(a.payload,m,j,null,b,f,o,l)}else x.logger.log("unknown video PTS for continuity counter "+i+", waiting for video PTS before demuxing audio frag "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g),this.waitingFragment=a,this.state=y.WAITING_INIT_PTS}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var b=this.fragCurrent,c=a.frag;if(b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING){var d=a.tracks,e=void 0;if(d.video&&delete d.video,e=d.audio){e.levelCodec="mp4a.40.2",e.id=a.id,this.hls.trigger(p["default"].BUFFER_CODECS,d),x.logger.log("audio track:audio,container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var f=e.initSegment;if(f){var g={type:"audio",data:f,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[g]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p["default"].BUFFER_APPENDING,g))}this.tick()}}}},{key:"onFragParsingData",value:function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"audio"===a.id&&"audio"===a.type&&d.sn===c.sn&&d.level===c.level&&this.state===y.PARSING){var e=this.trackId,f=this.tracks[e],g=this.hls;isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),x.logger.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb),t["default"].updateFragPTSDTS(f.details,c,a.startPTS,a.endPTS);var h=this.audioSwitch,i=this.media,j=!1;if(h&&i)if(i.readyState){var k=i.currentTime;x.logger.log("switching audio track : currentTime:"+k),k>=a.startPTS&&(x.logger.log("switching audio track : flushing all audio"),this.state=y.BUFFER_FLUSHING,g.trigger(p["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),j=!0,this.audioSwitch=!1,g.trigger(p["default"].AUDIO_TRACK_SWITCHED,{id:e}))}else this.audioSwitch=!1,g.trigger(p["default"].AUDIO_TRACK_SWITCHED,{id:e});var l=this.pendingData;this.audioSwitch||([a.data1,a.data2].forEach(function(b){b&&b.length&&l.push({type:a.type,data:b,parent:"audio",content:"data"})}),!j&&l.length&&(l.forEach(function(a){b.state===y.PARSING&&(b.pendingBuffering=!0,b.hls.trigger(p["default"].BUFFER_APPENDING,a))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(a){if("audio"===a.parent){var b=this.state;(b===y.PARSING||b===y.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==y.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=this.stats,c=this.hls;if(a){this.fragPrevious=a,b.tbuffered=performance.now(),c.trigger(p["default"].FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var d=this.mediaBuffer?this.mediaBuffer:this.media;x.logger.log("audio buffered : "+v["default"].toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(p["default"].AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=y.IDLE}this.tick()}}},{key:"onError",value:function(a){var b=a.frag;if(!b||"audio"===b.type)switch(a.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!a.fatal){var c=this.fragLoadError;c?c++:c=1;var d=this.config;if(c<=d.fragLoadingMaxRetry){this.fragLoadError=c,b.loadCounter=0;var e=Math.min(Math.pow(2,c-1)*d.fragLoadingRetryDelay,d.fragLoadingMaxRetryTimeout);x.logger.warn("audioStreamController: frag loading failed, retry in "+e+" ms"),this.retryDate=performance.now()+e,this.state=y.FRAG_LOADING_WAITING_RETRY}else x.logger.error("audioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=y.ERROR}break;case w.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case w.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case w.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==y.ERROR&&(this.state=a.fatal?y.ERROR:y.IDLE,x.logger.warn("audioStreamController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case w.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===a.parent&&(this.state===y.PARSING||this.state===y.PARSED)){var f=this.mediaBuffer,g=this.media.currentTime,h=f&&l["default"].isBuffered(f,g)&&l["default"].isBuffered(f,g+.5);if(h){var i=this.config;i.maxMaxBufferLength>=i.maxBufferLength&&(i.maxMaxBufferLength/=2,x.logger.warn("audio:reduce max buffer length to "+i.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.state=y.IDLE}else x.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=y.BUFFER_FLUSHING,this.hls.trigger(p["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}}},{key:"onBufferFlushed",value:function(){var a=this,b=this.pendingData;b&&b.length?(x.logger.log("appending pending audio data on Buffer Flushed"),b.forEach(function(b){a.hls.trigger(p["default"].BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=y.PARSED):(this.state=y.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,x.logger.log("audio stream:"+b+"->"+a)}},get:function(){return this._state}}]),b}(r["default"]);c["default"]=z},{25:25,31:31,32:32,33:33,35:35,36:36,46:46,51:51,52:52}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{
constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=a(51),n=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MANIFEST_LOADING,j["default"].MANIFEST_LOADED,j["default"].AUDIO_TRACK_LOADED));return c.ticks=0,c.ontick=c.tick.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(a){var b=this,c=a.audioTracks||[],d=!1;this.tracks=c,this.hls.trigger(j["default"].AUDIO_TRACKS_UPDATED,{audioTracks:c});var e=0;c.forEach(function(a){return a["default"]?(b.audioTrack=e,void(d=!0)):void e++}),d===!1&&c.length&&(m.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(a){a.id<this.tracks.length&&(m.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*a.details.targetduration)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,m.logger.log("switching to audioTrack "+a);var b=this.tracks[a],c=this.hls,d=b.type,e=b.url,f={id:a,type:d,url:e};c.trigger(j["default"].AUDIO_TRACK_SWITCH,f),c.trigger(j["default"].AUDIO_TRACK_SWITCHING,f);var g=b.details;!e||void 0!==g&&g.live!==!0||(m.logger.log("(re)loading playlist for audioTrack "+a),c.trigger(j["default"].AUDIO_TRACK_LOADING,{url:e,id:a}))}}},{key:"updateTrack",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,m.logger.log("updating audioTrack "+a);var b=this.tracks[a],c=b.url,d=b.details;!c||void 0!==d&&d.live!==!0||(m.logger.log("(re)loading playlist for audioTrack "+a),this.hls.trigger(j["default"].AUDIO_TRACK_LOADING,{url:c,id:a}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){(this.trackId!==a||void 0===this.tracks[a].details)&&this.setAudioTrackInternal(a)}}]),b}(l["default"]);c["default"]=n},{32:32,33:33,51:51}],8:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=a(51),n=a(31),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MEDIA_ATTACHING,j["default"].MEDIA_DETACHING,j["default"].MANIFEST_PARSED,j["default"].BUFFER_RESET,j["default"].BUFFER_APPENDING,j["default"].BUFFER_CODECS,j["default"].BUFFER_EOS,j["default"].BUFFER_FLUSHING,j["default"].LEVEL_PTS_UPDATED,j["default"].LEVEL_UPDATED));return c._msDuration=null,c._levelDuration=null,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c.tracks={},c}return g(b,a),h(b,[{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(a){var b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container){var d=this.sourceBuffer.audio,e=Math.abs(d.timestampOffset-a.start);if(e>.1){var f=d.updating;try{d.abort()}catch(g){f=!0,m.logger.warn("can not abort audio buffer: "+g)}f?this.audioTimestampOffset=a.start:(m.logger.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}}},{key:"onManifestParsed",value:function(a){var b=a.audio,c=a.video,d=0;a.altAudio&&(b||c)&&(d=(b?1:0)+(c?1:0),m.logger.log(d+" sourceBuffer(s) expected")),this.sourceBufferNb=d}},{key:"onMediaAttaching",value:function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=URL.createObjectURL(c)}}},{key:"onMediaDetaching",value:function(){m.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(b){m.logger.warn("onMediaDetaching:"+b.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(j["default"].MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){m.logger.log("media source opened"),this.hls.trigger(j["default"].MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var a=this.pendingTracks,b=Object.keys(a).length;b&&(this.sourceBufferNb<=b||0===this.sourceBufferNb)&&(this.createSourceBuffers(a),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){m.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){m.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var a=this.sourceBuffer.audio;m.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0);this.hls.trigger(j["default"].BUFFER_APPENDED,{parent:b,pending:c}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(a){m.logger.error("sourceBuffer error:",a),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(d){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(a){if(0===Object.keys(this.sourceBuffer).length){for(var b in a)this.pendingTracks[b]=a[b];var c=this.mediaSource;c&&"open"===c.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var e=a[d],f=e.levelCodec||e.codec,g=e.container+";codecs="+f;m.logger.log("creating sourceBuffer("+g+")");try{var h=b[d]=c.addSourceBuffer(g);h.addEventListener("updateend",this.onsbue),h.addEventListener("error",this.onsbe),this.tracks[d]={codec:f,container:e.container},e.buffer=h}catch(i){m.logger.error("error while trying to add sourceBuffer:"+i.message),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:i,mimeType:g})}}this.hls.trigger(j["default"].BUFFER_CREATED,{tracks:a})}},{key:"onBufferAppending",value:function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())}},{key:"onBufferAppendFail",value:function(a){m.logger.error("sourceBuffer error:",a.event),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,m.logger.log(d+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return void(this._needsEos=!1);for(var c in a){var d=a[c];if(!d.ended)return;if(d.updating)return void(this._needsEos=!0)}m.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(e){m.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(a){var b=a.details;0!==b.fragments.length&&(this._levelDuration=b.totalduration+b.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var a=this.media,b=this.mediaSource,c=this.sourceBuffer,d=this._levelDuration;if(null!==d&&a&&b&&c&&0!==a.readyState&&"open"===b.readyState){for(var e in c)if(c[e].updating)return;null===this._msDuration&&(this._msDuration=b.duration);var f=a.duration;(d>this._msDuration&&d>f||f===1/0||isNaN(f))&&(m.logger.log("Updating mediasource duration to "+d.toFixed(3)),this._msDuration=b.duration=d)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;try{for(var d in c)b+=c[d].buffered.length}catch(e){m.logger.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(j["default"].BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var a=this.hls,b=this.sourceBuffer,c=this.segments;if(Object.keys(b).length){if(this.media.error)return this.segments=[],void m.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(c&&c.length){var d=c.shift();try{var e=d.type,f=b[e];f?f.updating?c.unshift(d):(f.ended=!1,this.parent=d.parent,f.appendBuffer(d.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(g){m.logger.error("error while trying to append buffer:"+g.message),c.unshift(d);var h={type:n.ErrorTypes.MEDIA_ERROR,parent:d.parent};if(22===g.code)return this.segments=[],h.details=n.ErrorDetails.BUFFER_FULL_ERROR,h.fatal=!1,void a.trigger(j["default"].ERROR,h);if(this.appendError?this.appendError++:this.appendError=1,h.details=n.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>a.config.appendErrorMaxRetry)return m.logger.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),c=[],h.fatal=!0,void a.trigger(j["default"].ERROR,h);h.fatal=!1,a.trigger(j["default"].ERROR,h)}}}}},{key:"flushBuffer",value:function(a,b,c){var d,e,f,g,h,i,j=this.sourceBuffer;if(Object.keys(j).length){if(m.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var k in j)if(!c||k===c){if(d=j[k],d.ended=!1,d.updating)return m.logger.warn("cannot flush, sb updating in progress"),!1;try{for(e=0;e<d.buffered.length;e++)if(f=d.buffered.start(e),g=d.buffered.end(e),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&b===Number.POSITIVE_INFINITY?(h=a,i=b):(h=Math.max(f,a),i=Math.min(g,b)),Math.min(i,g)-h>.5)return this.flushBufferCounter++,m.logger.log("flush "+k+" ["+h+","+i+"], of ["+f+","+g+"], pos:"+this.media.currentTime),d.remove(h,i),!1}catch(l){m.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else m.logger.warn("abort flushing too many retries");m.logger.log("buffer flushed")}return!0}}]),b}(l["default"]);c["default"]=o},{31:31,32:32,33:33,51:51}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=function(a){function b(a){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].FPS_DROP_LEVEL_CAPPING,j["default"].MEDIA_ATTACHING,j["default"].MANIFEST_PARSED))}return g(b,a),h(b,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(a){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(a.droppedLevel)||this.restrictedLevels.push(a.droppedLevel)}},{key:"onMediaAttaching",value:function(a){this.media=a.media instanceof HTMLVideoElement?a.media:null}},{key:"onManifestParsed",value:function(a){var b=this.hls;b.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=a.levels,b.firstLevel=this.getMaxLevel(a.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}}},{key:"getMaxLevel",value:function(a){var b=0,c=void 0,d=void 0,e=this.mediaWidth,f=this.mediaHeight,g=0,h=0;for(c=0;a>=c&&(d=this.levels[c],!this.isLevelRestricted(c))&&(b=c,g=d.width,h=d.height,!(g>=e||h>=f));c++);return b}},{key:"isLevelRestricted",value:function(a){return this.restrictedLevels&&-1!==this.restrictedLevels.indexOf(a)?!0:!1}},{key:"contentScaleFactor",get:function(){var a=1;try{a=window.devicePixelRatio}catch(b){}return a}},{key:"mediaWidth",get:function(){var a=void 0,b=this.media;return b&&(a=b.width||b.clientWidth||b.offsetWidth,a*=this.contentScaleFactor),a}},{key:"mediaHeight",get:function(){var a=void 0,b=this.media;return b&&(a=b.height||b.clientHeight||b.offsetHeight,a*=this.contentScaleFactor),a}}]),b}(l["default"]);c["default"]=m},{32:32,33:33}],10:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=a(51),n=function(a){function b(a){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MEDIA_ATTACHING))}return g(b,a),h(b,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(a){var b=this.hls.config;if(b.capLevelOnFPSDrop){var c=this.video=a.media instanceof HTMLVideoElement?a.media:null;"function"==typeof c.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(a,b,c){var d=performance.now();if(b){if(this.lastTime){var e=d-this.lastTime,f=c-this.lastDroppedFrames,g=b-this.lastDecodedFrames,h=1e3*f/e,i=this.hls;if(i.trigger(j["default"].FPS_DROP,{currentDropped:f,currentDecoded:g,totalDroppedFrames:c}),h>0&&f>i.config.fpsDroppedMonitoringThreshold*g){var k=i.currentLevel;m.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+k),k>0&&(-1===i.autoLevelCapping||i.autoLevelCapping>=k)&&(k-=1,i.trigger(j["default"].FPS_DROP_LEVEL_CAPPING,{level:k,droppedLevel:i.currentLevel}),i.autoLevelCapping=k,i.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}}},{key:"checkFPSInterval",value:function(){var a=this.video;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)}}]),b}(l["default"]);c["default"]=n},{32:32,33:33,51:51}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MEDIA_ATTACHED,j["default"].MEDIA_DETACHING,j["default"].FRAG_PARSING_METADATA));return c.id3Track=void 0,c.media=void 0,c}return g(b,a),h(b,[{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(a){this.media=a.media,this.media&&(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden")}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onFragParsingMetadata",value:function(a){var b=a.frag,c=a.samples,d=b.start,e=b.start+b.duration;d===e&&(e+=1e-4);for(var f=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,g=0;g<c.length;g++){var h=this.parseID3Frame(c[g].data),i=this.decodeID3Frame(h);if(i){var j=new f(d,e,"");j.value=i,this.id3Track.addCue(j)}}}},{key:"parseID3Frame",value:function(a){if(a.length<21)return void 0;if(73===a[0]&&68===a[1]&&51===a[2]){var b=String.fromCharCode(a[10],a[11],a[12],a[13]);return a=a.subarray(20),{type:b,data:a}}}},{key:"decodeID3Frame",value:function(a){return"TXXX"===a.type?this.decodeTxxxFrame(a):"PRIV"===a.type?this.decodePrivFrame(a):"T"===a.type[0]?this.decodeTextFrame(a):void 0}},{key:"decodeTxxxFrame",value:function(a){if(a.size<2)return void 0;if(3!==a.data[0])return void 0;var b=1,c=this.utf8ArrayToStr(a.data.subarray(b));b+=c.length+1;var d=this.utf8ArrayToStr(a.data.subarray(b));return{key:"TXXX",description:c,data:d}}},{key:"decodeTextFrame",value:function(a){if(a.size<2)return void 0;if(3!==a.data[0])return void 0;var b=a.data.subarray(1);return{key:a.type,data:this.utf8ArrayToStr(b)}}},{key:"decodePrivFrame",value:function(a){if(a.size<2)return void 0;var b=this.utf8ArrayToStr(a.data),c=a.data.subarray(b.length+1);return{key:"PRIV",info:b,data:c.buffer}}},{key:"utf8ArrayToStr",value:function(a){for(var b=void 0,c=void 0,d="",e=0,f=a.length;f>e;){var g=a[e++];switch(g>>4){case 0:return d;case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(g);break;case 12:case 13:b=a[e++],d+=String.fromCharCode((31&g)<<6|63&b);break;case 14:b=a[e++],c=a[e++],d+=String.fromCharCode((15&g)<<12|(63&b)<<6|(63&c)<<0)}}return d}}]),b}(l["default"]);c["default"]=m},{32:32,33:33}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=a(51),n=a(31),o=a(35),p=d(o),q=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MANIFEST_LOADED,j["default"].LEVEL_LOADED,j["default"].FRAG_LOADED,j["default"].ERROR));return c.ontick=c.tick.bind(c),c._manualLevel=-1,c}return g(b,a),h(b,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var a=this._levels;a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(a){var b,c=[],d=[],e={},f=!1,g=!1,h=this.hls,i=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),k=function(a,b){return MediaSource.isTypeSupported(a+"/mp4;codecs="+b)};if(a.levels.forEach(function(a){a.videoCodec&&(f=!0),i&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0),(a.audioCodec||a.attrs&&a.attrs.AUDIO)&&(g=!0);var b=e[a.bitrate];void 0===b?(e[a.bitrate]=c.length,a.url=[a.url],a.urlId=0,c.push(a)):c[b].url.push(a.url)}),f&&g?c.forEach(function(a){a.videoCodec&&d.push(a)}):d=c,d=d.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||k("audio",b))&&(!c||k("video",c))}),d.length){b=d[0].bitrate,d.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=d;for(var l=0;l<d.length;l++)if(d[l].bitrate===b){this._firstLevel=l,m.logger.log("manifest loaded,"+d.length+" level(s) found, first bitrate:"+b);break}h.trigger(j["default"].MANIFEST_PARSED,{levels:d,firstLevel:this._firstLevel,stats:a.stats,audio:g,video:f,altAudio:a.audioTracks.length>0})}else h.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:h.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(a){var b=this._levels,c=this.hls;if(a>=0&&a<b.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==a){m.logger.log("switching to level "+a),this._level=a;var d=b[a];d.level=a,c.trigger(j["default"].LEVEL_SWITCH,d),c.trigger(j["default"].LEVEL_SWITCHING,d)}var e=b[a],f=e.details;if(!f||f.live===!0){var g=e.urlId;c.trigger(j["default"].LEVEL_LOADING,{url:e.url[g],level:a,id:g})}}else c.trigger(j["default"].ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(a){if(!a.fatal){var b=a.details,c=this.hls,d=void 0,e=void 0,f=!1;switch(b){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:d=a.frag.level;break;case n.ErrorDetails.LEVEL_LOAD_ERROR:case n.ErrorDetails.LEVEL_LOAD_TIMEOUT:d=a.context.level,f=!0;break;case n.ErrorDetails.REMUX_ALLOC_ERROR:d=a.level}if(void 0!==d){e=this._levels[d],e.loadError?e.loadError++:e.loadError=1;var g=e.url.length;if(g>1&&e.loadError<g)e.urlId=(e.urlId+1)%g,e.details=void 0,m.logger.warn("level controller,"+b+" for level "+d+": switching to redundant stream id "+e.urlId);else{var h=-1===this._manualLevel&&d;if(h)m.logger.warn("level controller,"+b+": switch-down for next fragment"),c.nextAutoLevel=Math.max(0,d-1);else if(e&&e.details&&e.details.live)m.logger.warn("level controller,"+b+" on live stream, discard"),f&&(this._level=void 0);else if(b===n.ErrorDetails.LEVEL_LOAD_ERROR||b===n.ErrorDetails.LEVEL_LOAD_TIMEOUT){var i=c.media,j=i&&p["default"].isBuffered(i,i.currentTime)&&p["default"].isBuffered(i,i.currentTime+.5);if(j){var k=c.config.levelLoadingRetryDelay;m.logger.warn("level controller,"+b+", but media buffered, retry in "+k+"ms"),this.timer=setTimeout(this.ontick,k)}else m.logger.error("cannot recover "+b+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),a.fatal=!0}}}}}},{key:"onFragLoaded",value:function(a){var b=a.frag;if(b&&"main"===b.type){var c=this._levels[b.level];c&&(c.loadError=0)}}},{key:"onLevelLoaded",value:function(a){var b=a.level;if(b===this._level){var c=this._levels[b];c.loadError=0;var d=a.details;if(d.live){var e=1e3*(d.averagetargetduration?d.averagetargetduration:d.targetduration),f=c.details;f&&d.endSN===f.endSN&&(e/=2,m.logger.log("same live playlist, reload twice faster")),e-=performance.now()-a.stats.trequest,e=Math.max(1e3,Math.round(e)),m.logger.log("live playlist, reload in "+e+" ms"),this.timer=setTimeout(this.ontick,e)}else this.timer=null}}},{key:"tick",value:function(){var a=this._level;if(void 0!==a&&this.canload){var b=this._levels[a];if(b&&b.url){var c=b.urlId;this.hls.trigger(j["default"].LEVEL_LOADING,{url:b.url[c],level:a,id:c})}}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(a){var b=this._levels;b&&b.length>a&&(this._level!==a||void 0===b[a].details)&&this.setLevelInternal(a)}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(a){this._manualLevel=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this._manualLevel&&(this.hls.nextAutoLevel=a)}}]),b}(l["default"]);c["default"]=q},{31:31,32:32,33:33,35:35,51:51}],13:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(46),j=d(i),k=a(35),l=d(k),m=a(25),n=d(m),o=a(33),p=d(o),q=a(32),r=d(q),s=a(36),t=d(s),u=a(52),v=d(u),w=a(31),x=a(51),y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},z=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,p["default"].MEDIA_ATTACHED,p["default"].MEDIA_DETACHING,p["default"].MANIFEST_LOADING,p["default"].MANIFEST_PARSED,p["default"].LEVEL_LOADED,p["default"].KEY_LOADED,p["default"].FRAG_LOADED,p["default"].FRAG_LOAD_EMERGENCY_ABORTED,p["default"].FRAG_PARSING_INIT_SEGMENT,p["default"].FRAG_PARSING_DATA,p["default"].FRAG_PARSED,p["default"].ERROR,p["default"].AUDIO_TRACK_SWITCHING,p["default"].AUDIO_TRACK_SWITCHED,p["default"].BUFFER_CREATED,p["default"].BUFFER_APPENDED,p["default"].BUFFER_FLUSHED));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=y.STOPPED,c.ontick=c.tick.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),r["default"].prototype.destroy.call(this),this.state=y.STOPPED}},{key:"startLoad",value:function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;-1===d&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&-1===a&&(x.logger.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=y.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this.forceStartLoad=!0,this.state=y.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED,
this.forceStartLoad=!1}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case y.ERROR:break;case y.BUFFER_FLUSHING:this.fragLoadError=0;break;case y.IDLE:this._doTickIdle();break;case y.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:var b=performance.now(),c=this.retryDate;(!c||b>=c||this.media&&this.media.seeking)&&(x.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.ERROR:case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var a=this.hls,b=a.config,c=this.media;if(void 0===this.levelLastLoaded||c||!this.startFragRequested&&b.startFragPrefetch){var d=void 0;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,f=this.levels[e],g=f.bitrate,h=void 0;h=g?Math.max(8*b.maxBufferSize/g,b.maxBufferLength):b.maxBufferLength,h=Math.min(h,b.maxMaxBufferLength);var i=l["default"].bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),j=i.len;if(!(j>=h)){x.logger.trace("buffer length of "+j.toFixed(3)+" is below max of "+h.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e;var k=f.details;if("undefined"==typeof k||k.live&&this.levelLastLoaded!==e)return void(this.state=y.WAITING_LEVEL);var m=this.fragPrevious;if(!k.live&&m&&m.sn===k.endSN){var n=Math.min(c.duration,m.start+m.duration);if(n-Math.max(i.end,m.start)<=Math.max(.2,m.duration/2)){var o={};return this.altAudio&&(o.type="video"),this.hls.trigger(p["default"].BUFFER_EOS,o),void(this.state=y.ENDED)}}this._fetchPayloadOrEos(d,i,k)}}}},{key:"_fetchPayloadOrEos",value:function(a,b,c){var d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0!==g){var h=f[0].start,i=f[g-1].start+f[g-1].duration,j=b.end,k=void 0;if(c.initSegment&&!c.initSegment.data)k=c.initSegment;else if(c.live){var l=this.config.initialLiveManifestSize;if(l>g)return void x.logger.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l);if(k=this._ensureFragmentAtLivePoint(c,j,h,i,d,f,g),null===k)return}else h>j&&(k=f[0]);k||(k=this._findFragment(h,d,g,f,j,i,c)),k&&this._loadFragmentOrKey(k,e,c,a,j)}}},{key:"_ensureFragmentAtLivePoint",value:function(a,b,c,d,e,f,g){var h=this.hls.config,i=this.media,j=void 0,k=void 0!==h.liveMaxLatencyDuration?h.liveMaxLatencyDuration:h.liveMaxLatencyDurationCount*a.targetduration;if(b<Math.max(c-h.maxFragLookUpTolerance,d-k)){var l=this.liveSyncPosition=this.computeLivePosition(c,a);x.logger.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+l.toFixed(3)),b=l,i&&i.readyState&&i.duration>l&&(i.currentTime=l)}if(a.PTSKnown&&b>d&&i&&i.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(e){var m=e.sn+1;m>=a.startSN&&m<=a.endSN&&(j=f[m-a.startSN],x.logger.log("live playlist, switching playlist, load frag with next SN: "+j.sn))}j||(j=f[Math.min(g-1,Math.round(g/2))],x.logger.log("live playlist, switching playlist, unknown, load middle frag : "+j.sn))}return j}},{key:"_findFragment",value:function(a,b,c,d,e,f,g){var h=this.hls.config,i=void 0,k=void 0,l=h.maxFragLookUpTolerance,m=b?d[b.sn-d[0].sn+1]:void 0,n=function(a){var b=Math.min(l,a.duration);return a.start+a.duration-b<=e?1:a.start-b>e&&a.start?-1:0};if(f>e?(e>f-l&&(l=0),k=m&&!n(m)?m:j["default"].search(d,n)):k=d[c-1],k){i=k;var o=i.sn-g.startSN,p=b&&i.level===b.level,q=d[o-1],r=d[o+1];if(p&&i.sn===b.sn)if(i.sn<g.endSN){var s=b.deltaPTS;s&&s>h.maxBufferHole&&b.dropped&&o?(i=q,x.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),b.loadCounter--):(i=r,x.logger.log("SN just loaded, load next one: "+i.sn))}else i=null;else i.dropped&&!p&&(r&&r.backtracked?(x.logger.warn("Already backtracked from fragment "+(o+1)+", will not backtrack to fragment "+o+". Loading fragment "+(o+1)),i=r):(x.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),i.dropped=0,q?(q.loadCounter&&q.loadCounter--,i=q):i=null))}return i}},{key:"_loadFragmentOrKey",value:function(a,b,c,d,e){var f=this.hls,g=f.config;if(!a.decryptdata||null==a.decryptdata.uri||null!=a.decryptdata.key){if(x.logger.log("Loading "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b+", currentTime:"+d.toFixed(3)+",bufferEnd:"+e.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){a.loadCounter++;var h=g.fragLoadingLoopThreshold;if(a.loadCounter>h&&Math.abs(this.fragLoadIdx-a.loadIdx)<h)return void f.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a})}else a.loadCounter=1;return a.loadIdx=this.fragLoadIdx,this.fragCurrent=a,this.startFragRequested=!0,isNaN(a.sn)||(this.nextLoadPosition=a.start+a.duration),a.autoLevel=f.autoLevelEnabled,a.bitrateTest=this.bitrateTest,f.trigger(p["default"].FRAG_LOADING,{frag:a}),this.demuxer||(this.demuxer=new n["default"](f,"main")),void(this.state=y.FRAG_LOADING)}x.logger.log("Loading key for "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b),this.state=y.KEY_LOADING,f.trigger(p["default"].KEY_LOADING,{frag:a})}},{key:"getBufferedFrag",value:function(a){return j["default"].search(this._bufferedFrags,function(b){return a<b.startPTS?-1:a>b.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(a){return a?this.getBufferedFrag(a.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function(){var a,b,c=this.media;if(c&&c.readyState&&c.seeking===!1&&(b=c.currentTime,b>c.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=b),l["default"].isBuffered(c,b)?a=this.getBufferedFrag(b):l["default"].isBuffered(c,b+.1)&&(a=this.getBufferedFrag(b+.1)),a)){var d=a;if(d!==this.fragPlaying){this.hls.trigger(p["default"].FRAG_CHANGED,{frag:d});var e=d.level;this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(p["default"].LEVEL_SWITCHED,{level:e}),this.fragPlaying=d}}}},{key:"immediateLevelSwitch",value:function(){if(x.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var a=this.media,b=void 0;a?(b=a.paused,a.pause()):b=!0,this.previouslyPaused=b}var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,l["default"].isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())}},{key:"nextLevelSwitch",value:function(){var a=this.media;if(a&&a.readyState){var b=void 0,c=void 0,d=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,c=this.getBufferedFrag(a.currentTime),c&&c.startPTS>1&&this.flushMainBuffer(0,c.startPTS-1),a.paused)b=0;else{var e=this.hls.nextLoadLevel,f=this.levels[e],g=this.fragLastKbps;b=g&&this.fragCurrent?this.fragCurrent.duration*f.bitrate/(1e3*g)+1:0}if(d=this.getBufferedFrag(a.currentTime+b),d&&(d=this.followingBufferedFrag(d))){var h=this.fragCurrent;h&&h.loader&&h.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(d.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(a,b){this.state=y.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(p["default"].BUFFER_FLUSHING,c)}},{key:"onMediaAttached",value:function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0,a.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var a=this.media,b=a?a.currentTime:void 0,c=this.config;if(x.logger.log("media seeking to "+b.toFixed(3)),this.state===y.FRAG_LOADING){var d=this.mediaBuffer?this.mediaBuffer:a,e=l["default"].bufferInfo(d,b,this.config.maxBufferHole),f=this.fragCurrent;if(0===e.len&&f){var g=c.maxFragLookUpTolerance,h=f.start-g,i=f.start+f.duration+g;h>b||b>i?(f.loader&&(x.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),f.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE):x.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===y.ENDED&&(this.state=y.IDLE);a&&(this.lastCurrentTime=b),this.state!==y.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*c.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=b),this.tick()}},{key:"onMediaSeeked",value:function(){x.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){x.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){x.logger.log("trigger BUFFER_RESET"),this.hls.trigger(p["default"].BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){b=a.audioCodec,b&&(-1!==b.indexOf("mp4a.40.2")&&(c=!0),-1!==b.indexOf("mp4a.40.5")&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&x.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)}},{key:"onLevelLoaded",value:function(a){var b=a.details,c=a.level,d=this.levels[c],e=b.totalduration,f=0;if(x.logger.log("level "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),this.levelLastLoaded=c,b.live){var g=d.details;g&&b.fragments.length>0?(t["default"].mergeDetails(g,b),f=b.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(f,g),b.PTSKnown?x.logger.log("live playlist sliding:"+f.toFixed(3)):x.logger.log("live playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,x.logger.log("live playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,this.hls.trigger(p["default"].LEVEL_UPDATED,{details:b,level:c}),this.startFragRequested===!1){if(-1===this.startPosition||-1===this.lastCurrentTime){var h=b.startTimeOffset;isNaN(h)?b.live?(this.startPosition=this.computeLivePosition(f,b),x.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(0>h&&(x.logger.log("negative start time offset "+h+", count from end of last fragment"),h=f+e+h),x.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===y.WAITING_LEVEL&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var b=this.fragCurrent,c=a.frag;if(this.state===y.FRAG_LOADING&&b&&"main"===c.type&&c.level===b.level&&c.sn===b.sn){var d=a.stats,e=this.levels[b.level],f=e.details;if(x.logger.log("Loaded  "+b.sn+" of ["+f.startSN+" ,"+f.endSN+"],level "+b.level),this.bitrateTest=!1,this.stats=d,c.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=y.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=performance.now(),this.hls.trigger(p["default"].FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else if("initSegment"===c.sn)this.state=y.IDLE,d.tparsed=d.tbuffered=performance.now(),f.initSegment.data=a.payload,this.hls.trigger(p["default"].FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else{this.state=y.PARSING;var g=f.totalduration,h=b.level,i=b.sn,j=this.config.defaultAudioCodec||e.audioCodec;this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),void 0===j&&(j=this.lastAudioCodec),j&&(j=-1!==j.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,x.logger.log("Parsing "+i+" of ["+f.startSN+" ,"+f.endSN+"],level "+h+", cc "+b.cc);var k=this.demuxer;k||(k=this.demuxer=new n["default"](this.hls,"main"));var l=this.media,m=l&&l.seeking,o=!m&&(f.PTSKnown||!f.live),q=f.initSegment?f.initSegment.data:[];k.push(a.payload,q,j,e.videoCodec,b,g,o,void 0)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var b=this.fragCurrent,c=a.frag;if(b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING){var d,e,f=a.tracks;if(f.audio&&this.altAudio&&delete f.audio,e=f.audio){var g=this.levels[this.level].audioCodec,h=navigator.userAgent.toLowerCase();g&&this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),g=-1!==g.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==e.metadata.channelCount&&-1===h.indexOf("firefox")&&(g="mp4a.40.5"),-1!==h.indexOf("android")&&"audio/mpeg"!==e.container&&(g="mp4a.40.2",x.logger.log("Android: force audio codec to "+g)),e.levelCodec=g,e.id=a.id}e=f.video,e&&(e.levelCodec=this.levels[this.level].videoCodec,e.id=a.id),this.hls.trigger(p["default"].BUFFER_CODECS,f);for(d in f){e=f[d],x.logger.log("main track:"+d+",container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var i=e.initSegment;i&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p["default"].BUFFER_APPENDING,{type:d,data:i,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"main"===a.id&&d.sn===c.sn&&d.level===c.level&&("audio"!==a.type||!this.altAudio)&&this.state===y.PARSING){var e=this.levels[this.level],f=c;if(isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),x.logger.log("Parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0)),"video"===a.type)if(f.dropped=a.dropped,f.dropped){if(!f.backtracked)return f.backtracked=!0,this.nextLoadPosition=a.startPTS,this.state=y.IDLE,void this.tick();x.logger.warn("Already backtracked on this fragment, appending with the gap")}else f.backtracked=!1;var g=t["default"].updateFragPTSDTS(e.details,f,a.startPTS,a.endPTS,a.startDTS,a.endDTS),h=this.hls;h.trigger(p["default"].LEVEL_PTS_UPDATED,{details:e.details,level:this.level,drift:g,type:a.type,start:a.startPTS,end:a.endPTS}),[a.data1,a.data2].forEach(function(c){c&&c.length&&b.state===y.PARSING&&(b.appended=!0,b.pendingBuffering=!0,h.trigger(p["default"].BUFFER_APPENDING,{type:a.type,data:c,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(a){var b=!!a.url,c=a.id;if(!b){if(this.mediaBuffer!==this.media){x.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var d=this.fragCurrent;d.loader&&(x.logger.log("switching to main audio track, cancel main fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.IDLE}var e=this.hls;e.trigger(p["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),e.trigger(p["default"].AUDIO_TRACK_SWITCHED,{id:c}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(a){var b=a.id,c=!!this.hls.audioTracks[b].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(x.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()}},{key:"onBufferCreated",value:function(a){var b=a.tracks,c=void 0,d=void 0,e=!1;for(var f in b){var g=b[f];"main"===g.id?(d=f,c=g,"video"===f&&(this.videoBuffer=b[f].buffer)):e=!0}e&&c?(x.logger.log("alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(a){if("main"===a.parent){var b=this.state;(b===y.PARSING||b===y.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==y.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent;if(a){var b=this.mediaBuffer?this.mediaBuffer:this.media;x.logger.log("main buffered : "+v["default"].toString(b.buffered));var c=this._bufferedFrags.filter(function(a){return l["default"].isBuffered(b,(a.startPTS+a.endPTS)/2)});c.push(a),this._bufferedFrags=c.sort(function(a,b){return a.startPTS-b.startPTS}),this.fragPrevious=a;var d=this.stats;d.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*d.total/(d.tbuffered-d.tfirst)),this.hls.trigger(p["default"].FRAG_BUFFERED,{stats:d,frag:a,id:"main"}),this.state=y.IDLE}this.tick()}}},{key:"onError",value:function(a){var b=a.frag||this.fragCurrent;if(!b||"main"===b.type){var c=this.media,d=c&&l["default"].isBuffered(c,c.currentTime)&&l["default"].isBuffered(c,c.currentTime+.5);switch(a.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:if(!a.fatal){var e=this.fragLoadError;e?e++:e=1;var f=this.config;if(e<=f.fragLoadingMaxRetry||d||b.autoLevel&&b.level){this.fragLoadError=e,b.loadCounter=0;var g=Math.min(Math.pow(2,e-1)*f.fragLoadingRetryDelay,f.fragLoadingMaxRetryTimeout);x.logger.warn("mediaController: frag loading failed, retry in "+g+" ms"),this.retryDate=performance.now()+g,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=y.FRAG_LOADING_WAITING_RETRY}else x.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=y.ERROR}break;case w.ErrorDetails.FRAG_LOOP_LOADING_ERROR:a.fatal||(d?(this._reduceMaxBufferLength(b.duration),this.state=y.IDLE):b.autoLevel&&0!==b.level||(a.fatal=!0,this.state=y.ERROR));break;case w.ErrorDetails.LEVEL_LOAD_ERROR:case w.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.ERROR&&(a.fatal?(this.state=y.ERROR,x.logger.warn("streamController: "+a.details+",switch to "+this.state+" state ...")):this.state===y.WAITING_LEVEL&&(this.state=y.IDLE));break;case w.ErrorDetails.BUFFER_FULL_ERROR:"main"!==a.parent||this.state!==y.PARSING&&this.state!==y.PARSED||(d?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=y.IDLE):(x.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(a){var b=this.config;b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,x.logger.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*b.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var a=this.media;if(a&&a.readyState){var b=a.currentTime,c=this.mediaBuffer?this.mediaBuffer:a,d=c.buffered;if(!this.loadedmetadata&&d.length){this.loadedmetadata=!0;var e=a.seeking?b:this.startPosition,f=l["default"].isBuffered(c,e);b===e&&f||(x.logger.log("target start position:"+e),f||(e=d.start(0),x.logger.log("target start position not buffered, seek to buffered.start(0) "+e)),x.logger.log("adjust currentTime from "+b+" to "+e),a.currentTime=e)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var g=l["default"].bufferInfo(a,b,0),h=!(a.paused||a.ended||0===a.buffered.length),i=.5,j=b!==this.lastCurrentTime,k=this.config;if(j)this.stallReported&&(x.logger.warn("playback not stuck anymore @"+b+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(h){var m=performance.now(),n=this.hls;if(this.stalled){var o=m-this.stalled,q=g.len,r=this.nudgeRetry||0;if(i>=q&&o>1e3*k.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,x.logger.warn("playback stalling in low buffer @"+b),n.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:q}));var s=g.nextStart,t=s-b;if(s&&t<k.maxSeekHole&&t>0){this.nudgeRetry=++r;var u=r*k.nudgeOffset;x.logger.log("adjust currentTime from "+a.currentTime+" to next buffered @ "+s+" + nudge "+u),a.currentTime=s+u,this.stalled=void 0,n.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:s+u-b})}}else if(q>i&&o>1e3*k.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,x.logger.warn("playback stalling in high buffer @"+b),n.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:q})),this.stalled=void 0,this.nudgeRetry=++r,r<k.nudgeMaxRetry){var v=a.currentTime,y=v+r*k.nudgeOffset;x.logger.log("adjust currentTime from "+v+" to "+y),a.currentTime=y,n.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else x.logger.error("still stuck in high buffer @"+b+" after "+k.nudgeMaxRetry+", raise fatal error"),n.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=m,this.stallReported=!1}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=y.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(b){return l["default"].isBuffered(a,(b.startPTS+b.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=y.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,x.logger.log("main stream:"+b+"->"+a),this.hls.trigger(p["default"].STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var a=this.media;if(a){var b=this.getBufferedFrag(a.currentTime);if(b)return b.level}return-1}},{key:"nextBufferedFrag",get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a}}]),b}(r["default"]);c["default"]=z},{25:25,31:31,32:32,33:33,35:35,36:36,46:46,51:51,52:52}],14:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=a(51),n=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].ERROR,j["default"].SUBTITLE_TRACKS_UPDATED,j["default"].SUBTITLE_TRACK_SWITCH,j["default"].SUBTITLE_TRACK_LOADED,j["default"].SUBTITLE_FRAG_PROCESSED));return c.config=a.config,c.vttFragSNsProcessed={},c.vttFragQueues=void 0,c.currentlyProcessing=null,c.currentTrackId=-1,c}return g(b,a),h(b,[{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function(){var a=this;this.vttFragQueues={},this.tracks.forEach(function(b){a.vttFragQueues[b.id]=[]})}},{key:"nextFrag",value:function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var a=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(j["default"].FRAG_LOADING,{frag:a})}}},{key:"onSubtitleFragProcessed",value:function(a){a.success&&this.vttFragSNsProcessed[a.frag.trackId].push(a.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function(a){var b=a.frag;b&&"subtitle"!==b.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function(a){var b=this;m.logger.log("subtitle tracks updated"),this.tracks=a.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(a){b.vttFragSNsProcessed[a.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(a){this.currentTrackId=a.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function(a){var b=this.vttFragSNsProcessed[a.id],c=this.vttFragQueues[a.id],d=this.currentlyProcessing?this.currentlyProcessing.sn:-1,e=function(a){return b.indexOf(a.sn)>-1},f=function(a){return c.some(function(b){return b.sn===a.sn})};a.details.fragments.forEach(function(b){e(b)||b.sn===d||f(b)||(b.trackId=a.id,c.push(b))}),this.nextFrag()}}]),b}(l["default"]);c["default"]=n},{32:32,33:33,51:51}],15:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a){for(var b=[],c=0;c<a.length;c++)"subtitles"===a[c].kind&&b.push(a[c]);return b}Object.defineProperty(c,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a(33),k=d(j),l=a(32),m=d(l),n=a(51),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,k["default"].MEDIA_ATTACHED,k["default"].MEDIA_DETACHING,k["default"].MANIFEST_LOADING,k["default"].MANIFEST_LOADED,k["default"].SUBTITLE_TRACK_LOADED));return c.tracks=[],c.trackId=-1,c.media=void 0,c}return g(b,a),i(b,[{key:"destroy",value:function(){m["default"].prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(a){var b=this;this.media=a.media,this.media&&this.media.textTracks.addEventListener("change",function(){if(b.media){for(var a=-1,c=h(b.media.textTracks),d=0;d<c.length;d++)"showing"===c[d].mode&&(a=d);b.subtitleTrack=a}})}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(a){var b=this,c=a.subtitles||[],d=!1;this.tracks=c,this.trackId=-1,this.hls.trigger(k["default"].SUBTITLE_TRACKS_UPDATED,{subtitleTracks:c}),c.forEach(function(a){a["default"]&&(b.subtitleTrack=a.id,d=!0)})}},{key:"onTick",value:function(){var a=this.trackId,b=this.tracks[a];if(b){var c=b.details;(void 0===c||c.live===!0)&&(n.logger.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(k["default"].SUBTITLE_TRACK_LOADING,{url:b.url,id:a}))}}},{key:"onSubtitleTrackLoaded",value:function(a){var b=this;a.id<this.tracks.length&&(n.logger.log("subtitle track "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(function(){b.onTick()},1e3*a.details.targetduration,this)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,n.logger.log("switching to subtitle track "+a);var b=this.tracks[a];this.hls.trigger(k["default"].SUBTITLE_TRACK_SWITCH,{id:a});var c=b.details;(void 0===c||c.live===!0)&&(n.logger.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(k["default"].SUBTITLE_TRACK_LOADING,{url:b.url,id:a}))}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.trackId!==a&&this.setSubtitleTrackInternal(a)}}]),b}(m["default"]);c["default"]=o},{32:32,33:33,51:51}],16:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}function i(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function j(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}Object.defineProperty(c,"__esModule",{value:!0});var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=a(33),m=d(l),n=a(32),o=d(n),p=a(47),q=d(p),r=a(55),s=d(r),t=a(51),u=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,m["default"].MEDIA_ATTACHING,m["default"].MEDIA_DETACHING,m["default"].FRAG_PARSING_USERDATA,m["default"].MANIFEST_LOADING,m["default"].MANIFEST_LOADED,m["default"].FRAG_LOADED,m["default"].LEVEL_SWITCHING,m["default"].INIT_PTS_FOUND));if(c.hls=a,c.config=a.config,
c.enabled=!0,c.Cues=a.config.cueHandler,c.textTracks=[],c.tracks=[],c.unparsedVttFrags=[],c.initPTS=void 0,c.cueRanges=[],c.config.enableCEA708Captions){var d=c,g=function(a,b){var c=null;try{c=new window.Event("addtrack")}catch(d){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)},i={newCue:function(a,b,c){if(!d.textTrack1){var e=d.getExistingTrack("1");if(e)d.textTrack1=e,h(d.textTrack1),g(d.textTrack1,d.media);else{var f=d.createTextTrack("captions",d.config.captionsTextTrack1Label,d.config.captionsTextTrack1LanguageCode);f&&(f.textTrack1=!0,d.textTrack1=f)}}d.addCues("textTrack1",a,b,c)}},j={newCue:function(a,b,c){if(!d.textTrack2){var e=d.getExistingTrack("2");if(e)d.textTrack2=e,h(d.textTrack2),g(d.textTrack2,d.media);else{var f=d.createTextTrack("captions",d.config.captionsTextTrack2Label,d.config.captionsTextTrack1LanguageCode);f&&(f.textTrack2=!0,d.textTrack2=f)}}d.addCues("textTrack2",a,b,c)}};c.cea608Parser=new q["default"](0,i,j)}return c}return g(b,a),k(b,[{key:"addCues",value:function(a,b,c,d){for(var e=this.cueRanges,f=!1,g=e.length;g--;){var h=e[g],i=j(h[0],h[1],b,c);if(i>=0&&(h[0]=Math.min(h[0],b),h[1]=Math.max(h[1],c),f=!0,i/(c-b)>.5))return}f||e.push([b,c]),this.Cues.newCue(this[a],b,c,d)}},{key:"onInitPtsFound",value:function(a){var b=this;"undefined"==typeof this.initPTS&&(this.initPTS=a.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(a){b.onFragLoaded(a)}),this.unparsedVttFrags=[])}},{key:"getExistingTrack",value:function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c],e="textTrack"+a;if(d[e]===!0)return d}return null}},{key:"createTextTrack",value:function(a,b,c){var d=this.media;return d?d.addTextTrack(a,b,c):void 0}},{key:"destroy",value:function(){o["default"].prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(a){this.media=a.media}},{key:"onMediaDetaching",value:function(){h(this.textTrack1),h(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0};var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)h(b[c])}}},{key:"onManifestLoaded",value:function(a){var b=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=a.subtitles||[];var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,d){var e=void 0;if(d<c.length){var f=c[d];i(f,a)&&(e=f)}e||(e=b.createTextTrack("subtitles",a.name,a.lang)),e.mode=a["default"]?"showing":"hidden",b.textTracks.push(e)})}}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(a){var b=a.frag,c=a.payload;if("main"===b.type){var d=b.sn;d!==this.lastSn+1&&this.cea608Parser.reset(),this.lastSn=d}else if("subtitle"===b.type)if(c.byteLength){if("undefined"==typeof this.initPTS)return void this.unparsedVttFrags.push(a);var e=this.vttCCs;e[b.cc]||(e[b.cc]={start:b.start,prevCC:this.prevCC,"new":!0},this.prevCC=b.cc);var f=this.textTracks,g=this.hls;s["default"].parse(c,this.initPTS,e,b.cc,function(a){a.forEach(function(a){f[b.trackId].addCue(a)}),g.trigger(m["default"].SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(a){t.logger.log("Failed to parse VTT cue: "+a),g.trigger(m["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})})}else this.hls.trigger(m["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})}},{key:"onFragParsingUserdata",value:function(a){if(this.enabled&&this.config.enableCEA708Captions)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}}},{key:"extractCea608Data",value:function(a){for(var b,c,d,e,f,g=31&a[0],h=2,i=[],j=0;g>j;j++)b=a[h++],c=127&a[h++],d=127&a[h++],e=0!==(4&b),f=3&b,(0!==c||0!==d)&&e&&0===f&&(i.push(c),i.push(d));return i}}]),b}(o["default"]);c["default"]=u},{32:32,33:33,47:47,51:51,55:55}],17:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.subtle=b,this.aesIV=c}return e(a,[{key:"decrypt",value:function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)}}]),a}();c["default"]=f},{}],18:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e(a,[{key:"uint8ArrayToUint32Array_",value:function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;4>d;d++)c[d]=b.getUint32(4*d);return c}},{key:"initTable",value:function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;256>p;p++)128>p?m[p]=p<<1:m[p]=p<<1^283;for(p=0;256>p;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}}},{key:"expandKey",value:function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f=this.ksRows=4*(e+6+1),g=void 0,h=void 0,i=this.keySchedule=new Uint32Array(f),j=this.invKeySchedule=new Uint32Array(f),k=this.sBox,l=this.rcon,m=this.invSubMix,n=m[0],o=m[1],p=m[2],q=m[3],r=void 0,s=void 0;for(g=0;f>g;g++)e>g?r=i[g]=b[g]:(s=r,g%e===0?(s=s<<8|s>>>24,s=k[s>>>24]<<24|k[s>>>16&255]<<16|k[s>>>8&255]<<8|k[255&s],s^=l[g/e|0]<<24):e>6&&g%e===4&&(s=k[s>>>24]<<24|k[s>>>16&255]<<16|k[s>>>8&255]<<8|k[255&s]),i[g]=r=(i[g-e]^s)>>>0);for(h=0;f>h;h++)g=f-h,s=3&h?i[g]:i[g-4],4>h||4>=g?j[h]=s:j[h]=n[k[s>>>24]]^o[k[s>>>16&255]]^p[k[s>>>8&255]]^q[k[255&s]],j[h]=j[h]>>>0}}},{key:"networkToHostOrderSwap",value:function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24}},{key:"decrypt",value:function(a,b,c){for(var d,e,f=this.keySize+6,g=this.invKeySchedule,h=this.invSBox,i=this.invSubMix,j=i[0],k=i[1],l=i[2],m=i[3],n=this.uint8ArrayToUint32Array_(c),o=n[0],p=n[1],q=n[2],r=n[3],s=new Int32Array(a),t=new Int32Array(s.length),u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0,F=void 0,G=this.networkToHostOrderSwap;b<s.length;){for(C=G(s[b]),D=G(s[b+1]),E=G(s[b+2]),F=G(s[b+3]),y=C^g[0],z=F^g[1],A=E^g[2],B=D^g[3],d=4,e=1;f>e;e++)u=j[y>>>24]^k[z>>16&255]^l[A>>8&255]^m[255&B]^g[d],v=j[z>>>24]^k[A>>16&255]^l[B>>8&255]^m[255&y]^g[d+1],w=j[A>>>24]^k[B>>16&255]^l[y>>8&255]^m[255&z]^g[d+2],x=j[B>>>24]^k[y>>16&255]^l[z>>8&255]^m[255&A]^g[d+3],y=u,z=v,A=w,B=x,d+=4;u=h[y>>>24]<<24^h[z>>16&255]<<16^h[A>>8&255]<<8^h[255&B]^g[d],v=h[z>>>24]<<24^h[A>>16&255]<<16^h[B>>8&255]<<8^h[255&y]^g[d+1],w=h[A>>>24]<<24^h[B>>16&255]<<16^h[y>>8&255]<<8^h[255&z]^g[d+2],x=h[B>>>24]<<24^h[y>>16&255]<<16^h[z>>8&255]<<8^h[255&A]^g[d+3],d+=3,t[b]=G(u^o),t[b+1]=G(x^p),t[b+2]=G(w^q),t[b+3]=G(v^r),o=C,p=D,q=E,r=F,b+=4}return t.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),a}();c["default"]=f},{}],19:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(17),h=d(g),i=a(20),j=d(i),k=a(18),l=d(k),m=a(31),n=a(51),o=function(){function a(b,c){e(this,a),this.observer=b,this.config=c,this.logEnabled=!0;try{var d=crypto?crypto:self.crypto;this.subtle=d.subtle||d.webkitSubtle}catch(f){}this.disableWebCrypto=!this.subtle}return f(a,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(a,b,c,d){var e=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(n.logger.log("JS AES decrypt"),this.logEnabled=!1);var f=this.decryptor;f||(this.decryptor=f=new l["default"]),f.expandKey(b),d(f.decrypt(a,0,c))}else{this.logEnabled&&(n.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var g=this.subtle;this.key!==b&&(this.key=b,this.fastAesKey=new j["default"](g,b)),this.fastAesKey.expandKey().then(function(f){var i=new h["default"](g,c);i.decrypt(a,f)["catch"](function(f){e.onWebCryptoError(f,a,b,c,d)}).then(function(a){d(a)})})["catch"](function(f){e.onWebCryptoError(f,a,b,c,d)})}}},{key:"onWebCryptoError",value:function(a,b,c,d,e){this.config.enableSoftwareAES?(n.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(b,c,d,e)):(n.logger.error("decrypting error : "+a.message),this.observer.trigger(Event.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))}},{key:"destroy",value:function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)}}]),a}();c["default"]=o},{17:17,18:18,20:20,31:31,51:51}],20:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.subtle=b,this.key=c}return e(a,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),a}();c["default"]=f},{}],21:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(22),h=d(g),i=a(51),j=a(27),k=d(j),l=function(){function a(b,c,d){e(this,a),this.observer=b,this.config=d,this.remuxer=c}return f(a,[{key:"resetInitSegment",value:function(a,b,c,d){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(a,b,c,d){var e,f,g,j,l,m,n,o,p,q,r=new k["default"](a),s=90*r.timeStamp;for(e=this._aacTrack,m=r.length,p=a.length;p-1>m&&(255!==a[m]||240!==(240&a[m+1]));m++);for(e.samplerate||(f=h["default"].getAudioConfig(this.observer,a,m,e.manifestCodec),e.config=f.config,e.samplerate=f.samplerate,e.channelCount=f.channelCount,e.codec=f.codec,i.logger.log("parsed codec:"+e.codec+",rate:"+f.samplerate+",nb channel:"+f.channelCount)),l=0,j=9216e4/e.samplerate;p>m+5&&(n=1&a[m+1]?7:9,g=(3&a[m+3])<<11|a[m+4]<<3|(224&a[m+5])>>>5,g-=n,g>0&&p>=m+n+g);)for(o=s+l*j,q={unit:a.subarray(m+n,m+n+g),pts:o,dts:o},e.samples.push(q),e.len+=g,m+=g+n,l++;p-1>m&&(255!==a[m]||240!==(240&a[m+1]));m++);this.remuxer.remux(e,{samples:[]},{samples:[{pts:s,dts:s,unit:r.payload}],inputTimeScale:9e4},{samples:[]},b,c,d)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(a){var b,c,d=new k["default"](a);if(d.hasTimeStamp)for(b=d.length,c=a.length;c-1>b;b++)if(255===a[b]&&240===(240&a[b+1]))return!0;return!1}}]),a}();c["default"]=l},{22:22,27:27,51:51}],22:[function(a,b,c){"use strict";var d=a(51),e=a(31),f={getAudioConfig:function(a,b,c,f){var g,h,i,j,k,l=navigator.userAgent.toLowerCase(),m=f,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return g=((192&b[c+2])>>>6)+1,h=(60&b[c+2])>>>2,h>n.length-1?void a.trigger(Event.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h}):(j=(1&b[c+2])<<2,j|=(192&b[c+3])>>>6,d.logger.log("manifest codec:"+f+",ADTS data:type:"+g+",sampleingIndex:"+h+"["+n[h]+"Hz],channelConfig:"+j),/firefox/i.test(l)?h>=6?(g=5,k=new Array(4),i=h-3):(g=2,k=new Array(2),i=h):-1!==l.indexOf("android")?(g=2,k=new Array(2),i=h):(g=5,k=new Array(4),f&&(-1!==f.indexOf("mp4a.40.29")||-1!==f.indexOf("mp4a.40.5"))||!f&&h>=6?i=h-3:((f&&-1!==f.indexOf("mp4a.40.2")&&h>=6&&1===j||!f&&1===j)&&(g=2,k=new Array(2)),i=h)),k[0]=g<<3,k[0]|=(14&h)>>1,k[1]|=(1&h)<<7,k[1]|=j<<3,5===g&&(k[1]|=(14&i)>>1,k[2]=(1&i)<<7,k[2]|=8,k[3]=0),{config:k,samplerate:n[h],channelCount:j,codec:"mp4a.40."+g,manifestCodec:m})}};b.exports=f},{31:31,51:51}],23:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(33),h=d(g),i=a(31),j=a(19),k=d(j),l=a(21),m=d(l),n=a(28),o=d(n),p=a(30),q=d(p),r=a(43),s=d(r),t=a(44),u=d(t),v=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.typeSupported=c,this.config=d,this.vendor=f}return f(a,[{key:"destroy",value:function(){var a=this.demuxer;a&&a.destroy()}},{key:"push",value:function(a,b,c,d,e,f,g,i,j,l,m,n){if(a.byteLength>0&&null!=b&&null!=b.key&&"AES-128"===b.method){var o=this.decrypter;null==o&&(o=this.decrypter=new k["default"](this.observer,this.config));var p,q=this;try{p=performance.now()}catch(r){p=Date.now()}o.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var k;try{k=performance.now()}catch(o){k=Date.now()}q.observer.trigger(h["default"].FRAG_DECRYPTED,{stats:{tstart:p,tdecrypt:k}}),q.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,g,i,j,l,m,n)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,g,i,j,l,m,n)}},{key:"pushDecrypted",value:function(a,b,c,d,e,f,g,j,k,l,n,p){var r=this.demuxer;if(!r||g&&!this.probe(a)){var t=this.observer,v=this.typeSupported,w=this.config,x=[{demux:q["default"],remux:s["default"]},{demux:m["default"],remux:s["default"]},{demux:o["default"],remux:u["default"]}];for(var y in x){var z=x[y],A=z.demux.probe;if(A(a)){var B=this.remuxer=new z.remux(t,w,v,this.vendor);r=new z.demux(t,B,w,v),this.probe=A;break}}if(!r)return void t.trigger(h["default"].ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=r}var C=this.remuxer;(g||j)&&(r.resetInitSegment(c,d,e,l),C.resetInitSegment()),g&&(r.resetTimeStamp(),C.resetTimeStamp(p)),"function"==typeof r.setDecryptData&&r.setDecryptData(b),r.append(a,f,k,n)}}]),a}();c["default"]=v},{19:19,21:21,28:28,30:30,31:31,33:33,43:43,44:44}],24:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a(23),f=d(e),g=a(33),h=d(g),i=a(51),j=a(1),k=d(j),l=function(a){var b=new k["default"];b.trigger=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];b.emit.apply(b,[a,a].concat(d))},b.off=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];b.removeListener.apply(b,[a].concat(d))};var c=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(d){var e=d.data;switch(e.cmd){case"init":var g=JSON.parse(e.config);a.demuxer=new f["default"](b,e.typeSupported,g,e.vendor);try{i.enableLogs(g.debug===!0)}catch(h){console.warn("demuxerWorker: unable to enable logs")}c("init",null);break;case"demux":a.demuxer.push(e.data,e.decryptdata,e.initSegment,e.audioCodec,e.videoCodec,e.timeOffset,e.discontinuity,e.trackSwitch,e.contiguous,e.duration,e.accurateTimeOffset,e.defaultInitPTS)}}),b.on(h["default"].FRAG_DECRYPTED,c),b.on(h["default"].FRAG_PARSING_INIT_SEGMENT,c),b.on(h["default"].FRAG_PARSED,c),b.on(h["default"].ERROR,c),b.on(h["default"].FRAG_PARSING_METADATA,c),b.on(h["default"].FRAG_PARSING_USERDATA,c),b.on(h["default"].INIT_PTS_FOUND,c),b.on(h["default"].FRAG_PARSING_DATA,function(b,c){var d=[],e={event:b,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),a.postMessage(e,d)})};c["default"]=l},{1:1,23:23,33:33,51:51}],25:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(33),h=d(g),i=a(23),j=d(i),k=a(24),l=d(k),m=a(51),n=a(31),o=a(1),p=d(o),q=function(){function b(c,d){e(this,b),this.hls=c,this.id=d;var f=this.observer=new p["default"],g=c.config;f.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];f.emit.apply(f,[a,a].concat(c))},f.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];f.removeListener.apply(f,[a].concat(c))};var i=function(a,b){b=b||{},b.frag=this.frag,b.id=this.id,c.trigger(a,b)}.bind(this);f.on(h["default"].FRAG_DECRYPTED,i),f.on(h["default"].FRAG_PARSING_INIT_SEGMENT,i),f.on(h["default"].FRAG_PARSING_DATA,i),f.on(h["default"].FRAG_PARSED,i),f.on(h["default"].ERROR,i),f.on(h["default"].FRAG_PARSING_METADATA,i),f.on(h["default"].FRAG_PARSING_USERDATA,i),f.on(h["default"].INIT_PTS_FOUND,i);var k={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(g.enableWorker&&"undefined"!=typeof Worker){m.logger.log("demuxing in webworker");var q=void 0;try{var r=a(3);q=this.w=r(l["default"]),this.onwmsg=this.onWorkerMessage.bind(this),q.addEventListener("message",this.onwmsg),q.onerror=function(a){c.trigger(h["default"].ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})},q.postMessage({cmd:"init",typeSupported:k,vendor:o,id:d,config:JSON.stringify(g)})}catch(s){m.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),q&&URL.revokeObjectURL(q.objectURL),this.demuxer=new j["default"](f,k,g,o),this.w=void 0}}else this.demuxer=new j["default"](f,k,g,o)}return f(b,[{key:"destroy",value:function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}var c=this.observer;c&&(c.removeAllListeners(),this.observer=null)}},{key:"push",value:function(a,b,c,d,e,f,g,h){var i=this.w,j=isNaN(e.startDTS)?e.start:e.startDTS,k=e.decryptdata,l=this.frag,n=!(l&&e.cc===l.cc),o=!(l&&e.level===l.level),p=l&&e.sn===l.sn+1,q=!o&&p;if(n&&m.logger.log(this.id+":discontinuity detected"),o&&m.logger.log(this.id+":switch detected"),this.frag=e,i)i.postMessage({cmd:"demux",data:a,decryptdata:k,initSegment:b,audioCodec:c,videoCodec:d,timeOffset:j,discontinuity:n,trackSwitch:o,contiguous:q,duration:f,accurateTimeOffset:g,defaultInitPTS:h},[a]);else{var r=this.demuxer;r&&r.push(a,k,b,c,d,j,n,o,q,f,g,h)}}},{key:"onWorkerMessage",value:function(a){var b=a.data,c=this.hls;switch(b.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case h["default"].FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data2&&(b.data.data2=new Uint8Array(b.data2));default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}}}]),b}();c["default"]=q},{1:1,23:23,24:24,3:3,31:31,33:33,51:51}],26:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(51),g=function(){function a(b){d(this,a),this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}return e(a,[{key:"loadWord",value:function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e}},{key:"skipBits",value:function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)}},{key:"readBits",value:function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&f.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c}},{key:"skipLZ",value:function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var a=this.skipLZ();return this.readBits(a+1)-1}},{key:"readEG",value:function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(a){var b,c,d=8,e=8;for(b=0;a>b;b++)0!==e&&(c=this.readEG(),e=(d+c+256)%256),d=0===e?d:e}},{key:"readSPS",value:function(){var a,b,c,d,e,f,g,h,i,j=0,k=0,l=0,m=0,n=this.readUByte.bind(this),o=this.readBits.bind(this),p=this.readUEG.bind(this),q=this.readBoolean.bind(this),r=this.skipBits.bind(this),s=this.skipEG.bind(this),t=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);if(n(),a=n(),b=o(5),r(3),c=n(),t(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var v=p();if(3===v&&r(1),t(),t(),r(1),q())for(h=3!==v?8:12,i=0;h>i;i++)q()&&u(6>i?16:64)}t();var w=p();if(0===w)p();else if(1===w)for(r(1),s(),s(),d=p(),i=0;d>i;i++)s();t(),r(1),e=p(),f=p(),g=o(1),0===g&&r(1),r(1),q()&&(j=p(),k=p(),l=p(),m=p());var x=[1,1];if(q()&&q()){var y=n();switch(y){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[n()<<8|n(),n()<<8|n()]}}return{width:Math.ceil(16*(e+1)-2*j-2*k),height:(2-g)*(f+1)*16-(g?2:4)*(l+m),pixelRatio:x}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),a}();c["default"]=g},{51:51}],27:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(51),g=function(){function a(b){d(this,a),this._hasTimeStamp=!1;for(var c,e,g,h,i,j,k,l,m=0;;)if(k=this.readUTF(b,m,3),m+=3,"ID3"===k)m+=3,c=127&b[m++],e=127&b[m++],g=127&b[m++],h=127&b[m++],i=(c<<21)+(e<<14)+(g<<7)+h,j=m+i,this._parseID3Frames(b,m,j),m=j;else{if("3DI"!==k)return m-=3,l=m,void(l&&(this.hasTimeStamp||f.logger.warn("ID3 tag found, but no timestamp"),this._length=l,this._payload=b.subarray(0,l)));m+=7,f.logger.log("3DI footer found, end: "+m)}}return e(a,[{key:"readUTF",value:function(a,b,c){var d="",e=b,f=b+c;do d+=String.fromCharCode(a[e++]);while(f>e);return d}},{key:"_parseID3Frames",value:function(a,b,c){for(var d,e,g,h,i;c>=b+8;)switch(d=this.readUTF(a,b,4),b+=4,e=a[b++]<<24+a[b++]<<16+a[b++]<<8+a[b++],h=a[b++]<<8+a[b++],g=b,d){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(a,b,44)){b+=44,b+=4;var j=1&a[b++];this._hasTimeStamp=!0,i=((a[b++]<<23)+(a[b++]<<15)+(a[b++]<<7)+a[b++])/45,j&&(i+=47721858.84),i=Math.round(i),f.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),a}();c["default"]=g},{51:51}],28:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(33),h=d(g),i=function(){function a(b,c){e(this,a),this.observer=b,this.remuxer=c}return f(a,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(b,c,d,e){var f=this.initData=a.parseInitSegment(b),g={};f.audio&&(g.audio={container:"audio/mp4",codec:c,initSegment:b}),f.video&&(g.video={container:"video/mp4",codec:d,initSegment:b}),this.observer.trigger(h["default"].FRAG_PARSING_INIT_SEGMENT,{tracks:g})}},{key:"append",value:function(b,c,d,e){var f=this.initData,g=a.startDTS(f,b);this.remuxer.remux(f.audio,f.video,null,null,g,d,e,b)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(b){if(b.length>=8){var c=a.bin2str(b.subarray(4,8));return["moof","ftyp","styp"].indexOf(c)>=0}return!1}},{key:"bin2str",value:function(a){return String.fromCharCode.apply(null,a)}},{key:"findBox",value:function(b,c){var d,e,f,g,h,i=[];if(!c.length)return null;for(d=0;d<b.byteLength;)e=b[d]<<24,e|=b[d+1]<<16,e|=b[d+2]<<8,e|=b[d+3],f=a.bin2str(b.subarray(d+4,d+8)),g=e>1?d+e:b.byteLength,f===c[0]&&(1===c.length?i.push(b.subarray(d+8,g)):(h=a.findBox(b.subarray(d+8,g),c.slice(1)),h.length&&(i=i.concat(h)))),d=g;return i}},{key:"parseInitSegment",value:function(b){var c=[],d=a.findBox(b,["moov","trak"]);return d.forEach(function(b){var d=a.findBox(b,["tkhd"])[0];if(d){var e=d[0],f=0===e?12:20,g=d[f]<<24|d[f+1]<<16|d[f+2]<<8|d[f+3];g=0>g?4294967296+g:g;var h=a.findBox(b,["mdia","mdhd"])[0];if(h){e=h[0],f=0===e?12:20;var i=h[f]<<24|h[f+1]<<16|h[f+2]<<8|h[f+3],j=a.findBox(b,["mdia","hdlr"])[0];if(j){var k=a.bin2str(j.subarray(8,12)),l={soun:"audio",vide:"video"}[k];l&&(c[g]={timescale:i,type:l},c[l]={timescale:i,id:g})}}}}),c}},{key:"startDTS",value:function(b,c){var d,e,f;return d=a.findBox(c,["moof","traf"]),e=[].concat.apply([],d.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){var e,f,g;return e=d[4]<<24|d[5]<<16|d[6]<<8|d[7],f=b[e].timescale||9e4,g=a.findBox(c,["tfdt"]).map(function(a){var b,c;return b=a[0],c=a[4]<<24|a[5]<<16|a[6]<<8|a[7],1===b&&(c*=Math.pow(2,32),c+=a[8]<<24|a[9]<<16|a[10]<<8|a[11]),c})[0],g=g||1/0,g/f})})),f=Math.min.apply(null,e),isFinite(f)?f:0}}]),a}();c["default"]=i},{33:33}],29:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(19),h=d(g),i=function(){function a(b,c,d,f){e(this,a),this.decryptdata=d,this.discardEPB=f,this.decrypter=new h["default"](b,c)}return f(a,[{key:"decryptBuffer",value:function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)}},{key:"decryptAacSample",value:function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){f=new Uint8Array(f),e.set(f,16),d||h.decryptAacSamples(a,b+1,c)})}},{key:"decryptAacSamples",value:function(a,b,c){for(;;b++){if(b>=a.length)return void c();if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}}},{key:"getAvcEncryptedData",value:function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c}},{key:"getAvcDecryptedUnit",value:function(a,b){b=new Uint8Array(b);for(var c=0,d=32;d<=a.length-16;d+=160,c+=16)a.set(b.subarray(c,c+16),d);return a}},{key:"decryptAvcSample",value:function(a,b,c,d,e,f){var g=this.discardEPB(e.data),h=this.getAvcEncryptedData(g),i=this;this.decryptBuffer(h.buffer,function(h){e.data=i.getAvcDecryptedUnit(g,h),f||i.decryptAvcSamples(a,b,c+1,d)})}},{key:"decryptAvcSamples",value:function(a,b,c,d){for(;;b++,c=0){if(b>=a.length)return void d();for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.length<=48||1!==f.type&&5!==f.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}}}]),a}();c["default"]=i},{19:19}],30:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),
d&&a(b,d),b}}(),g=a(22),h=d(g),i=a(33),j=d(i),k=a(26),l=d(k),m=a(29),n=d(m),o=a(51),p=a(31),q=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.config=d,this.typeSupported=f,this.remuxer=c,this.sampleAes=null}return f(a,[{key:"setDecryptData",value:function(a){null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?this.sampleAes=new n["default"](this.observer,this.config,a,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(a,b,c,d){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=b,this.videoCodec=c,this._duration=d}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(a,b,c,d){var e,f,g,h,i,k,l=a.length,m=!1;this.contiguous=c;var n=this.pmtParsed,q=this._avcTrack,r=this._audioTrack,s=this._id3Track,t=q.id,u=r.id,v=s.id,w=this._pmtId,x=q.pesData,y=r.pesData,z=s.pesData,A=this._parsePAT,B=this._parsePMT,C=this._parsePES,D=this._parseAVCPES.bind(this),E=this._parseAACPES.bind(this),F=this._parseMPEGPES.bind(this),G=this._parseID3PES.bind(this);for(l-=l%188,e=0;l>e;e+=188)if(71===a[e]){if(f=!!(64&a[e+1]),g=((31&a[e+1])<<8)+a[e+2],h=(48&a[e+3])>>4,h>1){if(i=e+5+a[e+4],i===e+188)continue}else i=e+4;switch(g){case t:f&&(x&&(k=C(x))&&D(k,!1),x={data:[],size:0}),x&&(x.data.push(a.subarray(i,e+188)),x.size+=e+188-i);break;case u:f&&(y&&(k=C(y))&&(r.isAAC?E(k):F(k)),y={data:[],size:0}),y&&(y.data.push(a.subarray(i,e+188)),y.size+=e+188-i);break;case v:f&&(z&&(k=C(z))&&G(k),z={data:[],size:0}),z&&(z.data.push(a.subarray(i,e+188)),z.size+=e+188-i);break;case 0:f&&(i+=a[i]+1),w=this._pmtId=A(a,i);break;case w:f&&(i+=a[i]+1);var H=B(a,i,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,null!=this.sampleAes);t=H.avc,t>0&&(q.id=t),u=H.audio,u>0&&(r.id=u,r.isAAC=H.isAAC),v=H.id3,v>0&&(s.id=v),m&&!n&&(o.logger.log("reparse from beginning"),m=!1,e=-188),n=this.pmtParsed=!0;break;case 17:case 8191:break;default:m=!0}}else this.observer.trigger(j["default"].ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});x&&(k=C(x))?(D(k,!0),q.pesData=null):q.pesData=x,y&&(k=C(y))?(r.isAAC?E(k):F(k),r.pesData=null):(y&&y.size&&o.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=y),z&&(k=C(z))?(G(k),s.pesData=null):s.pesData=z,null==this.sampleAes?this.remuxer.remux(r,q,s,this._txtTrack,b,c,d):this.decryptAndRemux(r,q,s,this._txtTrack,b,c,d)}},{key:"decryptAndRemux",value:function(a,b,c,d,e,f,g){if(a.samples&&a.isAAC){var h=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){h.decryptAndRemuxAvc(a,b,c,d,e,f,g)})}else this.decryptAndRemuxAvc(a,b,c,d,e,f,g)}},{key:"decryptAndRemuxAvc",value:function(a,b,c,d,e,f,g){if(b.samples){var h=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){h.remuxer.remux(a,b,c,d,e,f,g)})}else this.remuxer.remux(a,b,c,d,e,f,g)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(a,b){return(31&a[b+10])<<8|a[b+11]}},{key:"_parsePMT",value:function(a,b,c,d){var e,f,g,h,i={audio:-1,avc:-1,id3:-1,isAAC:!0};for(e=(15&a[b+1])<<8|a[b+2],f=b+3+e-4,g=(15&a[b+10])<<8|a[b+11],b+=12+g;f>b;){switch(h=(31&a[b+1])<<8|a[b+2],a[b]){case 207:if(!d){o.logger.log("unkown stream type:"+a[b]);break}case 15:-1===i.audio&&(i.audio=h);break;case 21:-1===i.id3&&(i.id3=h);break;case 219:if(!d){o.logger.log("unkown stream type:"+a[b]);break}case 27:-1===i.avc&&(i.avc=h);break;case 3:case 4:c?-1===i.audio&&(i.audio=h,i.isAAC=!1):o.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:o.logger.warn("HEVC stream type found, not supported for now");break;default:o.logger.log("unkown stream type:"+a[b])}b+=((15&a[b+3])<<8|a[b+4])+5}return i}},{key:"_parsePES",value:function(a){var b,c,d,e,f,g,h,i,j,k=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;){var m=new Uint8Array(l[0].length+l[1].length);m.set(l[0]),m.set(l[1],l[0].length),l[0]=m,l.splice(1,1)}if(b=l[0],d=(b[0]<<16)+(b[1]<<8)+b[2],1===d){if(e=(b[4]<<8)+b[5],e&&e>a.size-6)return null;c=b[7],192&c&&(h=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,h>4294967295&&(h-=8589934592),64&c?(i=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,i>4294967295&&(i-=8589934592),h-i>54e5&&(o.logger.warn(Math.round((h-i)/9e4)+"s delta between PTS and DTS, align them"),h=i)):i=h),f=b[8],j=f+9,a.size-=j,g=new Uint8Array(a.size);for(var n=0,p=l.length;p>n;n++){b=l[n];var q=b.byteLength;if(j){if(j>q){j-=q;continue}b=b.subarray(j),q-=j,j=0}g.set(b,k),k+=q}return e&&(e-=f+3),{data:g,pts:h,dts:i,len:e}}return null}},{key:"pushAccesUnit",value:function(a,b){if(a.units.length&&a.frame){var c=b.samples,d=c.length;!this.config.forceKeyFrameOnDiscontinuity||a.key===!0||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++}a.debug.length&&o.logger.log(a.pts+"/"+a.dts+":"+a.debug)}},{key:"_parseAVCPES",value:function(a,b){var c,d,e,f=this,g=this._avcTrack,h=this._parseAVCNALu(a.data),i=!1,j=this.avcSample;a.data=null,h.forEach(function(b){switch(b.type){case 1:d=!0,i&&j&&(j.debug+="NDR "),j.frame=!0;var h=b.data;if(h.length>4){var k=new l["default"](h).readSliceType();(2===k||4===k||7===k||9===k)&&(j.key=!0)}break;case 5:d=!0,j||(j=f.avcSample=f._createAVCSample(!0,a.pts,a.dts,"")),i&&(j.debug+="IDR "),j.key=!0,j.frame=!0;break;case 6:d=!0,i&&j&&(j.debug+="SEI "),c=new l["default"](f.discardEPB(b.data)),c.readUByte();for(var m=0,n=0,o=!1,p=0;!o&&c.bytesAvailable>1;){m=0;do p=c.readUByte(),m+=p;while(255===p);n=0;do p=c.readUByte(),n+=p;while(255===p);if(4===m&&0!==c.bytesAvailable){o=!0;var q=c.readUByte();if(181===q){var r=c.readUShort();if(49===r){var s=c.readUInt();if(1195456820===s){var t=c.readUByte();if(3===t){var u=c.readUByte(),v=c.readUByte(),w=31&u,x=[u,v];for(e=0;w>e;e++)x.push(c.readUByte()),x.push(c.readUByte()),x.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:x})}}}}}else if(n<c.bytesAvailable)for(e=0;n>e;e++)c.readUByte()}break;case 7:if(d=!0,i&&j&&(j.debug+="SPS "),!g.sps){c=new l["default"](b.data);var y=c.readSPS();g.width=y.width,g.height=y.height,g.pixelRatio=y.pixelRatio,g.sps=[b.data],g.duration=f._duration;var z=b.data.subarray(1,4),A="avc1.";for(e=0;3>e;e++){var B=z[e].toString(16);B.length<2&&(B="0"+B),A+=B}g.codec=A}break;case 8:d=!0,i&&j&&(j.debug+="PPS "),g.pps||(g.pps=[b.data]);break;case 9:d=!1,j&&f.pushAccesUnit(j,g),j=f.avcSample=f._createAVCSample(!1,a.pts,a.dts,i?"AUD ":"");break;case 12:d=!1;break;default:d=!1,j&&(j.debug+="unknown NAL "+b.type+" ")}if(j&&d){var C=j.units;C.push(b)}}),b&&j&&(this.pushAccesUnit(j,g),this.avcSample=null)}},{key:"_createAVCSample",value:function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}}},{key:"_insertSampleInOrder",value:function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)}},{key:"_getLastNalUnit",value:function(){var a=this.avcSample,b=void 0;if(!a||0===a.units.length){var c=this._avcTrack,d=c.samples;a=d[d.length-1]}if(a){var e=a.units;b=e[e.length-1]}return b}},{key:"_parseAVCNALu",value:function(a){var b,c,d,e,f,g=0,h=a.byteLength,i=this._avcTrack,j=i.naluState||0,k=j,l=[],m=-1;for(-1===j&&(m=0,f=31&a[0],j=0,g=1);h>g;)if(b=a[g++],j)if(1!==j)if(b)if(1===b){if(m>=0)d={data:a.subarray(m,g-j-1),type:f},l.push(d);else{var n=this._getLastNalUnit();if(n&&(k&&4-k>=g&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-k)),c=g-j-1,c>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}h>g?(e=31&a[g],m=g,f=e,j=0):j=-1}else j=0;else j=3;else j=b?0:2;else j=b?0:1;if(m>=0&&j>=0&&(d={data:a.subarray(m,h),type:f,state:j},l.push(d)),0===l.length){var p=this._getLastNalUnit();if(p){var q=new Uint8Array(p.data.byteLength+a.byteLength);q.set(p.data,0),q.set(a,p.data.byteLength),p.data=q}}return i.naluState=j,l}},{key:"discardEPB",value:function(a){for(var b,c,d=a.byteLength,e=[],f=1;d-2>f;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;b>f;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c}},{key:"_parseAACPES",value:function(a){var b,c,d,e,f,g,i,k,l,m=this._audioTrack,n=a.data,q=a.pts,r=0,s=this.aacOverFlow,t=this.aacLastPTS;if(s){var u=new Uint8Array(s.byteLength+n.byteLength);u.set(s,0),u.set(n,s.byteLength),n=u}for(f=r,k=n.length;k-1>f&&(255!==n[f]||240!==(240&n[f+1]));f++);if(f){var v,w;if(k-1>f?(v="AAC PES did not start with ADTS header,offset:"+f,w=!1):(v="no ADTS header found in AAC PES",w=!0),o.logger.warn("parsing error:"+v),this.observer.trigger(j["default"].ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:w,reason:v}),w)return}if(!m.samplerate){var x=this.audioCodec;b=h["default"].getAudioConfig(this.observer,n,f,x),m.config=b.config,m.samplerate=b.samplerate,m.channelCount=b.channelCount,m.codec=b.codec,m.manifestCodec=b.manifestCodec,m.duration=this._duration,o.logger.log("parsed codec:"+m.codec+",rate:"+b.samplerate+",nb channel:"+b.channelCount)}if(e=0,d=9216e4/m.samplerate,s&&t){var y=t+d;Math.abs(y-q)>1&&(o.logger.log("AAC: align PTS for overlapping frames by "+Math.round((y-q)/90)),q=y)}for(;k>f+5&&(g=1&n[f+1]?7:9,c=(3&n[f+3])<<11|n[f+4]<<3|(224&n[f+5])>>>5,c-=g,c>0&&k>=f+g+c);)for(i=q+e*d,l={unit:n.subarray(f+g,f+g+c),pts:i,dts:i},m.samples.push(l),m.len+=c,f+=c+g,e++;k-1>f&&(255!==n[f]||240!==(240&n[f+1]));f++);s=k>f?n.subarray(f,k):null,this.aacOverFlow=s,this.aacLastPTS=i}},{key:"_parseMPEGPES",value:function(a){for(var b,c=a.data,d=a.pts,e=c.length,f=0,g=0;e>g&&(b=this._parseMpeg(c,g,e,f++,d))>0;)g+=b}},{key:"_onMpegFrame",value:function(a,b,c,d,e,f){var g=1152/c*1e3,h=f+e*g,i=this._audioTrack;i.config=[],i.channelCount=d,i.samplerate=c,i.duration=this._duration,i.samples.push({unit:a,pts:h,dts:h}),i.len+=a.length}},{key:"_onMpegNoise",value:function(a){o.logger.warn("mpeg audio has noise: "+a.length+" bytes")}},{key:"_parseMpeg",value:function(a,b,c,d,e){var f=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],g=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(b+2>c)return-1;if(255===a[b]||224===(224&a[b+1])){if(b+24>c)return-1;var h=a[b+1]>>3&3,i=a[b+1]>>1&3,j=a[b+2]>>4&15,k=a[b+2]>>2&3,l=!!(2&a[b+2]);if(1!==h&&0!==j&&15!==j&&3!==k){var m=3===h?3-i:3===i?3:4,n=1e3*f[14*m+j-1],o=3===h?0:2===h?1:2,p=g[3*o+k],q=l?1:0,r=a[b+3]>>6===3?1:2,s=3===i?(3===h?12:6)*n/p+q<<2:(3===h?144:72)*n/p+q|0;return b+s>c?-1:(this._onMpegFrame&&this._onMpegFrame(a.subarray(b,b+s),n,p,r,d,e),s)}}for(var t=b+2;c>t;){if(255===a[t-1]&&224===(224&a[t]))return this._onMpegNoise&&this._onMpegNoise(a.subarray(b,t-1)),t-b-1;t++}return-1}},{key:"_parseID3PES",value:function(a){this._id3Track.samples.push(a)}}],[{key:"probe",value:function(a){return a.length>=564&&71===a[0]&&71===a[188]&&71===a[376]?!0:!1}}]),a}();c["default"]=q},{22:22,26:26,29:29,31:31,33:33,51:51}],31:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},c.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],32:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a(51),i=a(31),j=a(33),k=d(j),l=function(){function a(b){e(this,a),this.hls=b,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;c>f;f++)d[f-1]=arguments[f];this.handledEvents=d,this.useGenericHandler=!0,this.registerListeners()}return g(a,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===f(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if("hlsEventGeneric"===a)throw new Error("Forbidden event name: "+a);this.hls.on(a,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(a,b){this.onEventGeneric(a,b)}},{key:"onEventGeneric",value:function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)};try{c.call(this,a,b).call()}catch(d){h.logger.error("internal error happened while processing "+a+":"+d.message),this.hls.trigger(k["default"].ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:d})}}}]),a}();c["default"]=l},{31:31,33:33,51:51}],33:[function(a,b,c){"use strict";b.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],34:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"getSilentFrame",value:function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),a}();c["default"]=f},{}],35:[function(a,b,c){"use strict";var d={isBuffered:function(a,b){if(a)for(var c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0;return!1},bufferInfo:function(a,b,c){if(a){var d,e=a.buffered,f=[];for(d=0;d<e.length;d++)f.push({start:e.start(d),end:e.end(d)});return this.bufferedInfo(f,b,c)}return{len:0,start:b,end:b,nextStart:void 0}},bufferedInfo:function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;return c?c:b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&m>b)e=l,f=m,d=f-b;else if(l>b+c){g=l;break}}return{len:d,start:e,end:f,nextStart:g}}};b.exports=d},{}],36:[function(a,b,c){"use strict";var d=a(51),e={mergeDetails:function(a,b){var c,f=Math.max(a.startSN,b.startSN)-b.startSN,g=Math.min(a.endSN,b.endSN)-b.startSN,h=b.startSN-a.startSN,i=a.fragments,j=b.fragments,k=0;if(f>g)return void(b.PTSKnown=!1);for(var l=f;g>=l;l++){var m=i[h+l],n=j[l];n&&m&&(k=m.cc-n.cc,isNaN(m.startPTS)||(n.start=n.startPTS=m.startPTS,n.endPTS=m.endPTS,n.duration=m.duration,c=n))}if(k)for(d.logger.log("discontinuity sliding from playlist, take drift into account"),l=0;l<j.length;l++)j[l].cc+=k;if(c)e.updateFragPTSDTS(b,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS);else if(h>=0&&h<i.length){var o=i[h].start;for(l=0;l<j.length;l++)j[l].start+=o}b.PTSKnown=a.PTSKnown},updateFragPTSDTS:function(a,b,c,d,f,g){if(!isNaN(b.startPTS)){var h=Math.abs(b.startPTS-c);isNaN(b.deltaPTS)?b.deltaPTS=h:b.deltaPTS=Math.max(h,b.deltaPTS),c=Math.min(c,b.startPTS),d=Math.max(d,b.endPTS),f=Math.min(f,b.startDTS),g=Math.max(g,b.endDTS)}var i=c-b.start;b.start=b.startPTS=c,b.endPTS=d,b.startDTS=f,b.endDTS=g,b.duration=d-c;var j=b.sn;if(!a||j<a.startSN||j>a.endSN)return 0;var k,l,m;for(k=j-a.startSN,l=a.fragments,b=l[k],m=k;m>0;m--)e.updatePTS(l,m,m-1);for(m=k;m<l.length-1;m++)e.updatePTS(l,m,m+1);return a.PTSKnown=!0,i},updatePTS:function(a,b,c){var e=a[b],f=a[c],g=f.startPTS;isNaN(g)?c>b?f.start=e.start+e.duration:f.start=Math.max(e.start-f.duration,0):c>b?(e.duration=g-e.start,e.duration<0&&d.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!")):(f.duration=e.start-g,f.duration<0&&d.logger.warn("negative duration computed for frag "+f.sn+",level "+f.level+", there should be some duration drift between playlist and fragment!"))}};b.exports=e},{51:51}],37:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(2),h=d(g),i=a(33),j=d(i),k=a(31),l=a(41),m=d(l),n=a(39),o=d(n),p=a(40),q=d(p),r=a(13),s=d(r),t=a(12),u=d(t),v=a(11),w=d(v),x=a(51),y=a(1),z=d(y),A=a(4),B=function(){function a(){var b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,a);var d=a.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var f in d)f in c||(c[f]=d[f]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');x.enableLogs(c.debug),this.config=c,this._autoLevelCapping=-1;var g=this.observer=new z["default"];g.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];g.emit.apply(g,[a,a].concat(c))},g.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];g.removeListener.apply(g,[a].concat(c))},this.on=g.on.bind(g),this.off=g.off.bind(g),this.trigger=g.trigger.bind(g);var h=this.abrController=new c.abrController(this),i=new c.bufferController(this),j=new c.capLevelController(this),k=new c.fpsController(this),l=new m["default"](this),n=new o["default"](this),p=new q["default"](this),r=new w["default"](this),t=this.levelController=new u["default"](this),v=this.streamController=new s["default"](this),y=[t,v],A=c.audioStreamController;A&&y.push(new A(this)),this.networkControllers=y;var B=[l,n,p,h,i,j,k,r];if(A=c.audioTrackController){var C=new A(this);this.audioTrackController=C,B.push(C)}if(A=c.subtitleTrackController){var D=new A(this);this.subtitleTrackController=D,B.push(D)}[c.subtitleStreamController,c.timelineController].forEach(function(a){a&&B.push(new a(b))}),this.coreComponents=B}return f(a,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.7.6"}},{key:"Events",get:function(){return j["default"]}},{key:"ErrorTypes",get:function(){return k.ErrorTypes}},{key:"ErrorDetails",get:function(){return k.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:A.hlsDefaultConfig},set:function(b){a.defaultConfig=b}}]),f(a,[{key:"destroy",value:function(){x.logger.log("destroy"),this.trigger(j["default"].DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(a){x.logger.log("attachMedia"),this.media=a,this.trigger(j["default"].MEDIA_ATTACHING,{media:a})}},{key:"detachMedia",value:function(){x.logger.log("detachMedia"),this.trigger(j["default"].MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(a){a=h["default"].buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0}),x.logger.log("loadSource:"+a),this.url=a,this.trigger(j["default"].MANIFEST_LOADING,{url:a})}},{key:"startLoad",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;x.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})}},{key:"stopLoad",value:function(){x.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})}},{key:"swapAudioCodec",value:function(){x.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){x.logger.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){x.logger.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){x.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){x.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){x.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){x.logger.log("set startLevel:"+a);var b=this;-1!==a&&(a=Math.max(a,b.minAutoLevel)),b.levelController.startLevel=a}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){x.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var a=this,b=a.levels,c=a.config.minAutoBitrate,d=b?b.length:0,e=0;d>e;e++){var f=b[e].realBitrate?Math.max(b[e].realBitrate,b[e].bitrate):b[e].bitrate;if(f>c)return e}return 0}},{key:"maxAutoLevel",get:function(){var a=this,b=a.levels,c=a.autoLevelCapping,d=void 0;return d=-1===c&&b&&b.length?b.length-1:c}},{key:"nextAutoLevel",get:function(){var a=this;return Math.min(Math.max(a.abrController.nextAutoLevel,a.minAutoLevel),a.maxAutoLevel)},set:function(a){var b=this;b.abrController.nextAutoLevel=Math.max(b.minAutoLevel,a)}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)}}]),a}();c["default"]=B},{1:1,11:11,12:12,13:13,2:2,31:31,33:33,39:39,4:4,40:40,41:41,51:51}],38:[function(a,b,c){"use strict";b.exports=a(37)["default"]},{37:37}],39:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=a(31),n=a(51),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].FRAG_LOADING));return c.loaders={},c}return g(b,a),h(b,[{key:"destroy",value:function(){var a=this.loaders;for(var b in a){var c=a[b];c&&c.destroy()}this.loaders={},l["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=this.hls.config;b.loaded=0,d&&(n.logger.warn("abort previous fragment loader for type:"+c),d.abort()),d=this.loaders[c]=b.loader="undefined"!=typeof e.fLoader?new e.fLoader(e):new e.loader(e);var f=void 0,g=void 0,h=void 0;f={url:b.url,frag:b,responseType:"arraybuffer",progressData:!1};var i=b.byteRangeStartOffset,j=b.byteRangeEndOffset;isNaN(i)||isNaN(j)||(f.rangeStart=i,f.rangeEnd=j),g={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(f,g,h)}},{key:"loadsuccess",value:function(a,b,c){var d=a.data,e=c.frag;e.loader=void 0,this.loaders[e.type]=void 0,this.hls.trigger(j["default"].FRAG_LOADED,{payload:d,frag:e,stats:b})}},{key:"loaderror",value:function(a,b){var c=b.loader;c&&c.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.loader;c&&c.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag})}},{key:"loadprogress",value:function(a,b,c){var d=b.frag;d.loaded=a.loaded,this.hls.trigger(j["default"].FRAG_LOAD_PROGRESS,{frag:d,stats:a})}}]),b}(l["default"]);c["default"]=o},{31:31,32:32,33:33,51:51}],40:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(33),j=d(i),k=a(32),l=d(k),m=a(31),n=a(51),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].KEY_LOADING));return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return g(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},l["default"].prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=b.decryptdata,f=e.uri;if(f!==this.decrypturl||null===this.decryptkey){var g=this.hls.config;d&&(n.logger.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new g.loader(g),this.decrypturl=f,this.decryptkey=null;var h=void 0,i=void 0,k=void 0;h={url:f,frag:b,responseType:"arraybuffer"},i={timeout:g.fragLoadingTimeOut,maxRetry:g.fragLoadingMaxRetry,retryDelay:g.fragLoadingRetryDelay,maxRetryDelay:g.fragLoadingMaxRetryTimeout},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(h,i,k)}else this.decryptkey&&(e.key=this.decryptkey,this.hls.trigger(j["default"].KEY_LOADED,{frag:b}))}},{key:"loadsuccess",value:function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(j["default"].KEY_LOADED,{frag:d})}},{key:"loaderror",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})}}]),b}(l["default"]);c["default"]=o},{31:31,32:32,33:33,51:51}],41:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(2),j=d(i),k=a(33),l=d(k),m=a(32),n=d(m),o=a(31),p=a(45),q=d(p),r=a(51),s=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,t=/#EXT-X-MEDIA:(.*)/g,u=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,v=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,w=function(){function a(){g(this,a),this.method=null,this.key=null,this.iv=null,this._uri=null}return h(a,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=j["default"].buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),a}(),x=function(){function a(){g(this,a),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return h(a,[{key:"createInitializationVector",value:function(a){for(var b=new Uint8Array(16),c=12;16>c;c++)b[c]=a>>8*(15-c)&255;return b}},{key:"fragmentDecryptdataFromLevelkey",value:function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=new w,c.method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c}},{key:"cloneObj",value:function(a){return JSON.parse(JSON.stringify(a))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=j["default"].buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var a=this._byteRange=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(1===b.length){var c=this.lastByteRangeEndOffset;a[0]=c?c:0}else a[0]=parseInt(b[1]);a[1]=parseInt(b[0])+a[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),a}(),y=function(a){function b(a){g(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,l["default"].MANIFEST_LOADING,l["default"].LEVEL_LOADING,l["default"].AUDIO_TRACK_LOADING,l["default"].SUBTITLE_TRACK_LOADING));return c.loaders={},c}return f(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},n["default"].prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(a){this.load(a.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(a){this.load(a.url,{type:"level",level:a.level,id:a.id})}},{key:"onAudioTrackLoading",value:function(a){this.load(a.url,{type:"audioTrack",id:a.id})}},{key:"onSubtitleTrackLoading",value:function(a){this.load(a.url,{type:"subtitleTrack",id:a.id})}},{key:"load",value:function(a,b){var c=this.loaders[b.type];if(c){var d=c.context;if(d&&d.url===a)return void r.logger.trace("playlist request ongoing");r.logger.warn("abort previous loader for type:"+b.type),c.abort()}var e=this.hls.config,f=void 0,g=void 0,h=void 0,i=void 0;"manifest"===b.type?(f=e.manifestLoadingMaxRetry,g=e.manifestLoadingTimeOut,h=e.manifestLoadingRetryDelay,i=e.manifestLoadingMaxRetryTimeout):(f=e.levelLoadingMaxRetry,g=e.levelLoadingTimeOut,h=e.levelLoadingRetryDelay,i=e.levelLoadingMaxRetryTimeout,r.logger.log("loading playlist for "+b.type+" "+(b.level||b.id))),c=this.loaders[b.type]=b.loader="undefined"!=typeof e.pLoader?new e.pLoader(e):new e.loader(e),b.url=a,b.responseType="";var j=void 0,k=void 0;j={timeout:g,maxRetry:f,retryDelay:h,maxRetryDelay:i},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},c.load(b,j,k)}},{key:"resolve",value:function(a,b){return j["default"].buildAbsoluteURL(b,a,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(a,b){var c=[],d=void 0;for(s.lastIndex=0;null!=(d=s.exec(a));){var e={},f=e.attrs=new q["default"](d[1]);e.url=this.resolve(d[2],b);var g=f.decimalResolution("RESOLUTION");g&&(e.width=g.width,e.height=g.height),e.bitrate=f.decimalInteger("AVERAGE-BANDWIDTH")||f.decimalInteger("BANDWIDTH"),e.name=f.NAME;var h=f.CODECS;if(h){h=h.split(/[ ,]+/);for(var i=0;i<h.length;i++){var j=h[i];-1!==j.indexOf("avc1")?e.videoCodec=this.avc1toavcoti(j):e.audioCodec=j}}c.push(e)}return c}},{key:"parseMasterPlaylistMedia",value:function(a,b,c){var d=void 0,e=[],f=0;for(t.lastIndex=0;null!=(d=t.exec(a));){var g={},h=new q["default"](d[1]);h.TYPE===c&&(g.groupId=h["GROUP-ID"],g.name=h.NAME,g.type=c,g["default"]="YES"===h.DEFAULT,g.autoselect="YES"===h.AUTOSELECT,g.forced="YES"===h.FORCED,h.URI&&(g.url=this.resolve(h.URI,b)),g.lang=h.LANGUAGE,g.name||(g.name=g.lang),g.id=f++,e.push(g))}return e}},{key:"avc1toavcoti",value:function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b}},{key:"parseLevelPlaylist",value:function(a,b,c,d){var e,f,g=0,h=0,i={type:null,version:null,url:b,fragments:[],live:!0,startSN:0},j=new w,k=0,l=null,m=new x;for(u.lastIndex=0;null!==(e=u.exec(a));){var n=e[1];if(n){m.duration=parseFloat(n);var o=(" "+e[2]).slice(1);m.title=o?o:null,m.tagList.push(o?["INF",n,o]:["INF",n])}else if(e[3]){if(!isNaN(m.duration)){var p=g++;m.type=d,m.start=h,m.levelkey=j,m.sn=p,m.level=c,m.cc=k,m.baseurl=b,m.relurl=(" "+e[3]).slice(1),i.fragments.push(m),l=m,h+=m.duration,m=new x}}else if(e[4]){if(m.rawByteRange=(" "+e[4]).slice(1),l){var s=l.byteRangeEndOffset;s&&(m.lastByteRangeEndOffset=s)}}else if(e[5])m.rawProgramDateTime=(" "+e[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]);else{for(e=e[0].match(v),f=1;f<e.length&&void 0===e[f];f++);var t=(" "+e[f+1]).slice(1),y=(" "+e[f+2]).slice(1);switch(e[f]){case"#":m.tagList.push(y?[t,y]:[t]);break;case"PLAYLIST-TYPE":i.type=t.toUpperCase();break;case"MEDIA-SEQUENCE":g=i.startSN=parseInt(t);break;case"TARGETDURATION":i.targetduration=parseFloat(t);break;case"VERSION":i.version=parseInt(t);break;case"EXTM3U":break;case"ENDLIST":i.live=!1;break;case"DIS":k++,m.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":k=parseInt(t);break;case"KEY":var z=t,A=new q["default"](z),B=A.enumeratedString("METHOD"),C=A.URI,D=A.hexadecimalInteger("IV");B&&(j=new w,C&&["AES-128","SAMPLE-AES"].indexOf(B)>=0&&(j.method=B,j.baseuri=b,j.reluri=C,j.key=null,j.iv=D));break;case"START":var E=t,F=new q["default"](E),G=F.decimalFloatingPoint("TIME-OFFSET");isNaN(G)||(i.startTimeOffset=G);break;case"MAP":var H=new q["default"](t);m.relurl=H.URI,m.rawByteRange=H.BYTERANGE,m.baseurl=b,m.level=c,m.type=d,m.sn="initSegment",i.initSegment=m,m=new x;break;default:r.logger.warn("line parsed but not handled: "+e)}}}return m=l,m&&!m.relurl&&(i.fragments.pop(),h-=m.duration),i.totalduration=h,i.averagetargetduration=h/i.fragments.length,i.endSN=g-1,i}},{key:"loadsuccess",value:function(a,b,c){var d=a.data,e=a.url,f=c.type,g=c.id,h=c.level,i=this.hls;if(this.loaders[f]=void 0,(void 0===e||0===e.indexOf("data:"))&&(e=c.url),b.tload=performance.now(),0===d.indexOf("#EXTM3U"))if(d.indexOf("#EXTINF:")>0){var j="audioTrack"!==f&&"subtitleTrack"!==f,k=isNaN(h)?isNaN(g)?0:g:h,m=this.parseLevelPlaylist(d,e,k,"audioTrack"===f?"audio":"subtitleTrack"===f?"subtitle":"main");m.tload=b.tload,"manifest"===f&&i.trigger(l["default"].MANIFEST_LOADED,{levels:[{url:e,details:m}],audioTracks:[],url:e,stats:b}),b.tparsed=performance.now(),m.targetduration?j?i.trigger(l["default"].LEVEL_LOADED,{details:m,level:h||0,id:g||0,stats:b}):"audioTrack"===f?i.trigger(l["default"].AUDIO_TRACK_LOADED,{details:m,id:g,stats:b}):"subtitleTrack"===f&&i.trigger(l["default"].SUBTITLE_TRACK_LOADED,{details:m,id:g,stats:b}):i.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"invalid targetduration"})}else{var n=this.parseMasterPlaylist(d,e);if(n.length){var p=this.parseMasterPlaylistMedia(d,e,"AUDIO"),q=this.parseMasterPlaylistMedia(d,e,"SUBTITLES");if(p.length){var s=!1;p.forEach(function(a){a.url||(s=!0)}),s===!1&&n[0].audioCodec&&!n[0].attrs.AUDIO&&(r.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main"}))}i.trigger(l["default"].MANIFEST_LOADED,{levels:n,audioTracks:p,subtitles:q,url:e,stats:b})}else i.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"no level found in manifest"})}else i.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(a,b){var c,d,e=b.loader;switch(b.type){case"manifest":c=o.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case"level":c=o.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case"audioTrack":c=o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1}e&&(e.abort(),this.loaders[b.type]=void 0),this.hls.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:e,response:a,context:b})}},{key:"loadtimeout",value:function(a,b){var c,d,e=b.loader;switch(b.type){case"manifest":c=o.ErrorDetails.MANIFEST_LOAD_TIMEOUT,d=!0;break;case"level":c=o.ErrorDetails.LEVEL_LOAD_TIMEOUT,d=!1;break;case"audioTrack":c=o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,d=!1}e&&(e.abort(),this.loaders[b.type]=void 0),this.hls.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:e,context:b})}}]),b}(n["default"]);c["default"]=y},{2:2,31:31,32:32,33:33,45:45,51:51}],42:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=Math.pow(2,32)-1,g=function(){function a(){d(this,a)}return e(a,null,[{key:"init",value:function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))}},{key:"box",value:function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(b=new Uint8Array(d),b[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;f>e;e++)b.set(c[e],d),d+=c[e].byteLength;return b}},{key:"hdlr",value:function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])}},{key:"mdat",value:function(b){return a.box(a.types.mdat,b)}},{key:"mdhd",value:function(b,c){c*=b;var d=Math.floor(c/(f+1)),e=Math.floor(c%(f+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))}},{key:"mdia",value:function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))}},{key:"mfhd",value:function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))}},{key:"minf",value:function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))}},{key:"moof",value:function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))}},{key:"moov",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))}},{key:"mvex",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))}},{key:"mvhd",value:function(b,c){c*=b;var d=Math.floor(c/(f+1)),e=Math.floor(c%(f+1)),g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,g)}},{key:"sdtp",value:function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)}},{key:"stbl",value:function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))}},{key:"avc1",value:function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))}},{key:"esds",value:function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))}},{key:"mp4a",value:function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))}},{key:"mp3",value:function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))}},{key:"stsd",value:function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))}},{key:"tkhd",value:function(b){var c=b.id,d=b.duration*b.timescale,e=b.width,g=b.height,h=Math.floor(d/(f+1)),i=Math.floor(d%(f+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,g>>8&255,255&g,0,0]))}},{key:"traf",value:function(b,c){var d=a.sdtp(b),e=b.id,g=Math.floor(c/(f+1)),h=Math.floor(c%(f+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h])),a.trun(b,d.length+16+20+8+16+8+8),d)}},{key:"trak",value:function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))}},{key:"trex",value:function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;k>d;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)}},{key:"initSegment",value:function(b){a.types||a.init();var c,d=a.moov(b);return c=new Uint8Array(a.FTYP.byteLength+d.byteLength),c.set(a.FTYP),c.set(d,a.FTYP.byteLength),c}}]),a}();c["default"]=g},{}],43:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(34),h=d(g),i=a(33),j=d(i),k=a(51),l=a(42),m=d(l),n=a(31),o=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.config=c,this.typeSupported=d;var g=navigator.userAgent;this.isSafari=f&&f.indexOf("Apple")>-1&&g&&!g.match("CriOS"),this.ISGenerated=!1}return f(a,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(a){this._initPTS=this._initDTS=a}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(a,b,c,d,e,f,g){if(this.ISGenerated||this.generateIS(a,b,e),this.ISGenerated)if(a.samples.length){a.timescale||(k.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e));var h=this.remuxAudio(a,e,f,g);if(b.samples.length){var i=void 0;h&&(i=h.endPTS-h.startPTS),b.timescale||(k.logger.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e)),this.remuxVideo(b,e,f,i)}}else{var l=void 0;b.samples.length&&(l=this.remuxVideo(b,e,f)),l&&a.codec&&this.remuxEmptyAudio(a,e,f,l)}c.samples.length&&this.remuxID3(c,e),d.samples.length&&this.remuxText(d,e),this.observer.trigger(j["default"].FRAG_PARSED)}},{key:"generateIS",value:function(a,b,c){var d,e,f=this.observer,g=a.samples,h=b.samples,i=this.typeSupported,l="audio/mp4",o={},p={tracks:o},q=void 0===this._initPTS;if(q&&(d=e=1/0),a.config&&g.length&&(a.timescale=a.samplerate,k.logger.log("audio sampling rate : "+a.samplerate),a.isAAC||(i.mpeg?(l="audio/mpeg",a.codec=""):i.mp3&&(a.codec="mp3")),o.audio={container:l,codec:a.codec,initSegment:!a.isAAC&&i.mpeg?new Uint8Array:m["default"].initSegment([a]),metadata:{channelCount:a.channelCount}},q&&(d=e=g[0].pts-a.inputTimeScale*c)),b.sps&&b.pps&&h.length){var r=b.inputTimeScale;b.timescale=r,o.video={container:"video/mp4",codec:b.codec,initSegment:m["default"].initSegment([b]),metadata:{width:b.width,height:b.height}},q&&(d=Math.min(d,h[0].pts-r*c),e=Math.min(e,h[0].dts-r*c),this.observer.trigger(j["default"].INIT_PTS_FOUND,{initPTS:d}))}Object.keys(o).length?(f.trigger(j["default"].FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,q&&(this._initPTS=d,this._initDTS=e)):f.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(a,b,c,d){var e,f,g,h,i,l,o,p,q=8,r=a.timescale,s=a.samples,t=[],u=s.length,v=this._PTSNormalize,w=this._initDTS;s.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c?c:d?d:a.id-b.id});var x=s.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(0>x){k.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(x/90)+" ms to overcome this issue");for(var y=0;y<s.length;y++)s[y].dts+=x}var z=void 0;z=c?this.nextAvcDts:b*r;var A=s[0];i=Math.max(v(A.dts-w,z),0),h=Math.max(v(A.pts-w,z),0);var B=Math.round((i-z)/90);c&&B&&(B>1?k.logger.log("AVC:"+B+" ms hole between fragments detected,filling it"):-1>B&&k.logger.log("AVC:"+-B+" ms overlapping between fragments detected"),i=z,s[0].dts=i+w,h=Math.max(h-B,z),s[0].pts=h+w,k.logger.log("Video/PTS/DTS adjusted: "+Math.round(h/90)+"/"+Math.round(i/90)+",delta:"+B+" ms")),l=i,A=s[s.length-1],p=Math.max(v(A.dts-w,z),0),o=Math.max(v(A.pts-w,z),0),o=Math.max(o,p);var C=this.isSafari;C&&(e=Math.round((p-i)/(s.length-1)));for(var D=0,E=0,F=0;u>F;F++){for(var G=s[F],H=G.units,I=H.length,J=0,K=0;I>K;K++)J+=H[K].data.length;E+=J,D+=I,G.length=J,C?G.dts=i+F*e:G.dts=Math.max(v(G.dts-w,z),i),G.pts=Math.max(v(G.pts-w,z),G.dts)}var L=E+4*D+8;try{f=new Uint8Array(L)}catch(M){return void this.observer.trigger(j["default"].ERROR,{type:n.ErrorTypes.MUX_ERROR,details:n.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:L,reason:"fail allocating video mdat "+L})}var N=new DataView(f.buffer);N.setUint32(0,L),f.set(m["default"].types.mdat,4);for(var O=0;u>O;O++){for(var P=s[O],Q=P.units,R=0,S=void 0,T=0,U=Q.length;U>T;T++){var V=Q[T],W=V.data,X=V.data.byteLength;N.setUint32(q,X),q+=4,f.set(W,q),q+=X,R+=4+X}if(C)S=Math.max(0,e*Math.round((P.pts-P.dts)/e));else{if(u-1>O)e=s[O+1].dts-P.dts;else{var Y=this.config,Z=P.dts-s[O>0?O-1:O].dts;if(Y.stretchShortVideoTrack){var $=Y.maxBufferHole,_=Y.maxSeekHole,aa=Math.floor(Math.min($,_)*r),ba=(d?h+d*r:this.nextAudioPts)-P.pts;ba>aa?(e=ba-Z,0>e&&(e=Z),k.logger.log("It is approximately "+ba/90+" ms to the next segment; using duration "+e/90+" ms for the last video frame.")):e=Z}else e=Z}S=Math.round(P.pts-P.dts)}t.push({size:R,duration:e,cts:S,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:P.key?2:1,isNonSync:P.key?0:1}})}this.nextAvcDts=p+e;var ca=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,t.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var da=t[0].flags;da.dependsOn=2,da.isNonSync=0}a.samples=t,g=m["default"].moof(a.sequenceNumber++,i,a),a.samples=[];var ea={data1:g,data2:f,startPTS:h/r,endPTS:(o+e)/r,startDTS:i/r,endDTS:this.nextAvcDts/r,type:"video",nb:t.length,dropped:ca};return this.observer.trigger(j["default"].FRAG_PARSING_DATA,ea),ea}},{key:"remuxAudio",value:function(a,b,c,d){var e,f,g,i,l,o,p,q,r,s,t,u,v,w,x,y,z=a.inputTimeScale,A=a.timescale,B=z/A,C=a.isAAC?1024:1152,D=C*B,E=this._PTSNormalize,F=this._initDTS,G=!a.isAAC&&this.typeSupported.mpeg,H=G?0:8,I=[],J=[];if(a.samples.sort(function(a,b){return a.pts-b.pts}),J=a.samples,y=this.nextAudioPts,c|=J.length&&y&&(d&&Math.abs(b-y/z)<.1||Math.abs(J[0].pts-y-F)<20*D),c||(y=b*z),d&&a.isAAC)for(var K=0,L=y;K<J.length;){var M=J[K],N=E(M.pts-F,y),O=N-L;if(-D>=O)k.logger.warn("Dropping 1 audio frame @ "+(L/z).toFixed(3)+"s due to "+Math.abs(1e3*O/z)+" ms overlap."),J.splice(K,1),a.len-=M.unit.length;else if(O>=D&&L){var P=Math.round(O/D);k.logger.warn("Injecting "+P+" audio frame @ "+(L/z).toFixed(3)+"s due to "+1e3*O/z+" ms gap.");for(var Q=0;P>Q;Q++)x=L+F,x=Math.max(x,F),w=h["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(k.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),w=M.unit.subarray()),J.splice(K,0,{unit:w,pts:x,dts:x}),a.len+=w.length,L+=D,K+=1;M.pts=M.dts=L+F,L+=D,K+=1}else Math.abs(O)>.1*D,L+=D,0===K?M.pts=M.dts=F+y:M.pts=M.dts=J[K-1].pts+D,K+=1}for(var R=0,S=J.length;S>R;R++){if(f=J[R],i=f.unit,s=f.pts-F,t=f.dts-F,void 0!==r)u=E(s,r),v=E(t,r),g.duration=Math.round((v-r)/B);else{u=E(s,y),v=E(t,y);var T=Math.round(1e3*(u-y)/z),U=0;if(c&&a.isAAC&&T){if(T>0)U=Math.round((u-y)/D),k.logger.log(T+" ms hole between AAC samples detected,filling it"),U>0&&(w=h["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(w=i.subarray()),a.len+=U*w.length);else if(-12>T){k.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(y/z).toFixed(3)+"s/"+(u/z).toFixed(3)+"s/"+-T+"ms"),a.len-=i.byteLength;continue}u=v=y}if(p=Math.max(0,u),q=Math.max(0,v),!(a.len>0))return;var V=G?a.len:a.len+8;try{l=new Uint8Array(V)}catch(W){return void this.observer.trigger(j["default"].ERROR,{type:n.ErrorTypes.MUX_ERROR,details:n.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V})}G||(e=new DataView(l.buffer),e.setUint32(0,V),l.set(m["default"].types.mdat,4));for(var X=0;U>X;X++)x=u-(U-X)*D,w=h["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(k.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),w=i.subarray()),l.set(w,H),H+=w.byteLength,g={size:w.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push(g)}l.set(i,H);var Y=i.byteLength;H+=Y,g={size:Y,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push(g),r=v}var Z=0,$=I.length;if($>=2&&(Z=I[$-2].duration,g.duration=Z),$){this.nextAudioPts=u+B*Z,a.len=0,a.samples=I,o=G?new Uint8Array:m["default"].moof(a.sequenceNumber++,q/B,a),a.samples=[];var _={data1:o,data2:l,startPTS:p/z,endPTS:this.nextAudioPts/z,startDTS:q/z,endDTS:(v+B*Z)/z,type:"audio",nb:$};return this.observer.trigger(j["default"].FRAG_PARSING_DATA,_),_}return null}},{key:"remuxEmptyAudio",value:function(a,b,c,d){var e=a.inputTimeScale,f=a.samplerate?a.samplerate:e,g=e/f,i=this.nextAudioPts,j=(void 0!==i?i:d.startDTS*e)+this._initDTS,l=d.endDTS*e+this._initDTS,m=1024,n=g*m,o=Math.ceil((l-j)/n),p=h["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(k.logger.warn("remux empty Audio"),!p)return void k.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var q=[],r=0;o>r;r++){var s=j+r*n;q.push({unit:p,pts:s,dts:s}),a.len+=p.length}a.samples=q,this.remuxAudio(a,b,c)}},{key:"remuxID3",value:function(a,b){var c,d=a.samples.length,e=a.inputTimeScale,f=this._initPTS,g=this._initDTS;if(d){for(var h=0;d>h;h++)c=a.samples[h],c.pts=(c.pts-f)/e,c.dts=(c.dts-g)/e;this.observer.trigger(j["default"].FRAG_PARSING_METADATA,{samples:a.samples})}a.samples=[],b=b}},{key:"remuxText",value:function(a,b){a.samples.sort(function(a,b){return a.pts-b.pts});var c,d=a.samples.length,e=a.inputTimeScale,f=this._initPTS;if(d){for(var g=0;d>g;g++)c=a.samples[g],c.pts=(c.pts-f)/e;this.observer.trigger(j["default"].FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=[],b=b}},{key:"_PTSNormalize",value:function(a,b){var c;if(void 0===b)return a;for(c=a>b?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a}}]),a}();c["default"]=o},{31:31,33:33,34:34,42:42,51:51}],44:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(33),h=d(g),i=function(){function a(b){e(this,a),this.observer=b}return f(a,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(a,b,c,d,e,f,g,i){var j=this.observer,k="";a&&(k+="audio"),b&&(k+="video"),j.trigger(h["default"].FRAG_PARSING_DATA,{data1:i,startPTS:e,startDTS:e,type:k,nb:1,dropped:0}),j.trigger(h["default"].FRAG_PARSED)}}]),a}();c["default"]=i},{33:33}],45:[function(a,b,c){"use strict";
function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,h=function(){function a(b){d(this,a),"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}return e(a,[{key:"decimalInteger",value:function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"hexadecimalInteger",value:function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null}},{key:"hexadecimalIntegerAsNumber",value:function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"decimalFloatingPoint",value:function(a){return parseFloat(this[a])}},{key:"enumeratedString",value:function(a){return this[a]}},{key:"decimalResolution",value:function(a){var b=f.exec(this[a]);return null===b?void 0:{width:parseInt(b[1],10),height:parseInt(b[2],10)}}}],[{key:"parseAttrList",value:function(a){var b,c={};for(g.lastIndex=0;null!==(b=g.exec(a));){var d=b[2],e='"';0===d.indexOf(e)&&d.lastIndexOf(e)===d.length-1&&(d=d.slice(1,-1)),c[b[1]]=d}return c}}]),a}();c["default"]=h},{}],46:[function(a,b,c){"use strict";var d={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;d>=c;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(0>g))return f;d=e-1}}return null}};b.exports=d},{}],47:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},g=function(a){var b=a;return f.hasOwnProperty(a)&&(b=f[a]),String.fromCharCode(b)},h=15,i=100,j={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},k={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},n=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],o={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){var c=this.verboseFilter[a];this.verboseLevel>=c&&console.log(this.time+" ["+a+"] "+b)}},p=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},q=function(){function a(b,c,e,f,g){d(this,a),this.foreground=b||"white",this.underline=c||!1,this.italics=e||!1,this.background=f||"black",this.flash=g||!1}return e(a,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash}},{key:"copy",value:function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),a}(),r=function(){function a(b,c,e,f,g,h){d(this,a),this.uchar=b||" ",this.penState=new q(c,e,f,g,h)}return e(a,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(a,b){this.uchar=a,this.penState.copy(b)}},{key:"setPenState",value:function(a){this.penState.copy(a)}},{key:"equals",value:function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)}},{key:"copy",value:function(a){this.uchar=a.uchar,this.penState.copy(a.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),a}(),s=function(){function a(){d(this,a),this.chars=[];for(var b=0;i>b;b++)this.chars.push(new r);this.pos=0,this.currPenState=new q}return e(a,[{key:"equals",value:function(a){for(var b=!0,c=0;i>c;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;i>b;b++)this.chars[b].copy(a.chars[b])}},{key:"isEmpty",value:function(){for(var a=!0,b=0;i>b;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a}},{key:"setCursor",value:function(a){this.pos!==a&&(this.pos=a),this.pos<0?(o.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(o.log("ERROR","Too large cursor position "+this.pos),this.pos=i)}},{key:"moveCursor",value:function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;b+1>c;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(a){a>=144&&this.backSpace();var b=g(a);return this.pos>=i?void o.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(a){var b;for(b=a;i>b;b++)this.chars[b].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var a=[],b=!0,c=0;i>c;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")}},{key:"setPenStyles",value:function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)}}]),a}(),t=function(){function a(){d(this,a),this.rows=[];for(var b=0;h>b;b++)this.rows.push(new s);this.currRow=h-1,this.nrRollUpRows=null,this.reset()}return e(a,[{key:"reset",value:function(){for(var a=0;h>a;a++)this.rows[a].clear();this.currRow=h-1}},{key:"equals",value:function(a){for(var b=!0,c=0;h>c;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;h>b;b++)this.rows[b].copy(a.rows[b])}},{key:"isEmpty",value:function(){for(var a=!0,b=0;h>b;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a}},{key:"backSpace",value:function(){var a=this.rows[this.currRow];a.backSpace()}},{key:"clearToEndOfRow",value:function(){var a=this.rows[this.currRow];a.clearToEndOfRow()}},{key:"insertChar",value:function(a){var b=this.rows[this.currRow];b.insertChar(a)}},{key:"setPen",value:function(a){var b=this.rows[this.currRow];b.setPenStyles(a)}},{key:"moveCursor",value:function(a){var b=this.rows[this.currRow];b.moveCursor(a)}},{key:"setCursor",value:function(a){o.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)}},{key:"setPAC",value:function(a){o.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;h>c;c++)this.rows[c].clear();var d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var f=e.rows[d].cueStartTime;if(f&&f<o.time)for(var g=0;g<this.nrRollUpRows;g++)this.rows[b-this.nrRollUpRows+g+1].copy(e.rows[d+g])}}this.currRow=b;var i=this.rows[this.currRow];if(null!==a.indent){var j=a.indent,k=Math.max(j-1,0);i.setCursor(a.indent),a.color=i.chars[k].penState.foreground}var l={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(l)}},{key:"setBkgData",value:function(a){o.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)}},{key:"setRollUpRows",value:function(a){this.nrRollUpRows=a}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void o.log("DEBUG","roll_up but nrRollUpRows not set yet");o.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),o.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;h>e;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c}},{key:"getTextAndFormat",value:function(){return this.rows}}]),a}(),u=function(){function a(b,c){d(this,a),this.chNr=b,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new t,this.nonDisplayedMemory=new t,this.lastOutputScreen=new t,this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e(a,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(a){this.outputFilter=a}},{key:"setPAC",value:function(a){this.writeScreen.setPAC(a)}},{key:"setBkgData",value:function(a){this.writeScreen.setBkgData(a)}},{key:"setMode",value:function(a){a!==this.mode&&(this.mode=a,o.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)}},{key:"insertChars",value:function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";o.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(o.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){o.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){o.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){o.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(a){o.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)}},{key:"ccFON",value:function(){o.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){o.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){o.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){o.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){o.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){o.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){o.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(o.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,o.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(a){o.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)}},{key:"ccMIDROW",value:function(a){var b={flash:!1};if(b.underline=a%2===1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}o.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)}},{key:"outputDataUpdate",value:function(){var a=o.time;null!==a&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(a,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))}}]),a}(),v=function(){function a(b,c,e){d(this,a),this.field=b||1,this.outputs=[c,e],this.channels=[new u(1,c),new u(2,e)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}}return e(a,[{key:"getHandler",value:function(a){return this.channels[a].getHandler()}},{key:"setHandler",value:function(a,b){this.channels[a].setHandler(b)}},{key:"addData",value:function(a,b){var c,d,e,f=!1;this.lastTime=a,o.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(o.log("DATA","["+p([b[g],b[g+1]])+"] -> ("+p([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else o.log("WARNING","No channel found yet. TEXT-MODE?");c?this.dataCounters.cmd+=2:f?this.dataCounters["char"]+=2:(this.dataCounters.other+=2,o.log("WARNING","Couldn't parse cleaned data "+p([d,e])+" orig: "+p([b[g],b[g+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(a,b){var c=null,d=(20===a||28===a)&&b>=32&&47>=b,e=(23===a||31===a)&&b>=33&&35>=b;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,o.log("DEBUG","Repeated command ("+p([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0}},{key:"parseMidrow",value:function(a,b){var c=null;if((17===a||25===a)&&b>=32&&47>=b){if(c=17===a?1:2,c!==this.currChNr)return o.log("ERROR","Mismatch channel in midrow parsing"),!1;var d=this.channels[c-1];return d.ccMIDROW(b),o.log("DEBUG","MIDROW ("+p([a,b])+")"),!0}return!1}},{key:"parsePAC",value:function(a,b){var c=null,d=null,e=(a>=17&&23>=a||a>=25&&31>=a)&&b>=64&&127>=b,f=(16===a||24===a)&&b>=64&&95>=b;if(!e&&!f)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=23>=a?1:2,d=b>=64&&95>=b?1===c?j[a]:l[a]:1===c?k[a]:m[a];var g=this.interpretPAC(d,b),h=this.channels[c-1];return h.setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0}},{key:"interpretPAC",value:function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),13>=c?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:15>=c?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d}},{key:"parseChars",value:function(a,b){var c=null,d=null,e=null;if(a>=25?(c=2,e=a-8):(c=1,e=a),e>=17&&19>=e){var f=b;f=17===e?b+80:18===e?b+112:b+144,o.log("INFO","Special char '"+g(f)+"' in channel "+c),d=[f]}else a>=32&&127>=a&&(d=0===b?[a]:[a,b]);if(d){var h=p(d);o.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d}},{key:"parseBackgroundAttributes",value:function(a,b){var c,d,e,f,g=(16===a||24===a)&&b>=32&&47>=b,h=(23===a||31===a)&&b>=45&&47>=b;return g||h?(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=n[d],b%2===1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=24>a?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0):!1}},{key:"reset",value:function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)}}]),a}();c["default"]=v},{}],48:[function(a,b,c){"use strict";var d=a(54),e={newCue:function(a,b,c,e){for(var f,g,h,i,j,k=window.VTTCue||window.TextTrackCue,l=0;l<e.rows.length;l++)if(f=e.rows[l],h=!0,i=0,j="",!f.isEmpty()){for(var m=0;m<f.chars.length;m++)f.chars[m].uchar.match(/\s/)&&h?i++:(j+=f.chars[m].uchar,h=!1);f.cueStartTime=b,b===c&&(c+=1e-4),g=new k(b,c,d.fixLineBreaks(j.trim())),i>=16?i--:i++,navigator.userAgent.match(/Firefox\//)?g.line=l+1:g.line=l>7?l-2:l+1,g.align="left",g.position=Math.max(0,Math.min(100,100*(i/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(g)}}};b.exports=e},{54:54}],49:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(50),h=d(g),i=function(){function a(b,c,d,f){e(this,a),this.hls=b,this.defaultEstimate_=f,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new h["default"](c),this.fast_=new h["default"](d)}return f(a,[{key:"sample",value:function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)}},{key:"canEstimate",value:function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),a}();c["default"]=i},{50:50}],50:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=0,this.totalWeight_=0}return e(a,[{key:"sample",value:function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_}}]),a}();c["default"]=f},{}],51:[function(a,b,c){"use strict";function d(){}function e(a,b){return b="["+a+"] > "+b}function f(a){var b=self.console[a];return b?function(){for(var c=arguments.length,d=Array(c),f=0;c>f;f++)d[f]=arguments[f];d[0]&&(d[0]=e(a,d[0])),b.apply(self.console,d)}:d}function g(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];c.forEach(function(b){j[b]=a[b]?a[b].bind(a):f(b)})}Object.defineProperty(c,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i={trace:d,debug:d,log:d,warn:d,info:d,error:d},j=i;c.enableLogs=function(a){if(a===!0||"object"===("undefined"==typeof a?"undefined":h(a))){g(a,"debug","log","info","warn","error");try{j.log()}catch(b){j=i}}else j=i},c.logger=j},{}],52:[function(a,b,c){"use strict";var d={toString:function(a){for(var b="",c=a.length,d=0;c>d;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}};b.exports=d},{}],53:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(){function a(a){if("string"!=typeof a)return!1;var b=f[a.toLowerCase()];return b?a.toLowerCase():!1}function b(a){if("string"!=typeof a)return!1;var b=g[a.toLowerCase()];return b?a.toLowerCase():!1}function c(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function d(d,f,g){var h=this,i=function(){return"undefined"!=typeof navigator?/MSIE\s8\.0/.test(navigator.userAgent):void 0}(),j={};i?h=document.createElement("custom"):j.enumerable=!0,h.hasBeenReset=!1;var k="",l=!1,m=d,n=f,o=g,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle";return Object.defineProperty(h,"id",c({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(h,"pauseOnExit",c({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(h,"startTime",c({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",c({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",c({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",c({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",c({},j,{get:function(){return q},set:function(b){var c=a(b);if(c===!1)throw new SyntaxError("An invalid or illegal string was specified.");q=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",c({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",c({},j,{get:function(){return s},set:function(a){if("number"!=typeof a&&a!==e)throw new SyntaxError("An invalid number or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",c({},j,{get:function(){return t},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",c({},j,{get:function(){return u},set:function(a){if(0>a||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",c({},j,{get:function(){return v},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",c({},j,{get:function(){return w},set:function(a){if(0>a||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",c({},j,{get:function(){return x},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");x=c,this.hasBeenReset=!0}})),h.displayState=void 0,i?h:void 0}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",f={"":!0,lr:!0,rl:!0},g={start:!0,middle:!0,end:!0,left:!0,right:!0};return d.prototype.getCueAsHTML=function(){var a=window.WebVTT;return a.convertCueToDOMTree(window,this.text)},d}()},{}],54:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new m,this.regionList=[]}function f(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}function g(){this.values=Object.create(null)}function h(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}function i(a,b,c){function d(){var b=f(a);if(null===b)throw new Error("Malformed timestamp: "+j);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function e(a,b){var d=new g;h(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start",o,"end"]);break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",o,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical","");var e=d.get("line","auto");"auto"===e&&-1===n.line&&(e=-1),b.line=e,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",o);var f=d.get("position","auto");"auto"===f&&50===n.position&&(f="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=f}function i(){a=a.replace(/^\s+/,"")}var j=a;if(i(),b.startTime=d(),i(),"-->"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+j);a=a.substr(3),i(),b.endTime=d(),i(),e(a,b)}function j(a){return a.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(c,"__esModule",{value:!0}),c.fixLineBreaks=void 0;var k=a(53),l=d(k),m=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};g.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){var c;return(c=b.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(b=parseFloat(b),b>=0&&100>=b)?(this.set(a,b),!0):!1}};var n=new l["default"](0,0,0),o="middle"===n.align?"middle":"center";e.prototype={parse:function(a){function b(){var a=d.buffer,b=0;for(a=j(a);b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,d.buffer=a.substr(b),c}function c(a){h(a,function(a,b){switch(a){case"Region":console.log("parse region",b)}},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{var e;if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;e=b();var f=e.match(/^WEBVTT([ \t].*)?$/);if(!f||!f[0])throw new Error("Malformed WebVTT signature.");d.state="HEADER"}for(var g=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;switch(g?g=!1:e=b(),d.state){case"HEADER":/:/.test(e)?c(e):e||(d.state="ID");continue;case"NOTE":e||(d.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){d.state="NOTE";break}if(!e)continue;if(d.cue=new l["default"](0,0,""),d.state="CUE",-1===e.indexOf("-->")){d.cue.id=e;continue}case"CUE":try{i(e,d.cue,d.regionList)}catch(k){d.cue=null,d.state="BADCUE";continue}d.state="CUETEXT";continue;case"CUETEXT":var m=-1!==e.indexOf("-->");if(!e||m&&(g=!0)){d.oncue&&d.oncue(d.cue),d.cue=null,d.state="ID";continue}d.cue.text&&(d.cue.text+="\n"),d.cue.text+=e;continue;case"BADCUE":e||(d.state="ID");continue}}}catch(k){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state)throw new Error("Malformed WebVTT signature.")}catch(b){throw b}return a.onflush&&a.onflush(),this}},c.fixLineBreaks=j,c["default"]=e},{53:53}],55:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}var e=a(54),f=d(e),g=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),d=parseInt(a.substr(-9,2)),e=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;return isNaN(b)||isNaN(c)||isNaN(d)||isNaN(e)?-1:(b+=1e3*c,b+=6e4*d,b+=36e5*e)},h=function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e["new"]&&d["new"])return a.ccOffset=a.presentationOffset=d.start,void(d["new"]=!1);for(;e&&e["new"];)a.ccOffset+=d.start-e.start,d["new"]=!1,d=e,e=a[d.prevCC];a.presentationOffset=c},i={parse:function(a,b,c,d,e,i){var j=/\r\n|\n\r|\n|\r/g,k=String.fromCharCode.apply(null,new Uint8Array(a)).trim().replace(j,"\n").split("\n"),l="00:00.000",m=0,n=0,o=0,p=[],q=void 0,r=!0,s=new f["default"];s.oncue=function(a){var b=c[d],e=c.ccOffset;b&&b["new"]&&(n?e=c.ccOffset=b.start:h(c,d,o)),o&&!n&&(e=o+c.ccOffset-c.presentationOffset),a.startTime+=e-n,a.endTime+=e-n,a.text=decodeURIComponent(escape(a.text)),a.endTime>0&&p.push(a)},s.onparsingerror=function(a){q=a},s.onflush=function(){return q&&i?void i(q):void e(p)},k.forEach(function(a){if(r){if(a.startsWith("X-TIMESTAMP-MAP=")){r=!1,a.substr(16).split(",").forEach(function(a){a.startsWith("LOCAL:")?l=a.substr(6):a.startsWith("MPEGTS:")&&(m=parseInt(a.substr(7)))});try{b=0>b?b+8589934592:b,m-=b,n=g(l)/1e3,o=m/9e4,-1===n&&(q=new Error("Malformed X-TIMESTAMP-MAP: "+a))}catch(c){q=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}""===a&&(r=!1)}s.parse(a+"\n")}),s.flush()}};b.exports=i},{54:54}],56:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(51),g=function(){function a(b){d(this,a),b&&b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}return e(a,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:performance.now(),retry:0
},this.retryDelay=b.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var a,b=this.context;a="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var c=this.stats;c.tfirst=0,c.loaded=0;var d=this.xhrSetup;if(d)try{d(a,b.url)}catch(e){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0),b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()}},{key:"readystatechange",value:function(a){var b=a.currentTarget,c=b.readyState,d=this.stats,e=this.context,g=this.config;if(!d.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===d.tfirst&&(d.tfirst=Math.max(performance.now(),d.trequest)),4===c){var h=b.status;if(h>=200&&300>h){d.tload=Math.max(d.tfirst,performance.now());var i=void 0,j=void 0;"arraybuffer"===e.responseType?(i=b.response,j=i.byteLength):(i=b.responseText,j=i.length),d.loaded=d.total=j;var k={url:b.responseURL,data:i};this.callbacks.onSuccess(k,d,e)}else d.retry>=g.maxRetry||h>=400&&499>h?(f.logger.error(h+" while loading "+e.url),this.callbacks.onError({code:h,text:b.statusText},e)):(f.logger.warn(h+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,g.maxRetryDelay),d.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),g.timeout)}},{key:"loadtimeout",value:function(){f.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(a){var b=this.stats;b.loaded=a.loaded,a.lengthComputable&&(b.total=a.total);var c=this.callbacks.onProgress;c&&c(b,this.context,null)}}]),a}();c["default"]=g},{51:51}]},{},[38])(38)}),!function(){function a(a){console.log("$f.fireEvent",[].slice.call(a))}function b(a){if(!a||"object"!=typeof a)return a;var c=new a.constructor;for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d]));return c}function c(a,b){if(a){var c,d=0,e=a.length;if(void 0===e){for(c in a)if(b.call(a[c],c,a[c])===!1)break}else for(var f=a[0];e>d&&b.call(f,d,f)!==!1;f=a[++d]);return a}}function d(a){return document.getElementById(a)}function e(a,b,d){return"object"!=typeof b?a:(a&&b&&c(b,function(b,c){d&&"function"==typeof c||(a[b]=c)}),a)}function f(a){var b=a.indexOf(".");if(-1!=b){var d=a.slice(0,b)||"*",e=a.slice(b+1,a.length),f=[];return c(document.getElementsByTagName(d),function(){this.className&&-1!=this.className.indexOf(e)&&f.push(this)}),f}}function g(a){return a=a||window.event,a.preventDefault?(a.stopPropagation(),a.preventDefault()):(a.returnValue=!1,a.cancelBubble=!0),!1}function h(a,b,c){a[b]=a[b]||[],a[b].push(c)}function i(a){return a.replace(/&amp;/g,"%26").replace(/&/g,"%26").replace(/=/g,"%3D")}function j(){return"_"+(""+Math.random()).slice(2,10)}function k(f,k,l){function p(){function a(a){return!/iPad|iPhone|iPod/i.test(navigator.userAgent)||/.flv$/i.test(B[0].url)||b()?(y.isLoaded()||y._fireEvent("onBeforeClick")===!1||y.load(),g(a)):!0}function b(){return y.hasiPadSupport&&y.hasiPadSupport()}function d(){""!==q.replace(/\s/g,"")?f.addEventListener?f.addEventListener("click",a,!1):f.attachEvent&&f.attachEvent("onclick",a):(f.addEventListener&&!b()&&f.addEventListener("click",g,!1),y.load())}$f(f)?($f(f).getParent().innerHTML="",u=$f(f).getIndex(),o[u]=y):(o.push(y),u=o.length-1),x=parseInt(f.style.height,10)||f.clientHeight,s=f.id||"fp"+j(),t=k.id||s+"_api",k.id=t,q=f.innerHTML,"string"==typeof l&&(l={clip:{url:l}}),l.playerId=s,l.clip=l.clip||{},f.getAttribute("href",2)&&!l.clip.url&&(l.clip.url=f.getAttribute("href",2)),l.clip.url&&(l.clip.url=i(l.clip.url)),r=new m(l.clip,-1,y),l.playlist=l.playlist||[l.clip];var e=0;c(l.playlist,function(){var a=this;"object"==typeof a&&a.length&&(a={url:""+a}),a.url&&(a.url=i(a.url)),c(l.clip,function(b,c){void 0!==c&&void 0===a[b]&&"function"!=typeof c&&(a[b]=c)}),l.playlist[e]=a,a=new m(a,e,y),B.push(a),e++}),c(l,function(a,b){"function"==typeof b&&(r[a]?r[a](b):h(D,a,b),delete l[a])}),c(l.plugins,function(a,b){b&&(C[a]=new n(a,b,y))}),l.plugins&&void 0!==l.plugins.controls||(C.controls=new n("controls",null,y)),C.canvas=new n("canvas",null,y),q=f.innerHTML,setTimeout(d,0)}var q,r,s,t,u,v,w,x,y=this,z=null,A=!1,B=[],C={},D={};if(e(y,{id:function(){return s},isLoaded:function(){return null!==z&&void 0!==z.fp_play&&!A},getParent:function(){return f},hide:function(a){return a&&(f.style.height="0px"),y.isLoaded()&&(z.style.height="0px"),y},show:function(){return f.style.height=x+"px",y.isLoaded()&&(z.style.height=w+"px"),y},isHidden:function(){return y.isLoaded()&&0===parseInt(z.style.height,10)},load:function(a){if(!y.isLoaded()&&y._fireEvent("onBeforeLoad")!==!1){var b=function(){q&&!flashembed.isSupported(k.version)&&(f.innerHTML=""),a&&(a.cached=!0,h(D,"onLoad",a)),flashembed(f,k,{config:l})},d=0;c(o,function(){this.unload(function(a){++d==o.length&&b()})})}return y},unload:function(a){if(""!==q.replace(/\s/g,"")){if(y._fireEvent("onBeforeUnload")===!1)return a&&a(!1),y;A=!0;try{z&&(z.fp_isFullscreen()&&z.fp_toggleFullscreen(),z.fp_close(),y._fireEvent("onUnload"))}catch(b){}var c=function(){z=null,f.innerHTML=q,A=!1,a&&a(!0)};/WebKit/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)?setTimeout(c,0):c()}else a&&a(!1);return y},getClip:function(a){return void 0===a&&(a=v),B[a]},getCommonClip:function(){return r},getPlaylist:function(){return B},getPlugin:function(a){var b=C[a];if(!b&&y.isLoaded()){var c=y._api().fp_getPlugin(a);c&&(b=new n(a,c,y),C[a]=b)}return b},getScreen:function(){return y.getPlugin("screen")},getControls:function(){return y.getPlugin("controls")._fireEvent("onUpdate")},getLogo:function(){try{return y.getPlugin("logo")._fireEvent("onUpdate")}catch(a){}},getPlay:function(){return y.getPlugin("play")._fireEvent("onUpdate")},getConfig:function(a){return a?b(l):l},getFlashParams:function(){return k},loadPlugin:function(a,b,c,d){"function"==typeof c&&(d=c,c={});var e=d?j():"_";y._api().fp_loadPlugin(a,b,c,e);var f={};f[e]=d;var g=new n(a,null,y,f);return C[a]=g,g},getState:function(){return y.isLoaded()?z.fp_getState():-1},play:function(a,b){var c=function(){void 0!==a?y._api().fp_play(a,b):y._api().fp_play()};return y.isLoaded()?c():A?setTimeout(function(){y.play(a,b)},50):y.load(function(){c()}),y},getVersion:function(){var a="flowplayer.js @VERSION";if(y.isLoaded()){var b=z.fp_getVersion();return b.push(a),b}return a},_api:function(){if(!y.isLoaded())throw"Flowplayer "+y.id()+" not loaded when calling an API method";return z},setClip:function(a){return c(a,function(b,c){"function"==typeof c?(h(D,b,c),delete a[b]):"onCuepoint"==b&&$f(f).getCommonClip().onCuepoint(a[b][0],a[b][1])}),y.setPlaylist([a]),y},getIndex:function(){return u},bufferAnimate:function(a){return z.fp_bufferAnimate(void 0===a||a),y},_swfHeight:function(){return z.clientHeight}}),c("Click*,Load*,Unload*,Keypress*,Volume*,Mute*,Unmute*,PlaylistReplace,ClipAdd,Fullscreen*,FullscreenExit,Error,MouseOver,MouseOut".split(","),function(){var a="on"+this;if(-1!=a.indexOf("*")){a=a.slice(0,a.length-1);var b="onBefore"+a.slice(2);y[b]=function(a){return h(D,b,a),y}}y[a]=function(b){return h(D,a,b),y}}),c("pause,resume,mute,unmute,stop,toggle,seek,getStatus,getVolume,setVolume,getTime,isPaused,isPlaying,startBuffering,stopBuffering,isFullscreen,toggleFullscreen,reset,close,setPlaylist,addClip,playFeed,setKeyboardShortcutsEnabled,isKeyboardShortcutsEnabled".split(","),function(){var a=this;y[a]=function(b,c){if(!y.isLoaded())return y;var d=null;return d=void 0!==b&&void 0!==c?z["fp_"+a](b,c):void 0===b?z["fp_"+a]():z["fp_"+a](b),"undefined"===d||void 0===d?y:d}}),y._fireEvent=function(b){"string"==typeof b&&(b=[b]);var e=b[0],f=b[1],g=b[2],h=b[3],i=0;if(l.debug&&a(b),y.isLoaded()||"onLoad"!=e||"player"!=f||(z=z||d(t),w=y._swfHeight(),c(B,function(){this._fireEvent("onLoad")}),c(C,function(a,b){b._fireEvent("onUpdate")}),r._fireEvent("onLoad")),"onLoad"!=e||"player"==f){if("onError"==e&&("string"==typeof f||"number"==typeof f&&"number"==typeof g)&&(f=g,g=h),"onContextMenu"==e)return void c(l.contextMenu[f],function(a,b){b.call(y)});if("onPluginEvent"!=e&&"onBeforePluginEvent"!=e){if("onPlaylistReplace"==e){B=[];var j=0;c(f,function(){B.push(new m(this,j++,y))})}if("onClipAdd"==e){if(f.isInStream)return;for(f=new m(f,g,y),B.splice(g,0,f),i=g+1;i<B.length;i++)B[i].index++}var k=!0;if("number"==typeof f&&f<B.length){v=f;var n=B[f];n&&(k=n._fireEvent(e,g,h)),n&&k===!1||(k=r._fireEvent(e,g,h,n))}return c(D[e],function(){return k=this.call(y,f,g),this.cached&&D[e].splice(i,1),k===!1?!1:void i++}),k}var o=f.name||f,p=C[o];if(p)return p._fireEvent("onUpdate",f),p._fireEvent(g,b.slice(3))}},"string"==typeof f){var E=d(f);if(!E)throw"Flowplayer cannot access element: "+f;f=E,p()}else p()}function l(a){this.length=a.length,this.each=function(b){c(a,b)},this.size=function(){return a.length};var b=this;for(name in k.prototype)b[name]=function(){var a=arguments;b.each(function(){this[name].apply(this,a)})}}var m=function(a,b,d){var f=this,g={},i={};if(f.index=b,"string"==typeof a&&(a={url:a}),e(this,a,!0),c("Begin*,Start,Pause*,Resume*,Seek*,Stop*,Finish*,LastSecond,Update,BufferFull,BufferEmpty,BufferStop".split(","),function(){var a="on"+this;if(-1!=a.indexOf("*")){a=a.slice(0,a.length-1);var c="onBefore"+a.slice(2);f[c]=function(a){return h(i,c,a),f}}f[a]=function(b){return h(i,a,b),f},-1==b&&(f[c]&&(d[c]=f[c]),f[a]&&(d[a]=f[a]))}),e(this,{onCuepoint:function(a,c){if(1==arguments.length)return g.embedded=[null,a],f;"number"==typeof a&&(a=[a]);var e=j();return g[e]=[a,c],d.isLoaded()&&d._api().fp_addCuepoints(a,b,e),f},update:function(a){e(f,a),d.isLoaded()&&d._api().fp_updateClip(a,b);var c=d.getConfig(),g=-1==b?c.clip:c.playlist[b];e(g,a,!0)},_fireEvent:function(a,h,j,k){if("onLoad"==a)return c(g,function(a,c){c[0]&&d._api().fp_addCuepoints(c[0],b,a)}),!1;if(k=k||f,"onCuepoint"==a){var l=g[h];if(l)return l[1].call(d,k,j)}h&&-1!="onBeforeBegin,onMetaData,onMetaDataChange,onStart,onUpdate,onResume".indexOf(a)&&(e(k,h),h.metaData&&(k.duration?k.fullDuration=h.metaData.duration:k.duration=h.metaData.duration));var m=!0;return c(i[a],function(){m=this.call(d,k,h,j)}),m}}),a.onCuepoint){var k=a.onCuepoint;f.onCuepoint.apply(f,"function"==typeof k?[k]:k),delete a.onCuepoint}c(a,function(b,c){"function"==typeof c&&(h(i,b,c),delete a[b])}),-1==b&&(d.onCuepoint=this.onCuepoint)},n=function(a,b,d,f){var g=this,h={},i=!1;f&&e(h,f),c(b,function(a,c){"function"==typeof c&&(h[a]=c,delete b[a])}),e(this,{animate:function(c,e,f){if(!c)return g;if("function"==typeof e&&(f=e,e=500),"string"==typeof c){var i=c;c={},c[i]=e,e=500}if(f){var k=j();h[k]=f}return void 0===e&&(e=500),b=d._api().fp_animate(a,c,e,k),g},css:function(c,f){if(void 0!==f){var h={};h[c]=f,c=h}return b=d._api().fp_css(a,c),e(g,b),g},show:function(){return this.display="block",d._api().fp_showPlugin(a),g},hide:function(){return this.display="none",d._api().fp_hidePlugin(a),g},toggle:function(){return this.display=d._api().fp_togglePlugin(a),g},fadeTo:function(b,c,e){if("function"==typeof c&&(e=c,c=500),e){var f=j();h[f]=e}return this.display=d._api().fp_fadeTo(a,b,c,f),this.opacity=b,g},fadeIn:function(a,b){return g.fadeTo(1,a,b)},fadeOut:function(a,b){return g.fadeTo(0,a,b)},getName:function(){return a},getPlayer:function(){return d},_fireEvent:function(b,f,j){if("onUpdate"==b){var k=d._api().fp_getPlugin(a);if(!k)return;e(g,k),delete g.methods,i||(c(k.methods,function(){var b=""+this;g[b]=function(){var c=[].slice.call(arguments),e=d._api().fp_invoke(a,b,c);return"undefined"===e||void 0===e?g:e}}),i=!0)}var l=h[b];if(l){var m=l.apply(g,f);return"_"==b.slice(0,1)&&delete h[b],m}return g}})},o=[];window.flowplayer=window.$f=function(){var a=null,g=arguments[0];if(!arguments.length)return c(o,function(){return this.isLoaded()?(a=this,!1):void 0}),a||o[0];if(1==arguments.length)return"number"==typeof g?o[g]:"*"==g?new l(o):(c(o,function(){return this.id()==g.id||this.id()==g||this.getParent()==g?(a=this,!1):void 0}),a);if(arguments.length>1){var h=arguments[1],i=3==arguments.length?arguments[2]:{};if("string"==typeof h&&(h={src:h}),h=e({bgcolor:"#000000",version:[10,1],expressInstall:"http://releases.flowplayer.org/swf/expressinstall.swf",cachebusting:!1},h),"string"==typeof g){if(-1!=g.indexOf(".")){var j=[];return c(f(g),function(){j.push(new k(this,b(h),b(i)))}),new l(j)}var m=d(g);return new k(null!==m?m:b(g),b(h),b(i))}if(g)return new k(g,b(h),b(i))}return null},e(window.$f,{fireEvent:function(){var a=[].slice.call(arguments),b=$f(a[0]);return b?b._fireEvent(a.slice(1)):null},addPlugin:function(a,b){return k.prototype[a]=b,$f},each:c,extend:e}),"function"==typeof jQuery&&(jQuery.fn.flowplayer=function(a,c){if(!arguments.length||"number"==typeof arguments[0]){var d=[];return this.each(function(){var a=$f(this);a&&d.push(a)}),arguments.length?d[arguments[0]]:new l(d)}return this.each(function(){$f(this,b(a),c?b(c):{})})})}(),!function(){function a(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function b(a,b){var c=[];for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d]));return c}function c(b,c,f){if(i.isSupported(c.version))b.innerHTML=i.getHTML(c,f);else if(c.expressInstall&&i.isSupported([6,65]))b.innerHTML=i.getHTML(a(c,{src:c.expressInstall}),{MMredirectURL:encodeURIComponent(location.href),MMplayerType:"PlugIn",MMdoctitle:document.title});else if(b.innerHTML.replace(/\s/g,"")||(b.innerHTML="<h2>Flash version "+c.version+" or greater is required</h2><h3>"+(j[0]>0?"Your version is "+j:"You have no flash plugin installed")+"</h3>"+("A"==b.tagName?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='"+e+"'>here</a></p>"),("A"==b.tagName||"DIV"==b.tagName)&&(b.onclick=function(){location.href=e})),c.onFail){var g=c.onFail.call(this);"string"==typeof g&&(b.innerHTML=g)}d&&(window[c.id]=document.getElementById(c.id)),a(this,{getRoot:function(){return b},getOptions:function(){return c},getConf:function(){return f},getApi:function(){return b.firstChild}})}var d=document.all,e="http://get.adobe.com/flashplayer",f="function"==typeof jQuery,g=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/,h={width:"100%",height:"100%",id:"_"+(""+Math.random()).slice(9),allowfullscreen:!0,allowscriptaccess:"always",quality:"high",version:[3,0],onFail:null,expressInstall:null,w3c:!1,cachebusting:!1};window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){},__flash_savedUnloadHandler=function(){}}),window.flashembed=function(b,d,e){return"string"==typeof b&&(b=document.getElementById(b.replace("#",""))),b?("string"==typeof d&&(d={src:d}),new c(b,a(a({},h),d),e)):void 0};var i=a(window.flashembed,{conf:h,getVersion:function(){var a,b,c;try{c=navigator.plugins["Shockwave Flash"],null!=c[0].enabledPlugin&&(b=c.description.slice(16))}catch(d){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),b=a&&a.GetVariable("$version")}catch(e){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),b=a&&a.GetVariable("$version")}catch(f){}}}return b=g.exec(b),b?[1*b[1],1*b[1*b[1]>9?2:3]*1]:[0,0]},asString:function(a){if(null===a||void 0===a)return null;var c=typeof a;switch("object"==c&&a.push&&(c="array"),c){case"string":return a=a.replace(new RegExp('(["\\\\])',"g"),"\\$1"),a=a.replace(/^\s?(\d+\.?\d*)%/,"$1pct"),'"'+a+'"';case"array":return"["+b(a,function(a){return i.asString(a)}).join(",")+"]";case"function":return'"function()"';case"object":var d=[];for(var e in a)a.hasOwnProperty(e)&&d.push('"'+e+'":'+i.asString(a[e]));return"{"+d.join(",")+"}"}return String(a).replace(/\s/g," ").replace(/\'/g,'"')},getHTML:function(b,c){b=a({},b);var e='<object width="'+b.width+'" height="'+b.height+'" id="'+b.id+'" name="'+b.id+'"';b.cachebusting&&(b.src+=(-1!=b.src.indexOf("?")?"&":"?")+Math.random()),e+=b.w3c||!d?' data="'+b.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"',e+=">",(b.w3c||d)&&(e+='<param name="movie" value="'+b.src+'" />'),b.width=b.height=b.id=b.w3c=b.src=null,b.onFail=b.version=b.expressInstall=null;for(var f in b)b[f]&&(e+='<param name="'+f+'" value="'+b[f]+'" />');var g="";if(c){for(var h in c)if(c[h]){var j=c[h];g+=h+"="+(/function|object/.test(typeof j)?i.asString(j):j)+"&"}g=g.slice(0,-1),e+='<param name="flashvars" value=\''+g+"' />"}return e+="</object>"},isSupported:function(a){return j[0]>a[0]||j[0]==a[0]&&j[1]>=a[1]}}),j=i.getVersion();f&&(jQuery.tools=jQuery.tools||{version:"@VERSION"},jQuery.tools.flashembed={conf:h},jQuery.fn.flashembed=function(a,b){return this.each(function(){$(this).data("flashembed",flashembed(this,a,b))})})}(),function(a,b){function c(){b(".hlsplayer").each(function(){d(this)})}function d(a){s?m(a):n(a)}function e(a,b){a.currentTime=b}function f(a){return a.currentTime}function g(a){return a.duration}function h(a){var b=flowplayer(a);return b.getPlaylist()[0].duration}function i(a,b){var c=flowplayer(a);c.seek(b)}function j(a){var b=flowplayer(a);return b.getTime()}function k(a,b){var c=!a.paused,d=new Hls;d.loadSource(b),d.attachMedia(a),c?a.play():a.pause()}function l(a,b){var c=flowplayer(a).isPlaying();flowplayer(a).getTime();o(a,b,c)}function m(a){var b=a.getElementsByTagName("source")[0].src||a.src,c=new Hls;c.loadSource(b),c.attachMedia(a)}function n(a){var c=a.getElementsByTagName("source")[0].src||a.src;a.width&&(a.style.width=a.width+"px"),a.height&&(a.style.height=a.height+"px");var d=document.createElement("div");a.className&&(d.className=a.className),a.style.cssText&&(d.style.cssText=a.style.cssText),a.id&&(d.id=a.id),b(a).replaceWith(d),o(d,c,!1)}function o(a,b,c){flowplayer(a,q,{wmode:"direct",plugins:{httpstreaming:{url:r,hls_debug:!1,hls_debug2:!1,hls_lowbufferlength:3,hls_minbufferlength:-1,hls_maxbufferlength:60,hls_startfromlevel:-1,hls_seekfromlevel:-1,hls_live_flushurlcache:!1,hls_seekmode:"ACCURATE",hls_fragmentloadmaxretry:-1,hls_manifestloadmaxretry:-1,hls_capleveltostage:!1,hls_maxlevelcappingmode:"downscale"}},clip:{accelerated:!0,url:b,urlResolvers:"httpstreaming",lang:"fr",provider:"httpstreaming",autoPlay:c,autoBuffering:!0}})}var p=(b("script"),b("script[script-flowplayer]")),q=p.attr("script-flowplayer"),r=p.attr("script-flowplayerhls");q||console.log("flowplayer attr required"),r||console.log("flowplayerhls attr required");var s=Hls.isSupported()?!0:!1;b(function(){c()}),a.hlsplayer=function(){c()},b.fn.extend({setPlayerSrc:function(a){return s?k(this[0],a):l(this[0],a),this},setPlayerTime:function(a){s?e(this[0],a):i(this[0],a)},getPlayerTime:function(a){return s?f(this[0]):j(this[0])},getTotalTime:function(){return s?g(this[0]):h(this[0])}})}(window,jQuery);